///<jscompress sourcefile="ClassManager.js" />
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

/**
 * @requires OpenLayers/SingleFile.js
 */

/**
 * Constructor: OpenLayers.Class
 * Base class used to construct all other classes. Includes support for 
 *     multiple inheritance. 
 *     
 * This constructor is new in OpenLayers 2.5.  At OpenLayers 3.0, the old 
 *     syntax for creating classes and dealing with inheritance 
 *     will be removed.
 * 
 * To create a new OpenLayers-style class, use the following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(prototype);
 * (end)
 *
 * To create a new OpenLayers-style class with multiple inheritance, use the
 *     following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(Class1, Class2, prototype);
 * (end)
 * 
 * Note that instanceof reflection will only reveal Class1 as superclass.
 *
 *////<jscompress sourcefile="Hashtable.js" />
/**
 * 哈希表
 *////<jscompress sourcefile="BaseWidget.js" />

 //地图管理类
///<jscompress sourcefile="AppEvent.js" />
/**
 * 全局事件类，可以进行项目全局的监听和派发
 *////<jscompress sourcefile="DataManager.js" />
/**
 * 数据共享管理
 *////<jscompress sourcefile="BaseMapLayer.js" />
//天地图
///<jscompress sourcefile="GCJLayer.js" />
//国测局地图
///<jscompress sourcefile="TDTLayer.js" />
//天地图
///<jscompress sourcefile="ViewMap.js" />
/**
 * @class 地图浏览
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLayer.js" />
/**
 * @class 添加图层
 * @param {Object} classOption
 *////<jscompress sourcefile="SwitchMap.js" />
/**
 * @class 切换底图
 * @param {Object} classOption
 *////<jscompress sourcefile="AddCirclePoint.js" />
/**
 * @class 添加圆形点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLightPoint.js" />
/**
 * @class 添加高亮点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLine.js" />
/**
 * @class 添加折线
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPoint.js" />
/**
 * @class 添加图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPointList.js" />
/**
 * @class 添加一组图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPolygon.js" />
/**
 * @class 添加面
 * @param {Object} classOption
 *////<jscompress sourcefile="AddTextPoint.js" />
/**
 * @class 添加文字标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddComplexPoint.js" />
/**
 * @class 添加复合点位
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPoint.js" />
/**
 * @class 绘制点
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawCircle.js" />
/**
 * @class 绘制圆形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawLine.js" />
/**
 * @class 绘制折线
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPolygon.js" />
/**
 * @class 绘制多边形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawRect.js" />
/**
 * @class 绘制矩形
 * @param {Object} classOption
 *////<jscompress sourcefile="Measure.js" />
/**
 * @class 测量
 * @param {Object} classOption
 *////<jscompress sourcefile="AlwaysShowWindow.js" />
/**
 * @class 常显式气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="PopWindow.js" />
/**
 * @class 气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="Buffer.js" />
/**
 * @class 缓冲
 * @param {Object} classOption
 *////<jscompress sourcefile="ClearMap.js" />
/**
 * @class 清空地图
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertCoord.js" />
/**
 * @class 坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertEncryptCoord.js" />
/**
 * @class 加密坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="GetMapInformation.js" />
/**
 * @class 获取地图信息
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowCoordinate.js" />
/**
 * @class 显示地图坐标
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowZoomControl.js" />
/**
 * @class 显示地图放大缩小控制按钮
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowScale.js" />
/**
 * @class 显示比例尺
 * @param {Object} classOption
 *////<jscompress sourcefile="LocationToAddress.js" />
/**
 * @class 坐标转地址
 * @param {Object} classOption
 *////<jscompress sourcefile="PointCluster.js" />
/**
 * @class 点聚合分析
 * @param {Object} classOption
 *////<jscompress sourcefile="HeatMap.js" />
/**
 * @class 热力图分析
 * @param {Object} classOption
 *////<jscompress sourcefile="TrackPlay.js" />
/**
 * @class 轨迹回放
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayer.js" />
/**
 * @class 查询（查询对象为发布的图层服务）
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByRect.js" />
/**
 * @class 拉框查询（查询对象为发布的图层服务）
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByPointBuffer.js" />
/**
 * @class 点缓冲查询（查询对象为发布的图层服务）
 * @param {Object} classOption
 *////<jscompress sourcefile="BufferSelect.js" />
/**
 * @class 点缓冲选择查询，（查询在面中的点，查询对象为一组点数据）
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawSelect.js" />
/**
 * @class 画图（矩形、圆形、多边形）选择查询，默认绘制矩形（查询在面中的点，查询对象为一组点数据）
 * @param {Object} classOption
 *////<jscompress sourcefile="PointSelect.js" />
/**
 * @class 点选查询（查询点选中的图形，查询对象为调用接口添加的图形）
 * @param {Object} classOption
 *////<jscompress sourcefile="PolygonSelect.js" />
/**
 * @class 面选择查询（查询在面中的点，查询对象为一组点数据）
 * @param {Object} classOption
 */RMap.Class=function(){var b=arguments.length,a=arguments[0],f=arguments[b-1],m="function"==typeof f.initialize?f.initialize:function(){a.prototype.initialize.apply(this,arguments)};1<b?(b=[m,a].concat(Array.prototype.slice.call(arguments).slice(1,b-1),f),RMap.inherit.apply(null,b)):m.prototype=f;return m};RMap.inherit=function(b,a){var f=function(){};f.prototype=a.prototype;b.prototype=new f;var m,g,f=2;for(m=arguments.length;f<m;f++)g=arguments[f],"function"===typeof g&&(g=g.prototype),RMap.extend(b.prototype,g)};RMap.extend=function(b,a){b=b||{};if(a){for(var f in a){var m=a[f];void 0!==m&&(b[f]=m)}"function"==typeof window.Event&&a instanceof window.Event||!a.hasOwnProperty||!a.hasOwnProperty("toString")||(b.toString=a.toString)}return b};RMap.Hashtable=function(){var b=[];this.add=function(a,f){for(var m=!1,g=0;g<b.length;g++)b[g][0]==a&&(b[g][1]=f,m=!0);0==m&&b.push([a,f])};this.get=function(a){for(var f=0;f<b.length;f++)if(b[f][0]==a)return b[f][1];return null};this.foreach=function(a){for(var f=0;f<b.length;f++)a(b[f][0],b[f][1])};this.remove=function(a){for(var f=0;f<b.length;f++)b[f][0]==a&&b.splice(f,1)};this.clear=function(){}};RMap.BaseWidget=RMap.Class({initialize:function(){},map:null});RMap.AppEvent=function(){this.clearMap="tools_clearMap";this.clearDrawMeasure="clearDrawMeasure";this.clearQueryResult="clearQueryResult";this.clearHightLight="clearHightLight";this.addShareData="dataManager_addShareData";this.getShareData="dataManager_getShareData";this.removeShareData="dataManager_removeShareData";this.onShareDataChange="dataManager_onShareDataChange";var b=document.createElement("a");this.dispatch=function(a,f,m){var g=document.createEvent("Event");g.initEvent(a,f,m);b.dispatchEvent(g)};this.on=function(a,f){b.addEventListener(a,f)}};RMap.AppCoord=function(b){function a(a,d){var c=n(a,d);return g(c.lng,c.lat)}function f(a,d){var c=m(a,d);return l(c.lng,c.lat)}function m(a,z){var p=h(a-105,z-35),b=e(a-105,z-35),f=z/180*c,n=Math.sin(f),n=1-k*n*n,g=Math.sqrt(n),p=180*p/(d*(1-k)/(n*g)*c),b=180*b/(d/g*Math.cos(f)*c);return{lng:a+b,lat:z+p}}function g(a,z){var p=h(a-105,z-35),b=e(a-105,z-35),f=z/180*c,n=Math.sin(f),n=1-k*n*n,g=Math.sqrt(n),p=180*p/(d*(1-k)/(n*g)*c),b=180*b/(d/g*Math.cos(f)*c);return{lng:2*a-(a+b),lat:2*z-(z+p)}}function l(a,d){var c=Math.sqrt(a*a+d*d)+2E-5*Math.sin(d*p),e=Math.atan2(d,a)+3E-6*Math.cos(a*p);return{lng:c*Math.cos(e)+.0065,lat:c*Math.sin(e)+.006}}function n(a,d){var c=a-.0065,e=d-.006,k=Math.sqrt(c*c+e*e)-2E-5*Math.sin(e*p),c=Math.atan2(e,c)-3E-6*Math.cos(c*p);return{lng:k*Math.cos(c),lat:k*Math.sin(c)}}function h(a,d){var e=-100+2*a+3*d+.2*d*d+.1*a*d+.2*Math.sqrt(Math.abs(a)),e=e+2*(20*Math.sin(6*a*c)+20*Math.sin(2*a*c))/3,e=e+2*(20*Math.sin(d*c)+40*Math.sin(d/3*c))/3;return e+=2*(160*Math.sin(d/12*c)+320*Math.sin(d*c/30))/3}function e(a,d){var e=300+a+2*d+.1*a*a+.1*a*d+.1*Math.sqrt(Math.abs(a)),e=e+2*(20*Math.sin(6*a*c)+20*Math.sin(2*a*c))/3,e=e+2*(20*Math.sin(a*c)+40*Math.sin(a/3*c))/3;return e+=2*(150*Math.sin(a/12*c)+300*Math.sin(a/30*c))/3}this.reSetCoordinate=function(d,e,c){d=void 0==d||void 0==e||null==d||null==e||NaN==d||NaN==e?null:{lng:Number(d),lat:Number(e)};"wgs84"!=c&&"gcj02"!=c&&"bd09"!=c&&(c=b?b:"wgs84");if("wgs84"==c){var k=d.lng,p=d.lat,h;"wgs84"==RMap.baseMapType?h={lng:k,lat:p}:"bd09"==RMap.baseMapType?h=f(k,p):"gcj02"==RMap.baseMapType&&(h=m(k,p));d=h}else"gcj02"==c?(h=d.lng,p=d.lat,"wgs84"==RMap.baseMapType?newCoord=k=g(h,p):"bd09"==RMap.baseMapType?k=l(h,p):"gcj02"==RMap.baseMapType&&(k={lng:h,lat:p}),d=k):"bd09"==c&&(h=d.lng,k=d.lat,"wgs84"==RMap.baseMapType?p=a(h,k):"bd09"==RMap.baseMapType?p={lng:h,lat:k}:"gcj02"==RMap.baseMapType&&(p=n(h,k)),d=p);return d};this.reSetCoordinate_out=function(d,c,e){"wgs84"!=e&&"gcj02"!=e&&"bd09"!=e&&(e=b?b:"wgs84");d={lng:d,lat:c};if("wgs84"==e){var k=d.lng,p=d.lat,h;"wgs84"==RMap.baseMapType?h={lng:k,lat:p}:"bd09"==RMap.baseMapType?(h=a(k,p),h={lng:h.lng,lat:h.lat}):"gcj02"==RMap.baseMapType&&(h=g(k,p),h={lng:h.lng,lat:h.lat});h.proj="wgs84";d=h}else"gcj02"==e?(h=d.lng,p=d.lat,"wgs84"==RMap.baseMapType?(h=m(h,p),k={lng:h.lng,lat:h.lat}):"bd09"==RMap.baseMapType?(h=n(h,p),k={lng:h.lng,lat:h.lat}):"gcj02"==RMap.baseMapType&&(k={lng:h,lat:p}),k.proj="gcj02",d=k):"bd09"==e&&(h=d.lng,k=d.lat,"wgs84"==RMap.baseMapType?(h=f(h,k),p={lng:h.lng,lat:h.lat}):"bd09"==RMap.baseMapType?p={lng:h,lat:k}:"gcj02"==RMap.baseMapType&&(h=l(h,k),p={lng:h.lng,lat:h.lat}),p.proj="bd09",d=p);return d};var c=3.141592653589793,d=6378245,k=.006693421622965943,p=3E3*c/180;this.convert_bd09_To_gps84=function(d,e){return a(d,e)};this.convert_gps84_To_bd09=function(d,a){return f(d,a)};this.convert_gps84_To_gcj02=function(d,a){return m(d,a)};this.convert_gcj02_To_gps84=function(d,a){return g(d,a)};this.convert_gcj02_To_bd09=function(d,a){return l(d,a)};this.convert_bd09_To_gcj02=function(d,a){return n(d,a)}};RMap.DataManager=function(b){function a(a){l.add(a.key,a.value);g.dispatch(g.onShareDataChange,{key:a.key,value:a.value})}function f(a,h){var e=l.get(a);h&&h(e)}function m(a){l.remove(a)}var g=b.appEvent,l=new RMap.Hashtable;this.init=function(){g.on(g.addShareData,a);g.on(g.getShareData,f);g.on(g.removeShareData,m)}};RMap.config=ResourceListConfig;RMap.Map=function(b,a){function f(d){var a=d.type||"TDT_ArcGISCache",e=d.name||"",c=d.url||"{srciptUrl}/map/TDTSL/_alllayers";if(void 0==c||null==c)c=void 0;else if(-1!=c.search("{srciptUrl}")){var h=RMap.scriptLocation.split("/"),b=h[0];if(".."==b)for(var f=0;f<h.length-2;f++)b+="/..";else b=h[0]+"//"+h[2];c=c.replace("{srciptUrl}",b)}var n;switch(a){case "OnLineMap":a=new RMap.BaseMapLayer;n=a.OnLineMap(d);break;case "TDT_ArcGISCache":a=new RMap.TDTLayer;n=a.ArcGISTileLayer(c,e);break;case "GCJ_ArcGISCache":a=new RMap.GCJLayer;n=a.ArcGISTileLayer(c,e);break;case "ArcGISTiledMapLayer":a=new RMap.BaseMapLayer;n=a.ArcGISTiledMapLayer(d);break}return n}var m=RMap.scriptUrl.split("?");if(m&&1<m.length)for(var g=m[1].split("\x26"),m=0;m<g.length;m++){var l=g[m].split("\x3d");"key"==l[0]&&(RMap.config.license||(RMap.config.license=[]),RMap.config.license.push(l[1].toString()))}for(var n="EPSG:4326",g=function(){for(var d=RMap.extend({center:RMap.config.center,zoom:RMap.config.zoom,extent:RMap.config.extent,minZoom:RMap.config.minZoom,maxZoom:RMap.config.maxZoom,type:["GDSL_OL"]},a),c=0;c<d.type.length;c++)if("TDTSL"==d.type[c]||"TDTYX"==d.type[c])n="EPSG:4326",RMap.baseMapType="wgs84";else if("BDSL"==d.type[c]||"BDYX"==d.type[c])n="EPSG:102113",RMap.baseMapType="bd09";else if("GDSL"==d.type[c]||"GDYX"==d.type[c])n="EPSG:102113",RMap.baseMapType="gcj02";else if("GGSL"==d.type[c]||"GGYX"==d.type[c])n="EPSG:102113",RMap.baseMapType="gcj02";else if("TDTSL_OL"==d.type[c]||"TDTYX_OL"==d.type[c])n="EPSG:3857",RMap.baseMapType="wgs84";else if("BDSL_OL"==d.type[c])n="EPSG:3857",RMap.baseMapType="gcj02";else if("GDSL_OL"==d.type[c]||"GGSL_OL"==d.type[c]||"GGSL_OL"==d.type[c]||"GGDEM_OL"==d.type[c]||"GGYX_OL"==d.type[c])n="EPSG:3857",RMap.baseMapType="gcj02";return d}(),h=RMap.config.baseLayer,l=[],e,m=0;m<h.length;m++)for(var c=h[m],d=0;d<g.type.length;d++)c.name==g.type[d]&&(c.ESPG&&(n="EPSG:"+c.ESPG,RMap.sysProjection=n),e=f(h[m]),e.eachLayer(function(d){RMap.baseLayerList.push(d)}),0==d&&l.push(e));m=new RMap.AppCoord(g.proj);h=m.reSetCoordinate(g.center[0],g.center[1],g.proj);g.center[0]=h.lat;g.center[1]=h.lng;if(null==RMap.crs||void 0==RMap.crs)RMap.crs=L.CRS.EPSG3857;g=L.map(b,{crs:RMap.crs,center:g.center,zoom:g.zoom,layers:l,zoomControl:!1,closePopupOnClick:!1});L.control.zoom({zoomInTitle:"\u653e\u5927",zoomOutTitle:"\u7f29\u5c0f"}).addTo(g);l=new RMap.AppEvent;(new RMap.DataManager({appEvent:l})).init();return new RMap.InterfaceManager({map:g,appEvent:l,appConfig:RMap.config,appCoord:m})};RMap.InterfaceManager=function(b){var a=new RMap.View.ViewMap(b);this.center=a.center;this.zoom=a.zoom;this.centerZoom=a.centerZoom;this.extent=a.extent;this.extentByData=a.extentByData;a=new RMap.Layer.SwitchMap(b);a.init();this.switchMap=a.switchMap;a=new RMap.Layer.AddLayer(b);a.init();this.addLayer=a.addLayer;this.removeLayer=a.removeLayer;a=new RMap.Tools.Buffer(b);a.init();this.bufferPoint=a.bufferPoint;this.removeBuffer=a.removeBuffer;a=new RMap.Graphic.AddPolygon(b);a.init();this.addPolygon=a.addPolygon;this.removePolygon=a.removePolygon;a=new RMap.Graphic.AddLine(b);a.init();this.addLine=a.addLine;this.removeLine=a.removeLine;a=new RMap.InfoWindow.PopWindow(b);a.init();this.showPopWindow=a.showPopWindow;this.hidePopWindow=a.hidePopWindow;a=new RMap.InfoWindow.AlwaysShowWindow(b);a.init();this.addAlwaysShowWindow=a.addAlwaysShowWindow;this.removeAlwaysShowWindow=a.removeAlwaysShowWindow;a=new RMap.Draw.DrawCircle(b);a.init();this.drawCircle=a.drawCircle;this.removeDrawCircle=a.removeDrawCircle;a=new RMap.Draw.DrawRect(b);a.init();this.drawRect=a.drawRect;this.removeDrawRect=a.removeDrawRect;a=new RMap.Draw.DrawPolygon(b);a.init();this.drawPolygon=a.drawPolygon;this.removeDrawPolygon=a.removeDrawPolygon;a=new RMap.Draw.DrawLine(b);a.init();this.drawLine=a.drawLine;this.removeDrawLine=a.removeDrawLine;a=new RMap.Draw.DrawPoint(b);a.init();this.drawPoint=a.drawPoint;this.removeDrawPoint=a.removeDrawPoint;this.clearMap=(new RMap.Tools.ClearMap(b)).clearMap;this.convertCoord=(new RMap.Tools.ConvertCoord(b)).convertCoord;this.convertEncryptCoord=(new RMap.Tools.ConvertEncryptCoord(b)).convertEncryptCoord;a=new RMap.Tools.ShowCoordinate(b);a.init();this.showCoordinate=a.showCoordinate;this.hideCoordinate=a.hideCoordinate;a=new RMap.Tools.ShowZoomControl(b);a.init();this.showZoomControl=a.showZoomControl;this.hideZoomControl=a.hideZoomControl;a=new RMap.Tools.ShowScale(b);a.init();this.showScale=a.showScale;this.hideScale=a.hideScale;a=new RMap.Tools.GetMapInformation(b);a.init();this.getCoordinate=a.getCoordinate;this.stopGetCoordinate=a.stopGetCoordinate;this.getMapExtent=a.getMapExtent;this.getMapLevel=a.getMapLevel;a=new RMap.Tools.LocationToAddress(b);a.init();this.locationToAddress=a.locationToAddress;a=new RMap.Measure.Measure(b);a.init();this.measureLength=a.measureLength;this.measureArea=a.measureArea;this.measureCircle=a.measureCircle;this.measureRect=a.measureRect;this.removeMeasure=a.removeMeasure;a=new RMap.Control.PointCluster(b);a.init();this.addPointCluster=a.addPointCluster;this.removePointCluster=a.removePointCluster;a=new RMap.Control.HeatMap(b);a.init();this.addHeatMap=a.addHeatMap;this.removeHeatMap=a.removeHeatMap;a=new RMap.Control.TrackPlay(b);a.init();this.addTrackPlay=a.addTrackPlay;this.removeTrackPlay=a.removeTrackPlay;a=new RMap.Graphic.AddLightPoint(b);a.init();this.addLightPoint=a.addLightPoint;this.removeLightPoint=a.removeLightPoint;a=new RMap.Graphic.AddPoint(b);a.init();this.addPoint=a.addPoint;this.removePoint=a.removePoint;a=new RMap.Graphic.AddPointList(b);a.init();this.addPointList=a.addPointList;this.removePointList=a.removePointList;a=new RMap.Graphic.AddCirclePoint(b);a.init();this.addCirclePoint=a.addCirclePoint;this.removeCirclePoint=a.removeCirclePoint;a=new RMap.Graphic.AddTextPoint(b);a.init();this.addTextPoint=a.addTextPoint;this.removeTextPoint=a.removeTextPoint;a=new RMap.Graphic.AddComplexPoint(b);a.init();this.addComplexPoint=a.addComplexPoint;this.removeComplexPoint=a.removeComplexPoint;a=new RMap.Query.PointSelect(b);a.init();this.pointSelect=a.pointSelect;a=new RMap.Query.PolygonSelect(b);a.init();this.polygonSelect=a.polygonSelect;this.removePolygonSelect=a.removePolygonSelect;a=new RMap.Query.DrawSelect(b);a.init();this.drawSelect=a.drawSelect;this.removeDrawSelect=a.removeDrawSelect;a=new RMap.Query.BufferSelect(b);a.init();this.bufferSelect=a.bufferSelect;this.removeBufferSelect=a.removeBufferSelect;a=new RMap.Query.QueryLayer(b);a.init();this.queryLayer=a.queryLayer;this.removeQueryResult=a.removeQueryResult;a=new RMap.Query.QueryLayerByRect(b);a.init();this.queryLayerByRect=a.queryLayerByRect;b=new RMap.Query.QueryLayerByPointBuffer(b);b.init();this.queryLayerByPointBuffer=b.queryLayerByPointBuffer};RMap.BaseMapLayer=function(b){this.OnLineMap=function(a){var b=[];"GDSL_OL"==a.name&&(b=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b]));if("GDYX_OL"==a.name)var b=L.tileLayer.chinaProvider("GaoDe.Satellite.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),m=L.tileLayer.chinaProvider("GaoDe.Satellite.Annotion",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b,m]);"GEOQ_OL"==a.name&&(b=L.tileLayer.chinaProvider("Geoq.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b]));return b};this.ArcGISTiledMapLayer=function(a){a.EPSG&&a.resolutions?RMap.crs=new L.Proj.CRS("EPSG:"+a.EPSG,a.proj4,{origin:a.origin,resolutions:a.resolutions}):"3857"==a.EPSG&&void 0==a.resolutions&&(RMap.crs=L.CRS.EPSG3857);var b=[];a=L.esri.tiledMapLayer({url:a.url});return b=L.layerGroup([a])}};RMap.GCJLayer=function(b){var a=[156543.03392800014,78271.51696399994,39135.75848200009,19567.87924099992,9783.93962049996,4891.96981024998,2445.98490512499,1222.992452562495,611.4962262813797,305.74811314055756,152.87405657041106,76.43702828507324,38.21851414253662,19.10925707126831,9.554628535634155,4.77731426794937,2.388657133974685,1.1943285668550503,.5971642835598172,.29858214164761665,.14929107082380833,.07464553541190416];RMap.crs=new L.Proj.CRS("EPSG:102113","+proj\x3dmerc +lon_0\x3d0 +k\x3d1 +x_0\x3d0 +y_0\x3d0 +a\x3d6378137 +b\x3d6378137 +units\x3dm +no_defs",{origin:[-2.0037508342787E7,2.0037508342787E7],resolutions:a});this.ArcGISTileLayer=function(b,g){var l=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+g,continuousWorld:!0});l.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var h=a.z.toString(16).toUpperCase();return"L"+f(h,2)},x:function(){var h=a.y.toString(16).toUpperCase();return"R"+f(h,8)},y:function(){var h=a.x.toString(16).toUpperCase();return"C"+f(h,8)}}))};return L.layerGroup([l])};var f=function(a,b){for(var f=a.length;f<b;)a="0"+a,f++;return a}};RMap.TDTLayer=function(b){var a=[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.1457672119140625E-5,1.0728836059570312E-5,5.364418029785156E-6,2.682209014892578E-6,1.341104507446289E-6,6.705522537231445E-7,3.3527612686157227E-7];RMap.crs=new L.Proj.CRS("EPSG:4326","+proj\x3dlonglat +datum\x3dWGS84 +no_defs",{origin:[-180,90],resolutions:a});this.ArcGISTileLayer=function(b,g){var l=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+g,continuousWorld:!0});l.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var h=a.z.toString(16).toUpperCase();return"L"+f(h,2)},x:function(){var h=a.y.toString(16).toUpperCase();return"R"+f(h,8)},y:function(){var h=a.x.toString(16).toUpperCase();return"C"+f(h,8)}}))};return L.layerGroup([l])};var f=function(a,b){for(var f=a.length;f<b;)a="0"+a,f++;return a}};RMap.View.ViewMap=function(b){var a=b.map,f=b.appCoord;this.center=function(b,g,l){l=RMap.extend({proj:null},l);g=f.reSetCoordinate(b,g,l.proj);null==g?console.error("center\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=g.lng,g=g.lat,a.setView([Number(g),Number(b)]))};this.zoom=function(b){a.setZoom(b)};this.centerZoom=function(b,g,l,n){n=RMap.extend({proj:null},n);g=f.reSetCoordinate(b,g,n.proj);null==g?console.error("centerZoom\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=g.lng,g=g.lat,a.setView([Number(g),Number(b)],l))};this.extent=function(b,g,l,n,h){h=RMap.extend({proj:null},h);b=f.reSetCoordinate(b,g,h.proj);l=f.reSetCoordinate(l,n,h.proj);a.fitBounds([[b.lat,b.lng],[l.lat,l.lng]])};this.extentByData=function(b,g){g=RMap.extend({proj:null},g);for(var l=[],n=0;n<b.length;n++){var h=f.reSetCoordinate(b[n][0],b[n][1],g.proj);l[n]=[h.lat,h.lng]}l=L.polygon(l);a.fitBounds(l.getBounds())}};RMap.Layer.AddLayer=function(b){function a(a){f.eachLayer(function(b){if(b&&b.options.attribution){var h=b.options.attribution.split("|");if("addLayer"==h[0])if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var e=0;e<a.length;e++)h[1]==a[e]&&f.removeLayer(b)}else f.removeLayer(b)}})}var f=b.map,m=b.appEvent,g=b.appCoord;this.init=function(){m.on(m.clearMap,function(b){a()})};this.addLayer=function(a,b){b=RMap.extend({opacity:1},b);for(var h=RMap.config.thematicLayer,e=0;e<h.length;e++){var c=h[e];if(a==c.layerName){if("ArcGISRest"==c.layerType){var d=c,k=b;1==d.isQueryLayer?(k.where||(k.where="1\x3d1"),L.esri.featureLayer({url:d.url,opacity:k.opacity,where:k.where,attribution:"addLayer|"+d.layerName}).addTo(f)):L.esri.dynamicMapLayer({url:d.url,opacity:k.opacity,attribution:"addLayer|"+d.layerName}).addTo(f)}else"WFS_GeoServer"==c.layerType&&L.tileLayer.wms(c.url,{layers:c.typeName,format:"image/png",transparent:!0,opacity:b.opacity,attribution:"addLayer|"+c.layerName}).addTo(f);b.isCenter&&c.extent&&(d=g.reSetCoordinate(c.extent[0],c.extent[1]),c=g.reSetCoordinate(c.extent[2],c.extent[3]),f.fitBounds([[d.lat,d.lng],[c.lat,c.lng]]))}}};this.removeLayer=function(b){a(b)}};RMap.Layer.SwitchMap=function(b){var a=b.map,f=b.appEvent;this.init=function(){f.on(f.clearMap,function(a){})};this.switchMap=function(b){a.eachLayer(function(h){if(h&&h.options.layerName){var e=h.options.layerName.split("|");"BaseMap"==e[0]&&e[1]!=b&&a.removeLayer(h)}});for(var f=0;f<RMap.baseLayerList.length;f++){var l=RMap.baseLayerList[f],n=l.options.layerName.split("|");"BaseMap"==n[0]&&n[1]==b&&a.addLayer(l)}}};RMap.Graphic.AddCirclePoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=l.getLayers(),c=0;c<e.length;c++)a[b]==e[c].options.attribute.id&&l.removeLayer(e[c])}else l.clearLayers()}var f=b.map,m=b.appEvent,g=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addCirclePoint=function(a,b,e){e=RMap.extend({lng:Number(a),lat:Number(b),id:null,radius:3,color:"#3388ff",opacity:1,data:null,onClick:null,proj:null,properties:{lng:a,lat:b,option:e}},e);var c=g.reSetCoordinate(a,b,e.proj);if(null==c)console.error("addCirclePoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=c.lng,b=c.lat,a=L.divIcon({className:"my-lf-label-circle",iconSize:[2*e.radius,2*e.radius],html:'\x3cdiv style\x3d"width: '+2*e.radius+"px; height: "+2*e.radius+"px; border-radius: "+e.radius+"px; background-color: "+e.color+"; opacity: "+e.opacity+';"\x3e\x3c/div\x3e'}),c=L.marker([c.lat,c.lng],{icon:a,attribute:e}),l.addLayer(c),e.onClick)c.on("click",function(a){e.onClick(e)})};this.callbackFun_onClick=function(){};this.removeCirclePoint=function(b){a(b)}};RMap.Graphic.AddLightPoint=function(b){function a(a,c,d){d=RMap.extend({lng:a,lat:c,proj:null},d);if(null!=d.pic){var b=new Image;b.src=d.pic;b.onload=function(){d.imgWidth=b.width;d.imgHeight=b.height;f(d)}}else f(d)}function f(a){var c=n.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var d=L.icon.pulse({iconSize:[12,12],color:"red"}),c=L.marker([c.lat,c.lng],{icon:d}).addTo(g);a.pic&&(a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]),a=L.icon({iconUrl:a.pic,iconAnchor:a.anchor}),c.setIcon(a));h.addLayer(c);$(".leaflet-pulsing-icon").css("pointer-events","none")}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var d=h.getLayers(),b=0;b<d.length;b++)a[c]==d[b].options.attribute.id&&h.removeLayer(d[b])}else h.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){m()});l.on(l.clearHightLight,function(a){m()})};this.addLightPoint=function(e,c,d){l.dispatch(l.clearHightLight);m();a(e,c,d)};this.removeLightPoint=function(a){m(a);l.dispatch(l.clearHightLight)}};RMap.Graphic.AddLine=function(b){function a(a,c){c=RMap.extend({points:a,id:null,width:2,color:"#3388ff",opacity:1,style:"",isCenter:!1,isShowArrow:!1,data:null,onClick:null,proj:null,properties:{pointList:a,option:c}},c);for(var b=[],e=[],k=0;k<a.length;k++){var n=p.reSetCoordinate(a[k][0],a[k][1],c.proj);b[k]=[n.lat,n.lng];e[k]=[n.lng,n.lat]}n=L.polyline(b,{color:c.color,opacity:c.opacity,weight:c.width,attribute:c});y.addLayer(n);e=l(e);for(k=0;k<e.length;k++)if(e[k][2]&&0<e[k][2]){if((e[k-1][0]!=e[k][0]||e[k-1][1]!=e[k][1])&&e[k][4]==e[k][5]){var m=h(e[k-1],e[k],e[k][2],e[k][3]);f(m,c,e[k])}}else c.isShowArrow&&b[k-1]&&b[k]&&g([b[k-1],b[k]],y,c);if(c.onClick)n.on("click",function(a){a=a.latlng;a=p.reSetCoordinate_out(a.lng,a.lat);c.onClick({id:c.id,pointList:c.points,data:c.data,clickPosition:[a.lng,a.lat]})});1==c.isCenter&&d.fitBounds(n.getBounds())}function f(a,d,c){for(var e=[],b=0;b<a.length;b++)e[b]=[a[b][1],a[b][0]];e=L.polyline(e,{color:d.color,opacity:d.opacity,weight:d.width,attribute:d});y.addLayer(e);d.isShowArrow&&c[4]==c[5]&&(b=a[Math.floor(a.length/2)],a=a[Math.floor(a.length/2)+1],b=[b[1],b[0]],a=[a[1],a[0]],g([b,a],y,d,c[5].toString()));if(d.onClick)e.on("click",function(a){d.onClick(d)})}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var d=0;d<a.length;d++)for(var c=y.getLayers(),e=0;e<c.length;e++)a[d]==c[e].options.attribute.id&&y.removeLayer(c[e])}else y.clearLayers()}function g(a,d,c,e){for(var b=0;b<a.length-1;b++){var k=a[b],h=a[b+1],p=h[0]-k[0],f=h[1]-k[1],g=[(k[0]+h[0])/2,(k[1]+h[1])/2],k=180*Math.atan2(h[0]-k[0],h[1]-k[1])/Math.PI;-180<k&&0>k&&(k=360+k);h=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");k=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+h+'" style\x3d"transform:rotate(-'+k+'deg)"/\x3e'});k=L.marker(g,{icon:k,attribute:c});0==p&&0==f||d.addLayer(k);e&&(p=L.divIcon({className:"my-lf-label",iconSize:[20,20],html:e}),g=L.marker(g,{icon:p,attribute:c}),y.addLayer(g),$(".my-lf-label").css("text-align","center"),$(".my-lf-label").css("font-weight","bold"),$(".my-lf-label").css("font-size",15),$(".my-lf-label").css("font-family","\u5fae\u8f6f\u96c5\u9ed1"),$(".my-lf-label").css("color","#000"),$(".my-lf-label").css("text-shadow","#FFF 2px 0 0,#FFF 0 2px 0,#FFF -2px 0 0,#FFF 0 -2px 0"))}}function l(a){for(var d=[],c=0;c<a.length-1;c++)d[0]=a[0],n(a[c],a[c+1])||d.push(a[c+1]);for(a=0;a<d.length;a++)for(var e=c=0,b=0;b<a;b++){var k;k=d[a];var h=d[a-1],p=d[b],f=d[b-1];k=n(k,h)&&n(p,f)?!1:n(k,p)&&n(h,f)?!0:n(k,f)&&n(p,h)?!0:!1;k&&(d[a][2]=d[a][2]&&0<d[a][2]?d[a][2]+1:1,void 0==d[a][3]&&(n(d[a],d[b])?(d[a][3]=1,c++,d[a][4]=c):(d[a][3]=-1,e++,d[a][4]=e)),1==d[b][3]&&d[a][3]==d[b][3]?(c++,d[a][4]=c,d[b][5]=c):-1==d[b][3]&&d[a][3]==d[b][3]&&(e++,d[a][4]=e,d[b][5]=e),d[a][5]=d[a][4])}return d}function n(a,d){return void 0==a||void 0==d?!1:a[0]==d[0]&&a[1]==d[1]?!0:!1}function h(a,d,b,k){var h;k=b;k=1;b=[(a[0]+d[0])/2,(a[1]+d[1])/2];h=e(a,d);k=-k*h/10;h=90*Math.PI/180;h=c(a,b)-h;h=[b[0]+k*Math.cos(h),b[1]+k*Math.sin(h)];b=[(a[0]+d[0])/2,(a[1]+d[1])/2];k=[(a[0]+h[0])/2,(a[1]+h[1])/2];var p=[b[0]-a[1]+d[1],b[1]+a[0]-d[0]],f=[k[0]-a[1]+h[1],k[1]+a[0]-h[0]];b[1]==p[1]?(f=(f[0]-k[0])/(f[1]-k[1]),p=f*(b[1]-k[1])+k[0],k=b[1]):k[1]==f[1]?(p=(p[0]-b[0])/(p[1]-b[1]),p=p*(k[1]-b[1])+b[0],k=k[1]):(p=(p[0]-b[0])/(p[1]-b[1]),f=(f[0]-k[0])/(f[1]-k[1]),k=(p*b[1]-b[0]-f*k[1]+k[0])/(p-f),p=p*k-p*b[1]+b[0]);b=[p,k];k=e(a,b);p=c(a,b);f=c(d,b);(h[1]-a[1])*(d[0]-a[0])>(d[1]-a[1])*(h[0]-a[0])?(a=f,h=p):(a=p,h=f);var g;d=[];p=h-a;p=0>p?p+2*Math.PI:p;for(f=0;100>=f;f++)g=a+p*f/100,h=b[0]+k*Math.cos(g),g=b[1]+k*Math.sin(g),d.push([h,g]);return d}function e(a,d){return Math.sqrt(Math.pow(a[0]-d[0],2)+Math.pow(a[1]-d[1],2))}function c(a,d){var c,b=Math.asin(Math.abs(d[1]-a[1])/e(a,d));d[1]>=a[1]&&d[0]>=a[0]?c=b+Math.PI:d[1]>=a[1]&&d[0]<a[0]?c=2*Math.PI-b:d[1]<a[1]&&d[0]<a[0]?c=b:d[1]<a[1]&&d[0]>=a[0]&&(c=Math.PI-b);return c}var d=b.map,k=b.appEvent,p=b.appCoord,y;this.init=function(){y=L.layerGroup().addTo(d);k.on(k.clearMap,function(a){m()})};this.addLine=function(d,c){a(d,c)};this.callbackFun_onClick=function(){};this.removeLine=function(a){m(a)}};RMap.Graphic.AddPoint=function(b){function a(a,c,d){d=RMap.extend({lng:a,lat:c,id:null,isCenter:!1,tooltip:null,tooltipDirection:"auto",data:null,onClick:null,onMouseOver:null,onMouseOut:null,onTooltipOpen:null,proj:null,properties:{lng:a,lat:c,option:d}},d);if(null!=d.pic){var b=new Image;b.src=d.pic;b.onload=function(){d.imgWidth=b.width;d.imgHeight=b.height;f(d)}}else f(d)}function f(a){var c=n.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{c=L.marker([c.lat,c.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var d=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});c.setIcon(d)}h.addLayer(c);if(a.onClick)c.on("click",function(d){a.onClick(a)});if(a.onMouseOver)c.on("mouseover",function(d){a.onMouseOver(a)});if(a.onMouseOut)c.on("mouseout",function(d){a.onMouseOut(a)});if(a.onTooltipOpen)c.on("tooltipopen",function(d){a.onTooltipOpen(a)});a.tooltip&&c.bindTooltip(a.tooltip,{direction:a.tooltipDirection})}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var d=h.getLayers(),b=0;b<d.length;b++)a[c]==d[b].options.attribute.id&&h.removeLayer(d[b])}else h.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){m()})};this.addPoint=function(b,c,d){a(b,c,d)};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.callbackFun_onMouseOut=function(){};this.callbackFun_onTooltipOpen=function(){};this.removePoint=function(a){m(a)}};RMap.Graphic.AddPointList=function(b){function a(a){a=RMap.extend(null,a);if(null!=a.pic){var c=new Image;c.src=a.pic;c.onload=function(){a.imgWidth=c.width;a.imgHeight=c.height;f(a)}}else f(a)}function f(a){var c=n.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{c=L.marker([c.lat,c.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var d=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});c.setIcon(d)}h.addLayer(c);var b={id:a.id,lng:a.lng,lat:a.lat,data:a.data};if(a.onClick)c.on("click",function(d){a.onClick(b)});if(a.onMouseOver)c.on("mouseover",function(d){a.onMouseOver(b)})}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var d=h.getLayers(),b=0;b<d.length;b++)a[c]==d[b].options.attribute.id&&h.removeLayer(d[b])}else h.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){m()})};this.addPointList=function(b,c){c=RMap.extend({id:null,attrPic:null,lngField:"lng",latField:"lat",isCenter:!1,data:null,onClick:null,onMouseOver:null,proj:null},c);for(var d=eval("("+b+")"),k=[],h=0;h<d.length;h++){var f=d[h];c.lng=f[c.lngField];c.lat=f[c.latField];c.data=f;if(null!=c.attrPic)for(var l=0;l<c.attrPic.length;l++){var m=c.attrPic[l];f[m.field]==m.value&&(c.pic=m.pic)}a(c);c.isCenter&&(f=n.reSetCoordinate(c.lng,c.lat,c.proj),k.push([f.lat,f.lng]))}c.isCenter&&(d=L.polygon(k),g.fitBounds(d.getBounds()))};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.removePointList=function(a){m(a)}};RMap.Graphic.AddPolygon=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=l.getLayers(),c=0;c<e.length;c++)a[b]==e[c].options.attribute.id&&l.removeLayer(e[c])}else l.clearLayers()}var f=b.map,m=b.appEvent,g=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addPolygon=function(a,b){b=RMap.extend({pointList:a,id:null,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5,outLineStyle:"",color:"#3388ff",opacity:.3,data:null,isCenter:!1,onClick:null,proj:null,properties:{pointList:a,option:b}},b);var e=[];if("[object Array]"==Object.prototype.toString.call(a[0][0][0]))for(var c=0;c<a.length;c++){e[c]=[];for(var d=0;d<a[c].length;d++){e[c][d]=[];for(var k=0;k<a[c][d].length;k++){var p=g.reSetCoordinate(a[c][d][k][0],a[c][d][k][1],b.proj),p=[p.lat,p.lng];e[c][d][k]=p}}}else for(c=0;c<a.length;c++)p=g.reSetCoordinate(a[c][0],a[c][1],b.proj),p=[p.lat,p.lng],e[c]=p;e=L.polygon(e,{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity,attribute:b});l.addLayer(e);if(b.onClick)e.on("click",function(a){a=a.latlng;a=g.reSetCoordinate_out(a.lng,a.lat);b.onClick({id:b.id,pointList:b.pointList,data:b.data,clickPosition:[a.lng,a.lat]})});1==b.isCenter&&f.fitBounds(e.getBounds())};this.callbackFun_onClick=function(){};this.removePolygon=function(b){a(b)}};RMap.Graphic.AddTextPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var c=l.getLayers(),d=0;d<c.length;d++)a[b]==c[d].options.attribute.id&&l.removeLayer(c[d])}else l.clearLayers()}var f=b.map,m=b.appEvent,g=b.appCoord,l,n=0;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addTextPoint=function(a,b,c,d){var k={lng:Number(a),lat:Number(b),txt:c,id:null,color:0,offsetX:0,offsetY:0,font_weight:"bold",font_size:"16px",font_family:"\u5fae\u8f6f\u96c5\u9ed1",data:null,onClick:null,proj:null,properties:{lng:a,lat:b,option:d}};c="my-lf-label";d&&(d.color||d.offsetX||d.offsetY||d.font_weight||d.font_size||d.font_family)&&(n++,c+=n);d=RMap.extend(k,d);k=g.reSetCoordinate(a,b,d.proj);if(null==k)console.error("addTextPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=k.lng,b=k.lat,a=L.divIcon({className:c,iconSize:[100,24],html:d.txt}),a=L.marker([k.lat,k.lng],{icon:a,attribute:d}),l.addLayer(a),$("."+c).css("text-align","center"),$("."+c).css("font-weight",d.font_weight),$("."+c).css("font-size",d.font_size),$("."+c).css("font-family",d.font_family),$("."+c).css("color",d.color),$("."+c).css("top",d.offsetX),$("."+c).css("left",d.offsetY),d.onClick)a.on("click",function(a){d.onClick({lng:d.lng,lat:d.lat,txt:d.txt,data:d.data,id:d.id})})};this.callbackFun_onClick=function(){};this.removeTextPoint=function(b){a(b)}};RMap.Graphic.AddComplexPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var c=l.getLayers(),d=0;d<c.length;d++)a[b]==c[d].options.attribute.id&&l.removeLayer(c[d])}else l.clearLayers()}var f=b.map,m=b.appEvent,g=b.appCoord,l,n=0;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addComplexPoint=function(a,b,c,d){d=RMap.extend({lng:Number(a),lat:Number(b),id:null,width:0,height:0,offsetX:0,offsetY:0,data:null,onClick:null,proj:null,properties:{lng:a,lat:b,option:d}},d);var k=g.reSetCoordinate(a,b,d.proj);if(null==k)console.error("addComplexPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=k.lng,b=k.lat,n++,a="my-lf-label-complex"+n,c=L.divIcon({className:a,iconSize:[d.width,d.height],html:c}),k=L.marker([k.lat,k.lng],{icon:c,attribute:d}),l.addLayer(k),$("."+a).css("left",d.offsetX),$("."+a).css("top",d.offsetY),d.onClick)k.on("click",function(a){d.onClick({lng:d.lng,lat:d.lat,data:d.data,id:d.id})})};this.callbackFun_onClick=function(){};this.removeComplexPoint=function(b){a(b)}};RMap.Draw.DrawPoint=function(b){function a(b){e++;b.layer.drawId=void 0!=h.id||null!=h.id?h.id:"DrawPoint"+e;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;d.addLayer(b.layer);b=b.layer;if(h.callback){var c=n.reSetCoordinate_out(b._latlng.lng,b._latlng.lat);b={id:b.drawId,lng:c.lng.toFixed(6),lat:c.lat.toFixed(6)};h.callback(b)}g.off(L.Draw.Event.CREATED,a)}function f(d,b,e){h=b=RMap.extend(e,b);g.off(L.Draw.Event.CREATED,a);g.on(L.Draw.Event.CREATED,a);c.addHooks();b.pic&&(b.anchor||(b.anchor=[b.imgWidth/2,b.imgHeight/2]),d=L.icon({iconUrl:b.pic,iconAnchor:b.anchor}),c.options.shapeOptions=RMap.extend(c.options.icon,d));L.Handler.prototype.enable.call(c);c.fire("enabled",{handler:c.type});c._map.fire(L.Draw.Event.DRAWSTART,{layerType:c.type})}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var c=d.getLayers(),e=0;e<c.length;e++)a[b]==c[e].drawId&&d.removeLayer(c[e])}else d.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h,e=0,c=new L.Draw.Marker(g),d;this.init=function(){d=(new L.FeatureGroup).addTo(g);l.on(l.clearMap,function(a){m()});l.on(l.clearDrawMeasure,function(a){m()})};this.drawPoint=function(a,d){var b={id:null,callback:a};L.drawLocal.draw.handlers.marker.tooltip.start="\u5728\u5730\u56fe\u4e0a\u6807\u8bb0\u70b9\u4f4d\uff08\u6309Esc\u53d6\u6d88\uff09";if(d&&null!=d.pic){var c=new Image;c.src=d.pic;c.onload=function(){d.imgWidth=c.width;d.imgHeight=c.height;f(a,d,b)}}else f(a,d,b)};this.callbackFun_callback=function(){};this.removeDrawPoint=function(a){m(a)}};RMap.Draw.DrawCircle=function(b){function a(b){c++;b.layer.drawId=void 0!=e.id||null!=e.id?e.id:"DrawCircle"+c;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;p.addLayer(b.layer);b=b.layer;if(e.callback){var k=n.reSetCoordinate_out(b.getBounds()._southWest.lng,b.getBounds()._southWest.lat),l=n.reSetCoordinate_out(b.getBounds()._northEast.lng,b.getBounds()._northEast.lat),l=[k.lng,k.lat,l.lng,l.lat],m=n.reSetCoordinate_out(b._latlng.lng,b._latlng.lat),k=g.getZoom();g.setZoom(RMap.config.maxZoom);var v=L.Circle.toPolygon(b,64,g),x=[],I=[m.lat,m.lng],t=b.getRadius()/L.CRS.Earth.R/(Math.PI/180),u=g.project([I[0]+t,I[1]]),C=g.project([I[0]-t,I[1]]),u=u.add(C).divideBy(2),u=g.unproject(u),u=[u.lat,u.lng],I=L.latLng([I[0]+t,I[1]]),t=L.latLng(u);I.distanceTo(t);I=u[0]-m.lat;for(t=0;t<v.length;t++)u=n.reSetCoordinate_out(v[t].lng,v[t].lat+I),x[t]=[u.lng,u.lat];y.id=b.drawId;d.push(b.drawId);p.clearLayers();h.addPolygon(x,y);b={id:b.drawId,center:[m.lng,m.lat],radius:b.getRadius(),minPoint:[l[0],l[1]],maxPoint:[l[2],l[3]],extent:l,pointList:x};e.callback(b);f(k,RMap.config.maxZoom)}g.off(L.Draw.Event.CREATED,a)}function f(a,d){setTimeout(function(){g.getZoom()==d?g.setZoom(a):f(a,d)},10)}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var c=p.getLayers(),k=0;k<c.length;k++)a[b]==c[k].drawId&&p.removeLayer(c[k])}else for(p.clearLayers(),b=0;b<d.length;b++)h.removePolygon(d[b])}var g=b.map,l=b.appEvent,n=b.appCoord,h=new RMap.Graphic.AddPolygon(b),e,c=0,d=[],k=new L.Draw.Circle(g),p,y;this.init=function(){h.init();p=(new L.FeatureGroup).addTo(g);l.on(l.clearMap,function(a){m()});l.on(l.clearDrawMeasure,function(a){m()})};this.drawCircle=function(b,d){var c;c=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},d);y={outLineWidth:c.outLineWidth,outLineColor:c.outLineColor,outLineOpacity:c.outLineOpacity,outLineStyle:c.outLineStyle,opacity:c.opacity,color:c.color};e=c;g.off(L.Draw.Event.CREATED,a);g.on(L.Draw.Event.CREATED,a);k.addHooks();k.options.shapeOptions=RMap.extend(k.options.shapeOptions,{stroke:!0,color:c.outLineColor,weight:c.outLineWidth,opacity:c.outLineOpacity,fillColor:c.color,fillOpacity:c.opacity,showMeasurements:c.showMeasurements});L.Handler.prototype.enable.call(k);k.fire("enabled",{handler:k.type});k._map.fire(L.Draw.Event.DRAWSTART,{layerType:k.type})};this.callbackFun_callback=function(){};this.removeDrawCircle=function(a){m(a)}};RMap.Draw.DrawLine=function(b){function a(b){h++;b.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawLine"+h;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;c.addLayer(b.layer);b=b.layer;if(n.callback){for(var k=l.reSetCoordinate_out(b._bounds._southWest.lng,b._bounds._southWest.lat),e=l.reSetCoordinate_out(b._bounds._northEast.lng,b._bounds._northEast.lat),k=[k.lng,k.lat,e.lng,e.lat],e=b._latlngs,f=[],g=0;g<e.length;g++){var B=l.reSetCoordinate_out(e[g].lng,e[g].lat);f[g]=[B.lng,B.lat]}n.callback({id:b.drawId,minPoint:[k[0],k[1]],maxPoint:[k[2],k[3]],pointList:f,extent:k})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=c.getLayers(),f=0;f<e.length;f++)a[b]==e[f].drawId&&c.removeLayer(e[f])}else c.clearLayers()}var m=b.map,g=b.appEvent,l=b.appCoord,n,h=0,e=new L.Draw.Polyline(m),c;this.init=function(){c=(new L.FeatureGroup).addTo(m);g.on(g.clearMap,function(a){f()});g.on(g.clearDrawMeasure,function(a){f()})};this.drawLine=function(b,c){var f;n=f=RMap.extend({id:null,callback:b,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!1},c);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);e.addHooks();e.options.shapeOptions=RMap.extend(e.options.shapeOptions,{stroke:!0,color:f.color,weight:f.width,opacity:f.opacity,showMeasurements:f.showMeasurements});L.Handler.prototype.enable.call(e);e.fire("enabled",{handler:e.type});e._map.fire(L.Draw.Event.DRAWSTART,{layerType:e.type})};this.callbackFun_callback=function(){};this.removeDrawLine=function(a){f(a)}};RMap.Draw.DrawPolygon=function(b){function a(b){h++;b.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawPolygon"+h;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;c.addLayer(b.layer);b=b.layer;if(n.callback){for(var k=l.reSetCoordinate_out(b._bounds._southWest.lng,b._bounds._southWest.lat),e=l.reSetCoordinate_out(b._bounds._northEast.lng,b._bounds._northEast.lat),k=[k.lng,k.lat,e.lng,e.lat],e=b._latlngs[0],f=[],g=0;g<e.length;g++){var B=l.reSetCoordinate_out(e[g].lng,e[g].lat);f[g]=[B.lng,B.lat]}n.callback({id:b.drawId,minPoint:[k[0],k[1]],maxPoint:[k[2],k[3]],pointList:f,extent:k})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=c.getLayers(),f=0;f<e.length;f++)a[b]==e[f].drawId&&c.removeLayer(e[f])}else c.clearLayers()}var m=b.map,g=b.appEvent,l=b.appCoord,n,h=0,e=new L.Draw.Polygon(m),c;this.init=function(){c=(new L.FeatureGroup).addTo(m);g.on(g.clearMap,function(a){f()});g.on(g.clearDrawMeasure,function(a){f()})};this.drawPolygon=function(b,c){var f;n=f=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},c);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);e.addHooks();e.options.shapeOptions=RMap.extend(e.options.shapeOptions,{stroke:!0,color:f.outLineColor,weight:f.outLineWidth,opacity:f.outLineOpacity,fillColor:f.color,fillOpacity:f.opacity,showMeasurements:f.showMeasurements});L.Handler.prototype.enable.call(e);e.fire("enabled",{handler:e.type});e._map.fire(L.Draw.Event.DRAWSTART,{layerType:e.type})};this.callbackFun_callback=function(){};this.removeDrawPolygon=function(a){f(a)}};RMap.Draw.DrawRect=function(b){function a(b){h++;b.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawRect"+h;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;c.addLayer(b.layer);b=b.layer;if(n.callback){for(var k=l.reSetCoordinate_out(b._bounds._southWest.lng,b._bounds._southWest.lat),e=l.reSetCoordinate_out(b._bounds._northEast.lng,b._bounds._northEast.lat),k=[k.lng,k.lat,e.lng,e.lat],e=b._latlngs[0],f=[],g=0;g<e.length;g++){var B=l.reSetCoordinate_out(e[g].lng,e[g].lat);f[g]=[B.lng,B.lat]}n.callback({id:b.drawId,minPoint:[k[0],k[1]],maxPoint:[k[2],k[3]],pointList:f,extent:k})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=c.getLayers(),f=0;f<e.length;f++)a[b]==e[f].drawId&&c.removeLayer(e[f])}else c.clearLayers()}var m=b.map,g=b.appEvent,l=b.appCoord,n,h=0,e=new L.Draw.Rectangle(m),c;this.init=function(){c=(new L.FeatureGroup).addTo(m);g.on(g.clearMap,function(a){f()});g.on(g.clearDrawMeasure,function(a){f()})};this.drawRect=function(b,c){var f;n=f=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},c);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);e.addHooks();e.options.shapeOptions=RMap.extend(e.options.shapeOptions,{stroke:!0,color:f.outLineColor,weight:f.outLineWidth,opacity:f.outLineOpacity,fillColor:f.color,fillOpacity:f.opacity,showMeasurements:f.showMeasurements});L.Handler.prototype.enable.call(e);e.fire("enabled",{handler:e.type});e._map.fire(L.Draw.Event.DRAWSTART,{layerType:e.type})};this.callbackFun_callback=function(){};this.removeDrawRect=function(a){f(a)}};RMap.Measure.Measure=function(b){var a=b.appEvent,f=new RMap.Draw.DrawLine(b),m=new RMap.Draw.DrawRect(b),g=new RMap.Draw.DrawCircle(b),l=new RMap.Draw.DrawPolygon(b);this.init=function(){f.init();m.init();g.init();l.init()};this.measureLength=function(a){a=RMap.extend({id:null,callback:null,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!0},a);f.drawLine(null,a)};this.measureRect=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);m.drawRect(null,a)};this.measureCircle=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);g.drawCircle(null,a)};this.measureArea=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);l.drawPolygon(null,a)};this.removeMeasure=function(){a.dispatch(a.clearDrawMeasure)}};RMap.InfoWindow.AlwaysShowWindow=function(b){var a=b.map,f=b.appEvent,m=b.appCoord,g;new RMap.Graphic.AddLightPoint(b);this.init=function(){g=L.layerGroup().addTo(a);f.on(f.clearMap,function(a){doHidePopWindow()})};this.addAlwaysShowWindow=function(a,b,f,e){e=RMap.extend({proj:null},e);a=m.reSetCoordinate(a,b,e.proj);null==a?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=L.popup(),b.setLatLng([Number(a.lat),Number(a.lng)]),b.setContent(f),g.addLayer(b))};this.removeAlwaysShowWindow=function(){g.clearLayers()}};RMap.InfoWindow.PopWindow=function(b){function a(a){h&&n.removeLightPoint()}var f=b.map,m=b.appEvent,g=b.appCoord,l=L.popup(),n=new RMap.Graphic.AddLightPoint(b),h=!1;this.init=function(){n.init();m.on(m.clearMap,function(a){f.removeLayer(l)})};this.showPopWindow=function(b,c,d,k){k=RMap.extend({isCenter:!1,isHighLight:!1,autoPan:!0,proj:null},k);var p=g.reSetCoordinate(b,c,k.proj);null==p?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(k.isCenter&&f.setView([Number(p.lat),Number(p.lng)]),l=L.popup({autoPan:k.autoPan,maxWidth:2E3}),l.on("remove",a),l.setLatLng([Number(p.lat),Number(p.lng)]),l.setContent(d),l.openOn(f),(h=k.isHighLight)&&n.addLightPoint(b,c,k))};this.hidePopWindow=function(){f.removeLayer(l)}};RMap.Tools.Buffer=function(b){var a,f,m;function g(b,c,h,g){g=RMap.extend({outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.3,isCenter:!1,proj:null},g);b=Number(b);c=Number(c);h=Number(h);a=b;f=c;m=g;var r=d.reSetCoordinate(b,c,g.proj);if(null==r)console.error("bufferPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var x=L.circle([r.lat,r.lng],{radius:h});x.setStyle({stroke:!0,color:g.outLineColor,weight:g.outLineWidth,opacity:g.outLineOpacity,fillColor:g.color,fillOpacity:g.opacity});p.clearLayers();k.removePolygon("Buffer"+y);p.addLayer(x);var D=e.getZoom();if(e.dragging.enabled()){e.setZoom(RMap.config.maxZoom);var E=x.getBounds(),G=d.reSetCoordinate_out(E.getWest(),E.getSouth()),F=d.reSetCoordinate_out(E.getEast(),E.getNorth()),G=[G.lng,G.lat,F.lng,F.lat],F=L.Circle.toPolygon(x,64,e),x=[],A=[r.lat,r.lng],w=h/L.CRS.Earth.R/(Math.PI/180),J=e.project([A[0]+w,A[1]]),O=e.project([A[0]-w,A[1]]),J=J.add(O).divideBy(2),J=e.unproject(J),J=[J.lat,J.lng],A=L.latLng([A[0]+w,A[1]]),w=L.latLng(J);A.distanceTo(w);A=J[0]-r.lat;for(w=0;w<F.length;w++)r=d.reSetCoordinate_out(F[w].lng,F[w].lat+A),x[w]=[r.lng,r.lat];p.clearLayers();y++;g.id="Buffer"+y;k.addPolygon(x,g);r=[E.getEast(),(E.getSouth()+E.getNorth())/2];F=h;A="";A=1E4<=F?(F/1E3).toFixed(1)+"km":F.toFixed(0)+"m";F=L.marker([r[1],r[0]],{icon:L.icon({iconUrl:RMap.scriptLocation+"image/tuodong.png",iconAnchor:[17.8,10]})});p.addLayer(F);A=L.divIcon({className:"my-lf-label",iconSize:[50,20],html:A});r=L.marker([r[1],r[0]],{icon:A});p.addLayer(r);$(".my-lf-label").css("text-align","center");$(".my-lf-label").css("top",2);$(".my-lf-label").css("left",42);F.on("mousedown",v);F.on("mouseup",H);e.on("mouseup",H);b={id:g.id,pointList:x,extent:G,lat:c,lng:b,radius:h};B=g.callback;N=b;g.callback&&!z&&g.callback(b);1==g.isCenter?n(E,RMap.config.maxZoom):l(D,RMap.config.maxZoom)}}}function l(a,b){setTimeout(function(){e.getZoom()==b?e.setZoom(a):l(a,b)},10)}function n(a,b){setTimeout(function(){e.getZoom()==b?e.fitBounds(a):n(a,b)},10)}function h(){p.clearLayers();for(var a=0;a<=y;a++)k.removePolygon("Buffer"+y)}var e=b.map,c=b.appEvent,d=b.appCoord,k=new RMap.Graphic.AddPolygon(b),p,y=0;this.init=function(){k.init();p=L.layerGroup().addTo(e);c.on(c.clearMap,function(a){h()})};this.bufferPoint=function(a,b,c,d){z=!1;g(a,b,c,d)};this.callbackFun_onResult=function(){};this.removeBuffer=function(){h()};var z=!1;m=f=a=void 0;var B,N,H=function(a){e.dragging.enabled()||(e.dragging.enable(),x(a),B(N),console.log("end"));e.off("mousemove",x)},v=function(a){e.dragging.enabled()&&e.dragging.disable();z=!0;console.log("start");e.off("mousemove",x);e.on("mousemove",x)},x=function(b){var c=d.reSetCoordinate_out(b.latlng.lng,b.latlng.lat);b=[a,f];c=[c.lng,c.lat];b=d.reSetCoordinate(b[0],b[1]);c=d.reSetCoordinate(c[0],c[1]);b=L.latLng(b);c=L.latLng(c);b=b.distanceTo(c);g(a,f,b,m)}};RMap.Tools.ClearMap=function(b){var a=b.appEvent;this.clearMap=function(){a.dispatch(a.clearMap)}};RMap.Tools.ConvertCoord=function(b){this.convertCoord=function(a,b,m,g){m==g?a={lng:a,lat:b}:(m=new proj4.Proj(m.proj4),g=new proj4.Proj(g.proj4),a=proj4(m,g,[a,b]),a={lng:a[0],lat:a[1]});return a}};RMap.Tools.ConvertEncryptCoord=function(b){var a=b.appCoord;this.convertEncryptCoord=function(b,m,g,l){return g==l?{lng:b,lat:m}:"bd09"==g&&"wgs84"==l?a.convert_bd09_To_gps84(Number(b),Number(m)):"wgs84"==g&&"bd09"==l?a.convert_gps84_To_bd09(Number(b),Number(m)):"wgs84"==g&&"gcj02"==l?a.convert_gps84_To_gcj02(Number(b),Number(m)):"gcj02"==g&&"wgs84"==l?a.convert_gcj02_To_gps84(Number(b),Number(m)):"gcj02"==g&&"bd09"==l?a.convert_gcj02_To_bd09(Number(b),Number(m)):"bd09"==g&&"gcj02"==l?a.convert_bd09_To_gcj02(Number(b),Number(m)):null}};RMap.Tools.GetMapInformation=function(b){function a(a){k++;a.layer.drawId=void 0!=d.id||null!=d.id?d.id:"DrawPoint"+k;e.addLayer(a.layer);0<=d.showTime&&setTimeout(function(){e.removeLayer(a.layer)},d.showTime);f(a.layer)}function f(a){if(d.callback){var b=n.reSetCoordinate_out(a._latlng.lng,a._latlng.lat);a={id:a.drawId,lng:b.lng.toFixed(6),lat:b.lat.toFixed(6)};d.callback(a);0==d.repeatMode&&(c=null)}}function m(){c&&c.removeHooks();c=null;e.clearLayers();h&&(h.parentNode.removeChild(h),h=void 0)}var g=b.map,l=b.appEvent,n=b.appCoord,h,e,c,d,k=0;this.init=function(){e=(new L.FeatureGroup).addTo(g);l.on(l.clearMap,function(a){m()})};this.getCoordinate=function(b,k){c||(d={showTime:3E3,repeatMode:!0},d=RMap.extend(d,k),d.callback=b,g.off(L.Draw.Event.CREATED,a),g.on(L.Draw.Event.CREATED,a),c=new L.Draw.Marker(g),c.options.repeatMode=d.repeatMode,L.Handler.prototype.enable.call(c),c.fire("enabled",{handler:c.type}),c._map.fire(L.Draw.Event.DRAWSTART,{layerType:c.type}))};this.callbackFun_onResult=function(){};this.stopGetCoordinate=function(){m()};this.getMapExtent=function(){var a=g.getBounds(),b=n.reSetCoordinate_out(a._southWest.lng,a._southWest.lat),a=n.reSetCoordinate_out(a._northEast.lng,a._northEast.lat);return[b.lng,b.lat,a.lng,a.lat]};this.getMapLevel=function(){return g.getZoom()}};RMap.Tools.ShowCoordinate=function(b){function a(){var a="\u7ea7\u6570\uff1a"+l+"\uff0c\u7ecf\u5ea6\uff1a"+n.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+n.lat.toFixed(6),b="\u7ecf\u5ea6\uff1a"+n.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+n.lat.toFixed(6);h.innerHTML=a;g&&(g.innerHTML=b,helpTooltip.setPosition([n.lng,n.lat]),$(g).removeClass("hidden"))}var f=b.map,m=b.appCoord,g,l,n,h,e=!1;this.init=function(){h=document.createElement("label");h.style.position="absolute";h.style.bottom="10px";h.style.left="10px";n=m.reSetCoordinate_out(f.getCenter().lng,f.getCenter().lat);l=f.getZoom();f.on("zoom",function(b){l=f.getZoom();a()});f.on("mousemove",function(b){n=m.reSetCoordinate_out(b.latlng.lng,b.latlng.lat);l&&a()})};this.showCoordinate=function(a){a&&(a.top&&(h.style.bottom=null,h.style.top=a.top+"px"),a.bottom&&(h.style.top=null,h.style.bottom=a.bottom+"px"),a.left&&(h.style.right=null,h.style.left=a.left+"px"),a.right&&(h.style.left=null,h.style.right=a.right+"px"));h.style["z-index"]=99999;f.getContainer().appendChild(h);e=!0};this.hideCoordinate=function(){e&&(f.getContainer().removeChild(h),e=!1)}};RMap.Tools.ShowZoomControl=function(b){var a;this.init=function(){a=$(".leaflet-control-zoom.leaflet-bar.leaflet-control")};this.showZoomControl=function(b){a.css("display","block");a.css("margin-left",0);a.css("margin-top",0);a.css("position","absolute");$(".leaflet-control-zoom.leaflet-bar.leaflet-control").remove();b&&(b.top&&(a.css("bottom",""),a.css("top",b.top)),b.bottom&&(a.css("top",""),a.css("bottom",b.bottom)),b.left&&(a.css("right",""),a.css("left",b.left)),b.right&&(a.css("left",""),a.css("right",b.right)));$(".leaflet-control-container").append(a)};this.hideZoomControl=function(){a.css("display","none")}};RMap.Tools.ShowScale=function(b){var a=b.map,f;this.init=function(){};this.showScale=function(b){b=RMap.extend({metric:!0,imperial:!1,maxWidth:100},b);L.control.scale({metric:b.metric,imperial:b.imperial,maxWidth:b.maxWidth}).addTo(a);f=$(".leaflet-control-scale.leaflet-control");f.css("margin-left",0);f.css("margin-top",0);f.css("position","absolute");b&&(b.top&&(f.css("bottom",""),f.css("top",b.top)),b.bottom&&(f.css("top",""),f.css("bottom",b.bottom)),b.left&&(f.css("right",""),f.css("left",b.left)),b.right&&(f.css("left",""),f.css("right",b.right)));$(".leaflet-control-container").append(f)};this.hideScale=function(){f.css("display","none")}};RMap.Tools.LocationToAddress=function(b){var a=b.map,f=b.appEvent,m=b.appCoord;this.init=function(){L.layerGroup().addTo(a);f.on(f.clearMap,function(a){doRemoveBuffer()})};this.locationToAddress=function(a,b,f,h){a=m.convert_gps84_To_gcj02(Number(a),Number(b));console.log(a);$.ajax({url:ResourceListConfig.amapGeocodeUrl+"\x26location\x3d"+a.lng+","+a.lat+"\x26extensions\x3dall\x26batch\x3dfalse\x26roadlevel\x3d0",success:function(a){"DAILY_QUERY_OVER_LIMIT"==a.info?console.warn("\u8bbf\u95ee\u5df2\u8d85\u51fa\u65e5\u8bbf\u95ee\u91cf\uff01"):"ACCESS_TOO_FREQUENT"==a.info?console.warn("\u5355\u4f4d\u65f6\u95f4\u5185\u8bbf\u95ee\u8fc7\u4e8e\u9891\u7e41\uff01"):"OK"==a.info&&f({address:a.regeocode.formatted_address,province:a.regeocode.addressComponent.province,city:a.regeocode.addressComponent.city,district:a.regeocode.addressComponent.district,township:a.regeocode.addressComponent.township})},error:function(a){console.error(a)}})};this.callbackFun_onResult=function(){}};RMap.Control.PointCluster=function(b){function a(a,b){for(var k=0;k<a.length;k++){var e={};for(items in a[k])e[items]=a[k][items];a[k].attribute=e;null!=a[k].pic?f(a[k]):b.pic&&(e=RMap.extend(a[k],b),m(e))}if(b.onClick)h.on("click",function(a){b.onClick(a.layer.options.attribute)})}function f(a){var b=new Image;b.src=a.pic;b.onload=function(){a.imgWidth=b.width;a.imgHeight=b.height;m(a)}}function m(a){var b=n.reSetCoordinate(a.lng,a.lat);null==b?console.error("addPointCluster\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=L.marker([b.lat,b.lng],{attribute:a.attribute}),a.pic&&(a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]),a=L.icon({iconUrl:a.pic,iconAnchor:a.anchor}),b.setIcon(a)),h.addLayer(b))}var g=b.map,l=b.appEvent,n=b.appCoord,h,e;this.init=function(){e=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){e.clearLayers()})};this.addPointCluster=function(b,d){h=(new L.MarkerClusterGroup).addTo(g);e.addLayer(h);if(null!=d.pic){var k=new Image;k.src=d.pic;k.onload=function(){d.imgWidth=k.width;d.imgHeight=k.height;a(b,d)}}else a(b,d)};this.callbackFun_point=function(){};this.callbackFun_onClick=function(){};this.removePointCluster=function(a){e.clearLayers()}};RMap.Control.HeatMap=function(b){var a=b.map,f=b.appEvent,m=b.appCoord,g;this.init=function(){g=L.layerGroup().addTo(a);f.on(f.clearMap,function(a){doRemoveTrackPlay()})};this.addHeatMap=function(a,b){for(var f=[],e=0;e<a.length;e++){var c=m.reSetCoordinate(a[e].lng,a[e].lat);f.push([c.lat,c.lng,a[e].weight])}f=L.heatLayer(f,{radius:12,maxZoom:0});g.addLayer(f)};this.callbackFun_point=function(){};this.removeHeatMap=function(a){g.clearLayers()}};RMap.Control.TrackPlay=function(b){function a(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=[a[d][1],a[d][0]];d=L.polyline(c,{color:"#323232",opacity:.5,weight:b.width,data:b});b.isShowArrow&&m(c,z);if(b.onClick)d.on("click",function(a){b.onClick(b)});p.addLayer(d)}function f(){M&&(document.body.removeChild(D),M=!1);p.clearLayers();y.clearLayers();z.clearLayers();B.clearLayers();c.off("mousemove",P)}function m(a,b){for(var c=0;c<a.length-1;c++){var d=a[c],k=a[c+1],f=k[0]-d[0],e=k[1]-d[1],g=[(d[0]+k[0])/2,(d[1]+k[1])/2],d=180*Math.atan2(k[0]-d[0],k[1]-d[1])/Math.PI;-180<d&&0>d&&(d=360+d);k=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");d=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+k+'" style\x3d"transform:rotate(-'+d+'deg)"/\x3e'});g=L.marker(g,{icon:d});0==f&&0==e||b.addLayer(g)}}function g(a,b,d,c){O&&(window.clearTimeout(J),b.getLatLng(),b.setLatLng([c[1],c[0]]),O=!1);var k=[d[0]+(c[0]-d[0])*w/20,d[1]+(c[1]-d[1])*w/20];b.setLatLng([k[1],k[0]]);w++;20>=w&&(J=window.setTimeout(function(){g(a,b,d,c)},a/20))}function l(a,b){var d=180*Math.atan2(b[1]-a[1],b[0]-a[0])/Math.PI;-180<d&&0>d&&(d=360+d);$(".RotatedMarker").css("text-align","center");return L.divIcon({iconAnchor:r.trackPointAnchor,className:"RotatedMarker",html:'\x3cimg src\x3d"'+r.trackPointPic+'" style\x3d"transform:rotate(-'+d+'deg)"/\x3e'})}function n(a,b){for(var d=[],c=0;c<a.length;c++)d[c]=[a[c][1],a[c][0]];d=L.polyline(d,{color:b.color,opacity:b.opacity,weight:b.width,attribute:b});if(b.onClick)d.on("click",function(a){b.onClick(b)});y.addLayer(d)}function h(a){var b;b="\x3ctr class\x3d'tracktr'\x3e"+("\x3ctd style\x3d'width:140px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/span\x3e\x3c/td\x3e");b+="\x3ctd style\x3d'width:150px;'\x3e\x3ca id\x3d'trackListShowMapPoint' data-lng\x3d'"+a.lng+"' data-lat\x3d'"+a.lat+"' style\x3d'cursor:pointer;' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/a\x3e\x3c/td\x3e";b+="\x3ctd style\x3d'width:150px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.time+"'\x3e"+a.data.time+"\x3c/span\x3e\x3c/td\x3e";b+="\x3c/tr\x3e";$("#trackBody").after(b)}function e(){if(q.playing){var a=parseInt($(".j_curNum").text());a>=q.dataTotal+1&&--a;var b=q.slideBarW/q.dataTotal*a;$(".j_curNum").text(a+1);$(".sCur").stop().animate({width:b},q.speed,"linear");$(".sPoint").stop().animate({left:b},q.speed,"linear",function(){b<q.slideBarW?e():q.pause()});q.callback&&q.callback(parseInt($(".j_curNum").text())-1)}}var c=b.map,d=b.appEvent,k=b.appCoord,p,y,z,B,N,H=[],v=[],x=[],I=800,t=0,u=0,C=!1,r,M=!1,D,E=[],G="#02EE82 #0C7FF8 #D12DF7 #FF0000 #F5DF26 #91F90A".split(" "),F=L.icon({iconUrl:RMap.scriptLocation+"image/trackStart.png",iconAnchor:[13.5,39]}),A=L.icon({iconUrl:RMap.scriptLocation+"image/trackEnd.png",iconAnchor:[13.5,39]});this.init=function(){p=L.layerGroup().addTo(c);y=L.layerGroup().addTo(c);z=L.layerGroup().addTo(c);B=L.layerGroup().addTo(c);N=L.layerGroup();d.on(d.clearMap,function(a){f()})};this.addTrackPlay=function(b,d){p.clearLayers();y.clearLayers();z.clearLayers();B.clearLayers();E=[];u=0;H=[];v=[];x=[];c.on("mousemove",P);for(var f=[b],e=0;e<f.length;e++){var g={id:null,width:2,color:0,style:"",isCenter:!1,isShowArrow:!1,isShowTime:!1,showTimeKey:"time",trackPointPic:RMap.scriptLocation+"image/trackPoint.png",trackPointAnchor:[15.5,9],speed:800,data:null,onClick:null};d.speed&&(I=d.speed,q.speed=d.speed);d=RMap.extend(g,d);d.color=G[e%6];r=d;var m=f[e],g=RMap.extend(g,m.styleOption),n;n=m;for(var t=d,t=RMap.extend({proj:null},t),w=[],C=0;C<n.pointList.length;C++){var K=k.reSetCoordinate(n.pointList[C].lng,n.pointList[C].lat,t.proj),K=[K.lng,K.lat,n.pointList[C].data,n.trackId];w.push(K);E.push(K);K=L.circleMarker([K[1],K[0]],{radius:3,color:"white",weight:2,opacity:1,attribute:K[2],trackId:K[3]});x.push(K);K.on("click",R);B.addLayer(K);N.addLayer(K)}n=w;H.push({originalCoords:m.pointList,routeCoords:n,option:g});a(n,g);u<n.length&&(u=n.length);g=n;n=l(g[0],g[1]);n=L.marker([g[0][1],g[0][0]],{icon:n});v.push(n);B.addLayer(n);n=L.marker([g[0][1],g[0][0]],{icon:F});B.addLayer(n);g=L.marker([g[g.length-1][1],g[g.length-1][0]],{icon:A});B.addLayer(g);g="";m.pointList[0].data[r.showTimeKey]&&(g=m.pointList[0].data[r.showTimeKey]);m="";n='\x3cdiv class\x3d"conBtnWrap clearfix"\x3e';r.isShowTime&&(n='\x3cdiv class\x3d"conBtnWrap_showTime clearfix"\x3e',m='\x3cspan id\x3d"currentTime_track" class\x3d"right schedule_right"\x3e'+g+"\x3c/span\x3e");M&&D&&(document.body.removeChild(D),M=!1);D=document.createElement("div");D.id="conPanel";D.className="j_conPanel conPanelWrap";D.innerHTML='\x3cdiv class\x3d"slideBarWrap"\x3e\x3ca href\x3d"javascript:;" class\x3d"conPanelCloser"\x3e\x3c/a\x3e\x3cdiv class\x3d"j_sDefault sDefault"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_sCur sCur"\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" id\x3d"sPoint" class\x3d"sPoint"\x3e\x3c/a\x3e\x3c/div\x3e'+n+'\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPre left btnPre"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnRest left btnRest"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPause left btnPause stop"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnNext left btnNext"\x3e\x3c/a\x3e\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3cspan class\x3d"left schedule"\x3e\x3cem class\x3d"j_curNum"\x3e0\x3c/em\x3e/\x3cem class\x3d"j_dataTotal"\x3e100\x3c/em\x3e\x3c/span\x3e'+m+'\x3ca href\x3d"javascript:;" class\x3d"conPanelShowTrackList"\x3e\u663e\u793a\u5217\u8868\x3c/a\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f star--\x3e\x3cdiv id\x3d"trackList" class\x3d"relTableWrap relTableWrap_relation r-grid" style\x3d"height:215px;width:auto;margin-top:8px;display:none;"\x3e\t\x3cdiv class\x3d"r-grid-bd-box" id\x3d"trackResult_grid_bd_box" style\x3d"height:215px;padding-top:0px;margin-top:0px;"\x3e\t\t\x3ctable class\x3d"r-grid-center" style\x3d"width:auto;" id\x3d"trackListTable"\x3e\t\t\t\x3cthead\x3e\t\t\t\t\x3ctr\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 100px;"\x3e\u8bbe\u5907\u7f16\u53f7\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 150px;"\x3e\u5730\u5740\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 121px;"\x3e\u83b7\u53d6\u65f6\u95f4\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\x3c/tr\x3e\t\t\t\x3c/thead\x3e\t\t\t\x3ctbody id\x3d"trackBody"\x3e\t\t\t\x3c/tbody\x3e\t\t\x3c/table\x3e\t\x3c/div\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f end--\x3e';document.body.appendChild(D);r.top&&(D.style.top=r.top+"px");r.left&&(D.style.left=r.left+"px");q.init(u-1,c,S);M=!0;h(f[0].pointList[0])}if(1==d.isCenter){f=[];for(e=0;e<E.length;e++)f[e]=[E[e][1],E[e][0]];e=L.polyline(f);1==d.isCenter&&c.fitBounds(e.getBounds())}};this.callbackFun_trackObj=function(){};this.callbackFun_mouseMove=function(){};this.callbackFun_play=function(){};this.removeTrackPlay=function(){f()};var w,J,O=!1,S=function(a){t=a;if(t>=u)O=C=!0,window.clearTimeout(J);else if(0==t)for(O=C=!0,window.clearTimeout(J),y.clearLayers(),a=0;a<H.length;a++){var b=H[a].routeCoords,d=v[a],k=b[0];if(r.playCallback){var e={lng:k[0],lat:k[1],data:k[2],trackId:k[3]};h(e);r.playCallback(e)}k[2][r.showTimeKey]&&$("#currentTime_track").html(k[2][r.showTimeKey]);d.setLatLng([k[1],k[0]]);b=l(b[0],b[1]);d.setIcon(b)}else C=!1;if(!C)for(y.clearLayers(),a=0;a<H.length;a++)if(d=H[a].routeCoords,k=H[a].originalCoords,b=v[a],r.playCallback&&d&&(k={lng:k[t].lng,lat:k[t].lat,data:d[t][2],trackId:d[t][3]},h(k),r.playCallback(k)),d[t]&&3<d[t].length&&d[t][2][r.showTimeKey]&&$("#currentTime_track").html(d[t][2][r.showTimeKey]),t<d.length){var k=l(d[t-1],d[t]),e=d[t],f=c.getBounds();(e[0]<f.getWest()||e[0]>f.getEast()||e[1]<f.getSouth()||e[1]>f.getNorth())&&c.setView([e[1],e[0]]);w=0;O=!0;window.clearTimeout(J);g(q.speed,b,d[t-1],d[t]);b.setIcon(k);b=[];for(k=0;k<=t;k++)b.push(d[k]);n(b,H[a].option)}},Q=function(a){var b=L.GeometryUtil.closestLayer(c,x,a.latlng,!1),d=b.latlng;if(null!=b){var e=a.layerPoint;a=c.latLngToLayerPoint(d);e=Math.sqrt((e.x-a.x)*(e.x-a.x)+(e.y-a.y)*(e.y-a.y));point=b;r.mouseMoveCallback&&(d=k.reSetCoordinate_out(d.lng,d.lat),r.mouseMoveCallback({lng:d.lng,lat:d.lat,data:b.layer.options.attribute,trackId:b.layer.options.trackId}))}50<e&&r.mouseMoveCallback&&r.mouseMoveCallback(null)},P=function(a){a.dragging||r.mouseMoveCallback&&Q(a)},R=function(a){Q(a)},q={dataTotal:100,slideBarW:482,step:1,speed:I,playing:!1,callback:null,init:function(a,d,c){function k(a){var b=$(".sPoint"),d=$(".slideBarWrap").offset().left;a=a.clientX-d;d=q.slideBarW;0>a&&(a=0);a>d&&(a=d);b.css({left:a+"px"});$(".sCur").width(a);b=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(b+1);q.callback&&q.callback(parseInt($(".j_curNum").text())-1);return!1}a&&(q.dataTotal=a);c&&(q.callback=c);$(".j_dataTotal").text(q.dataTotal+1);$(".j_curNum").text(1);$(".conPanelCloser").on("click",function(a){f()});$("#trackListShowMapPoint").die().live("click",function(){var a=$(this).attr("data-lng"),d=$(this).attr("data-lat"),c=new RMap.LightPoint(b);c.init();c.hideLightPoint();c.showLightPoint(a,d);setTimeout(function(){c.hideLightPoint()},6E4)});$(".conPanelShowTrackList").on("click",function(a){"\u663e\u793a\u5217\u8868"==$(this).html()?($(this).html("\u6536\u8d77\u5217\u8868"),$("#trackList").show()):"\u6536\u8d77\u5217\u8868"==$(this).html()&&($(this).html("\u663e\u793a\u5217\u8868"),$("#trackList").hide())});$(".btnPause").on("click",function(a){$(this).hasClass("stop")?(t>=u-1&&q.stop(),$(".j_sCur").width()<$(".j_sDefault").width()&&q.start()):q.pause();a.stopPropagation()});$(".j_btnRest").on("click",function(){q.stop()});$(".j_btnNext").on("click",function(){var a=q.step;16>a&&(q.step=2*a,q.speed/=2,q.playing&&q.start());$(this).next().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnNext").next().find(".mulText").fadeOut()},800)});$(".j_btnPre").on("click",function(){var a=q.step;1<a&&(q.step=a/2,q.speed*=2,q.playing&&q.start());$(this).prev().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnPre").prev().find(".mulText").fadeOut()},800)});$(".sPoint").on("mousedown",function(a){var b=$(".sPoint"),d=$(".slideBarWrap").offset().left,c;$(document).on("mousemove.slideBar",function(a){a=a.clientX-d;var k=q.slideBarW;0>a&&(a=0);a>k&&(a=k);b.css({left:a+"px"});$(".sCur").width(a);c=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(c+1);return!1});$(document).on("mouseup.slideBar",function(a){$(document).off("mousemove.slideBar");$(document).off("mouseup.slideBar");q.callback&&q.callback(parseInt($(".j_curNum").text())-1)});return!1});$(".j_sDefault").on("click",k);$(".j_sCur").on("click",k);$(".j_conPanel").on("mousedown",function(a){var b=$(".j_conPanel"),c=a.clientX-b.offset().left,k=a.clientY-b.offset().top;$(document).on("mousemove.conPanel",function(a){var e=a.clientX-c;a=a.clientY-k;var f=0,g=0,h=d.getContainer();if(h){f=h.offsetLeft;g=h.offsetTop+document.body.scrollTop;do h=h.offsetParent,f+=h.offsetLeft,g+=h.offsetTop;while("BODY"!=h.tagName)}var h=f+d.getSize()[0]-$(".j_conPanel").width(),l=g+d.getSize()[1]-$(".j_conPanel").height();e<f&&(e=f);a<g&&(a=g);e>h&&(e=h);a>l&&(a=l);b.css({left:e+"px",top:a+"px"});return!1});$(document).on("mouseup.conPanel",function(a){$(document).off("mousemove.conPanel");$(document).off("mouseup.conPanel")});return!1})},stop:function(){$(".btnPause").addClass("stop");q.playing=!1;$(".sCur").stop();$(".sPoint").stop();q.step=1;q.speed=I;$(".j_curNum").text(1);$(".sCur").width(0);$(".sPoint").css("left",0);q.callback&&q.callback(parseInt($(".j_curNum").text())-1)},pause:function(){$(".btnPause").addClass("stop");q.playing=!1;e()},start:function(){$(".btnPause").removeClass("stop");q.playing=!0;e()}}};RMap.Query.QueryLayer=function(b){function a(a,b){b=RMap.extend({queryWhere:"1\x3d1",geoQueryType:"intersects"},b);var c=L.esri.query({url:a.url});if(b.queryPointList){for(var g=b.queryPointList,h=[],l=0;l<g.length;l++){var m=e.reSetCoordinate(g[l][0],g[l][1],b.proj);h[l]=[m.lat,m.lng]}g=L.polygon(h);"intersects"==b.geoQueryType?c.intersects(g):"within"==b.geoQueryType&&c.within(g)}c.where(b.queryWhere);c.run(function(a,d){f(d,b)})}function f(a,b){var e=L.geoJSON(a,{pointToLayer:function(a,d){if(b.pic){var c=L.icon({iconUrl:b.pic,iconAnchor:b.anchor});return L.marker(d,{icon:c})}return L.marker(d)}});if(a.features&&!(0>=a.features.length)){var f=a.features[0].geometry.type;"Point"!=f&&(f=m(f,b),e.setStyle(f));c.addLayer(e);if(b.onClick)e.on("click",function(a){var d={properties:a.layer.feature.properties,clickPosition:{lng:a.latlng.lng,lat:a.latlng.lat}};"Point"==a.layer.feature.geometry.type&&(d.point={lng:a.layer.feature.geometry.coordinates[0],lat:a.layer.feature.geometry.coordinates[1]});b.onClick(d)});if(b.onResult)b.onResult(a.features)}}function m(a,b){if("MultiLineString"==a){var c={color:"#3388ff",width:2,opacity:.8};b=RMap.extend(c,b);return{color:b.color,opacity:b.opacity,weight:b.width}}return"Polygon"==a?(c={color:"#3388ff",width:2,opacity:.3,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5},b=RMap.extend(c,b),{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity}):null}function g(a,b){var c="",g="";if(b.queryPointList){for(var c=b.queryPointList,h=0;h<c.length;h++)var l=e.reSetCoordinate(c[h][0],c[h][1],b.proj),g=0==h?g+("(the_geom,POLYGON(("+l.lng+" "+l.lat):g+(","+l.lng+" "+l.lat);g+=")))";"intersects"==b.geoQueryType?g="INTERSECTS"+g:"within"==b.geoQueryType&&(g="WITHIN"+g)}b.queryWhere?(c=b.queryWhere,""!=g&&(c+=" AND "+g)):c=g;g=L.Util.extend({service:"WFS",version:"1.0.0",request:"GetFeature",typeName:a.typeName,outputFormat:"text/javascript",format_options:"callback:getJson",SrsName:a.srsName,cql_filter:c});g=a.url+L.Util.getParamString(g);$.ajax({url:g,dataType:"jsonp",jsonpCallback:"getJson",success:function(a){f(a,b)}})}function l(){c.clearLayers();h.dispatch(h.clearDrawMeasure)}var n=b.map,h=b.appEvent,e=b.appCoord,c;this.init=function(){c=L.layerGroup().addTo(n);h.on(h.clearMap,function(a){l()});h.on(h.clearQueryResult,function(a){l()})};this.queryLayer=function(b,c){for(var e=RMap.config.thematicLayer,f=0;f<e.length;f++){var h=e[f];b==h.layerName&&("ArcGISRest"==h.layerType?a(h,c):"WFS_GeoServer"==h.layerType&&g(h,c))}};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){};this.removeQueryResult=function(){l();h.dispatch(h.clearQueryResult)}};RMap.Query.QueryLayerByRect=function(b){var a=b.appEvent,f=new RMap.Draw.DrawRect(b),m=new RMap.Query.QueryLayer(b);this.init=function(){f.init();m.init();a.on(a.clearMap,function(a){f.removeDrawRect()});a.on(a.clearQueryResult,function(a){f.removeDrawRect()})};this.queryLayerByRect=function(a,b){b=RMap.extend({id:null,callback:null,styleIn:{outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5},showMeasurements:!1},b);f.drawRect(function(f){b.queryPointList=f.pointList;m.queryLayer(a,b)},b.styleIn)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};RMap.Query.QueryLayerByPointBuffer=function(b){var a=b.appEvent,f=new RMap.Tools.Buffer(b),m=new RMap.Query.QueryLayer(b);this.init=function(){f.init();m.init();a.on(a.clearMap,function(a){f.removeBuffer()});a.on(a.clearQueryResult,function(a){f.removeBuffer()})};this.queryLayerByPointBuffer=function(a,b,n,h,e){var c=e.styleIn;c||(c={});c.callback=function(a){e.queryPointList=a.pointList;m.queryLayer(h,e)};c.proj=e.proj;f.bufferPoint(a,b,n,c)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};RMap.Query.BufferSelect=function(b){var a=b.map,f=b.appEvent,m=new RMap.Tools.Buffer(b),g=new RMap.Query.PolygonSelect(b),l=[16,16];this.init=function(){m.init();g.init();l=L.point(l);L.layerGroup().addTo(a);f.on(f.clearMap,function(a){doRemoveBuffer()})};this.bufferSelect=function(a,b,e,c,d,f){var l=f.styleIn;l||(l={});l.isCenter=f.isCenter;l.callback=function(a){g.polygonSelect(a.id,c,d,f)};l.proj=f.proj;m.bufferPoint(a,b,e,l)};this.callbackFun_onResult=function(){};this.callbackFun_polygonStyle=function(){};this.removeBufferSelect=function(){m.removeBuffer();g.removePolygonSelect()}};RMap.Query.DrawSelect=function(b){function a(){g.removeDrawRect();l.removeDrawCircle();n.removeDrawPolygon();h.removePolygonSelect()}var f=b.map,m=b.appEvent,g=new RMap.Draw.DrawRect(b),l=new RMap.Draw.DrawCircle(b),n=new RMap.Draw.DrawPolygon(b),h=new RMap.Query.PolygonSelect(b),e=[16,16];this.init=function(){g.init();l.init();n.init();h.init();e=L.point(e);L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()()})};this.drawSelect=function(a,b,e){e=RMap.extend({drawType:"rect",styleIn:{outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5},showMeasurements:!1},e);"rect"==e.drawType?g.drawRect(function(f){h.polygonSelect(f.id,a,b,e)},e.styleIn):"circle"==e.drawType?l.drawCircle(function(f){h.polygonSelect(f.id,a,b,e)},e.styleIn):"polygon"==e.drawType&&n.drawPolygon(function(f){h.polygonSelect(f.id,a,b,e)},e.styleIn)};this.callbackFun_onResult=function(){};this.callbackFun_polygonStyle=function(){};this.removeDrawSelect=function(){a()}};RMap.Query.PointSelect=function(b){function a(a,b){var g=f.project(a),m,z;h=[];n=[];m=L.latLngBounds(f.unproject([g.x+e.x/2,g.y-e.y/2]),f.unproject([g.x-e.x/2,g.y+e.y/2]));z=L.rectangle(m).toGeoJSON().geometry.coordinates[0];b.eachLayer(function(b){var c=b.feature.geometry.coordinates,e,f=!1;switch(b.feature.geometry.type){case "Point":c=[c];case "MultiPoint":for(e=0;e<c.length;e++)m.contains(L.latLng([c[e][1],c[e][0]]))&&(f=!0);break;case "LineString":c=[c];case "MultiLineString":for(e=0;e<c.length;e++){var g;if(g=m.intersects(b.getBounds()))a:{g=c[e];for(var k=0;k<=z.length-2;++k)for(var p=0;p<=g.length-2;++p){var u=z[k][1],C=z[k][0],r=z[k+1][1],M=z[k+1][0],D=g[p][1],E=g[p][0],G=g[p+1][1],F=g[p+1][0],A=(G-D)*(C-E)-(F-E)*(u-D),w=(r-u)*(C-E)-(M-C)*(u-D),u=(F-E)*(r-u)-(G-D)*(M-C);if(0!==u&&(A/=u,w/=u,0<=A&&1>=A&&0<=w&&1>=w)){g=!0;break a}}g=!1}g&&(f=!0)}break;case "Polygon":c=[c];case "MultiPolygon":for(e=0;e<c.length;e++){if(g=m.intersects(b.getBounds())){g=a.lng;k=a.lat;p=c[e];for(A=w=0;A<p.length;A++){u=p[A];C=!1;G=r=M=void 0;r=0;for(G=u.length-1;r<u.length;G=r++)M=u[r][0],D=u[r][1],E=u[G][0],G=u[G][1],(M=D>k!==G>k&&g<(E-M)*(k-D)/(G-D)+M)&&(C=!C);C&&w++}g=0==w%2?!1:1==w%2?!0:void 0}g&&(f=!0)}}f?l[L.stamp(b)]||(l[L.stamp(b)]=b,b.feature.properties&&h.push(b.feature.properties)):l[L.stamp(b)]&&(delete l[L.stamp(b)],b.feature.properties&&n.push(b.feature.properties))});h.length&&c&&c(h)}var f=b.map,m=b.appEvent,g=b.appCoord,l=[],n=[],h=[],e=[16,16],c;this.init=function(){e=L.point(e);L.layerGroup().addTo(f);m.on(m.clearMap,function(a){doRemoveBuffer()})};this.pointSelect=function(b,e,h,l,m){c=l;var n=L.geoJSON();f.eachLayer(function(a){if(a&&a.options.attribute)for(var b=0;b<h.length;b++)if(a.options.attribute.id==h[b]){var c=a.toGeoJSON();c.properties=a.options.attribute.properties;n.addData(c)}});b=g.reSetCoordinate(b,e);b=L.latLng(b.lat,b.lng);a(b,n)};this.callbackFun_onResult=function(){}};RMap.Query.PolygonSelect=function(b){function a(a,b,e){if(e&&null!=e.pic){var g=new Image;g.src=e.pic;g.onload=function(){e.imgWidth=g.width;e.imgHeight=g.height;f(a,b,e)}}else f(a,b,e)}function f(a,b,e){var f=null;e&&e.pic&&(e.anchor||(e.anchor=[e.imgWidth/2,e.imgHeight/2]),f=L.icon({iconUrl:e.pic,iconAnchor:e.anchor}));for(e=0;e<a.length;e++){var g=L.marker([b[e].lat,b[e].lng],{attribute:a[e]});null!=f&&g.setIcon(f);h.addLayer(g)}}function m(a,b,e){for(var f=0,g=0;g<e.length;g++){for(var h=e[g],l=!1,m=void 0,n=void 0,v=void 0,n=0,v=h.length-1;n<h.length;v=n++){var m=h[n][0],x=h[n][1],I=h[v][0],v=h[v][1];(m=x>b!==v>b&&a<(I-m)*(b-x)/(v-x)+m)&&(l=!l)}l&&f++}if(0==f%2)return!1;if(1==f%2)return!0}var g=b.map,l=b.appEvent,n=b.appCoord,h,e=[16,16];this.init=function(){e=L.point(e);h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){doRemoveBuffer()})};this.polygonSelect=function(b,d,e,f){f=RMap.extend({styleOut:{}},f);var h;g.eachLayer(function(a){a&&a.options.attribute&&a.options.attribute.id==b&&(h=a.toGeoJSON())});for(var l=[],B=[],N=[],H,v=0;v<d.length;v++){var x=n.reSetCoordinate(d[v].lng,d[v].lat);l[v]=x}"Polygon"==h.geometry.type?H=[h.geometry.coordinates]:"MultiPolygon"==h.geometry.type&&(H=h.geometry.coordinates);for(j=0;j<H.length;j++)for(v=0;v<l.length;v++)m(l[v].lng,l[v].lat,H[j])&&(B.push(d[v]),N.push(l[v]));a(B,N,f.styleOut);e(B)};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.removePolygonSelect=function(){h.clearLayers()}};