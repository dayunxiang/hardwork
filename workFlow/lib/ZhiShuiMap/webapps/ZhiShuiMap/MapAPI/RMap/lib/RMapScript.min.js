///<jscompress sourcefile="ClassManager.js" />
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

/**
 * @requires OpenLayers/SingleFile.js
 */

/**
 * Constructor: OpenLayers.Class
 * Base class used to construct all other classes. Includes support for 
 *     multiple inheritance. 
 *     
 * This constructor is new in OpenLayers 2.5.  At OpenLayers 3.0, the old 
 *     syntax for creating classes and dealing with inheritance 
 *     will be removed.
 * 
 * To create a new OpenLayers-style class, use the following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(prototype);
 * (end)
 *
 * To create a new OpenLayers-style class with multiple inheritance, use the
 *     following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(Class1, Class2, prototype);
 * (end)
 * 
 * Note that instanceof reflection will only reveal Class1 as superclass.
 *
 *////<jscompress sourcefile="Hashtable.js" />
/**
 * 哈希表
 *////<jscompress sourcefile="AppEvent.js" />
/**
 * 全局事件类，可以进行项目全局的监听和派发
 *////<jscompress sourcefile="DataManager.js" />
/**
 * 数据共享管理
 *////<jscompress sourcefile="ViewMap.js" />
/**
 * @class 地图浏览
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLayer.js" />
/**
 * @class 添加图层
 * @param {Object} classOption
 *////<jscompress sourcefile="SwitchMap.js" />
/**
 * @class 切换底图
 * @param {Object} classOption
 *////<jscompress sourcefile="AddCirclePoint.js" />
/**
 * @class 添加圆形点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLightPoint.js" />
/**
 * @class 添加高亮点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLine.js" />
/**
 * @class 添加折线
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPoint.js" />
/**
 * @class 添加图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPointList.js" />
/**
 * @class 添加一组图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPolygon.js" />
/**
 * @class 添加面
 * @param {Object} classOption
 *////<jscompress sourcefile="AddTextPoint.js" />
/**
 * @class 添加文字标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddComplexPoint.js" />
/**
 * @class 添加复合点位
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPoint.js" />
/**
 * @class 绘制点
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawCircle.js" />
/**
 * @class 绘制圆形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawLine.js" />
/**
 * @class 绘制折线
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPolygon.js" />
/**
 * @class 绘制多边形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawRect.js" />
/**
 * @class 绘制矩形
 * @param {Object} classOption
 *////<jscompress sourcefile="Measure.js" />
/**
 * @class 测量
 * @param {Object} classOption
 *////<jscompress sourcefile="AlwaysShowWindow.js" />
/**
 * @class 常显式气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="PopWindow.js" />
/**
 * @class 气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="Buffer.js" />
/**
 * @class 缓冲
 * @param {Object} classOption
 *////<jscompress sourcefile="ClearMap.js" />
/**
 * @class 清空地图
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertCoord.js" />
/**
 * @class 坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertEncryptCoord.js" />
/**
 * @class 加密坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="GetMapInformation.js" />
/**
 * @class 获取地图信息
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowCoordinate.js" />
/**
 * @class 显示地图坐标
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowZoomControl.js" />
/**
 * @class 显示地图放大缩小控制按钮
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowScale.js" />
/**
 * @class 显示比例尺
 * @param {Object} classOption
 *////<jscompress sourcefile="LocationToAddress.js" />
/**
 * @class 坐标转地址
 * @param {Object} classOption
 *////<jscompress sourcefile="PointCluster.js" />
/**
 * @class 点聚合分析
 * @param {Object} classOption
 *////<jscompress sourcefile="TrackPlay.js" />
/**
 * @class 轨迹回放
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayer.js" />
/**
 * @class 查询
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByPointBuffer.js" />
/**
 * @class 点缓冲查询
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByRect.js" />
/**
 * @class 拉框查询
 * @param {Object} classOption
 */RMap.Class=function(){var b=arguments.length,a=arguments[0],d=arguments[b-1],l="function"==typeof d.initialize?d.initialize:function(){a.prototype.initialize.apply(this,arguments)};1<b?(b=[l,a].concat(Array.prototype.slice.call(arguments).slice(1,b-1),d),RMap.inherit.apply(null,b)):l.prototype=d;return l};RMap.inherit=function(b,a){var d=function(){};d.prototype=a.prototype;b.prototype=new d;var l,h,d=2;for(l=arguments.length;d<l;d++)h=arguments[d],"function"===typeof h&&(h=h.prototype),RMap.extend(b.prototype,h)};RMap.extend=function(b,a){b=b||{};if(a){for(var d in a){var l=a[d];void 0!==l&&(b[d]=l)}"function"==typeof window.Event&&a instanceof window.Event||!a.hasOwnProperty||!a.hasOwnProperty("toString")||(b.toString=a.toString)}return b};RMap.Hashtable=function(){var b=[];this.add=function(a,d){for(var l=!1,h=0;h<b.length;h++)b[h][0]==a&&(b[h][1]=d,l=!0);0==l&&b.push([a,d])};this.get=function(a){for(var d=0;d<b.length;d++)if(b[d][0]==a)return b[d][1];return null};this.foreach=function(a){for(var d=0;d<b.length;d++)a(b[d][0],b[d][1])};this.remove=function(a){for(var d=0;d<b.length;d++)b[d][0]==a&&b.splice(d,1)};this.clear=function(){}};RMap.BaseWidget=RMap.Class({initialize:function(){},map:null});RMap.AppEvent=function(){this.clearMap="tools_clearMap";this.clearDrawMeasure="clearDrawMeasure";this.clearQueryResult="clearQueryResult";this.clearHightLight="clearHightLight";this.addShareData="dataManager_addShareData";this.getShareData="dataManager_getShareData";this.removeShareData="dataManager_removeShareData";this.onShareDataChange="dataManager_onShareDataChange";var b=document.createElement("a");this.dispatch=function(a,d,l){var h=document.createEvent("Event");h.initEvent(a,d,l);b.dispatchEvent(h)};this.on=function(a,d){b.addEventListener(a,d)}};RMap.AppCoord=function(b){function a(c,a){var f=m(c,a);return h(f.lng,f.lat)}function d(c,a){var f=l(c,a);return n(f.lng,f.lat)}function l(a,r){var v=k(a-105,r-35),m=g(a-105,r-35),d=r/180*c,b=Math.sin(d),b=1-e*b*b,l=Math.sqrt(b),v=180*v/(f*(1-e)/(b*l)*c),m=180*m/(f/l*Math.cos(d)*c);return{lng:a+m,lat:r+v}}function h(a,m){var v=k(a-105,m-35),d=g(a-105,m-35),b=m/180*c,l=Math.sin(b),l=1-e*l*l,n=Math.sqrt(l),v=180*v/(f*(1-e)/(l*n)*c),d=180*d/(f/n*Math.cos(b)*c);return{lng:2*a-(a+d),lat:2*m-(m+v)}}function n(c,a){var f=Math.sqrt(c*c+a*a)+2E-5*Math.sin(a*p),e=Math.atan2(a,c)+3E-6*Math.cos(c*p);return{lng:f*Math.cos(e)+.0065,lat:f*Math.sin(e)+.006}}function m(c,a){var f=c-.0065,e=a-.006,g=Math.sqrt(f*f+e*e)-2E-5*Math.sin(e*p),f=Math.atan2(e,f)-3E-6*Math.cos(f*p);return{lng:g*Math.cos(f),lat:g*Math.sin(f)}}function k(a,f){var e=-100+2*a+3*f+.2*f*f+.1*a*f+.2*Math.sqrt(Math.abs(a)),e=e+2*(20*Math.sin(6*a*c)+20*Math.sin(2*a*c))/3,e=e+2*(20*Math.sin(f*c)+40*Math.sin(f/3*c))/3;return e+=2*(160*Math.sin(f/12*c)+320*Math.sin(f*c/30))/3}function g(a,f){var e=300+a+2*f+.1*a*a+.1*a*f+.1*Math.sqrt(Math.abs(a)),e=e+2*(20*Math.sin(6*a*c)+20*Math.sin(2*a*c))/3,e=e+2*(20*Math.sin(a*c)+40*Math.sin(a/3*c))/3;return e+=2*(150*Math.sin(a/12*c)+300*Math.sin(a/30*c))/3}this.reSetCoordinate=function(c,f,e){c=void 0==c||void 0==f||null==c||null==f||NaN==c||NaN==f?null:{lng:Number(c),lat:Number(f)};"wgs84"!=e&&"gcj02"!=e&&"bd09"!=e&&(e=b?b:"wgs84");if("wgs84"==e){var g=c.lng,k=c.lat,p;"wgs84"==RMap.baseMapType?p={lng:g,lat:k}:"bd09"==RMap.baseMapType?p=d(g,k):"gcj02"==RMap.baseMapType&&(p=l(g,k));c=p}else"gcj02"==e?(p=c.lng,k=c.lat,"wgs84"==RMap.baseMapType?newCoord=g=h(p,k):"bd09"==RMap.baseMapType?g=n(p,k):"gcj02"==RMap.baseMapType&&(g={lng:p,lat:k}),c=g):"bd09"==e&&(p=c.lng,g=c.lat,"wgs84"==RMap.baseMapType?k=a(p,g):"bd09"==RMap.baseMapType?k={lng:p,lat:g}:"gcj02"==RMap.baseMapType&&(k=m(p,g)),c=k);return c};this.reSetCoordinate_out=function(c,f,e){"wgs84"!=e&&"gcj02"!=e&&"bd09"!=e&&(e=b?b:"wgs84");c={lng:c,lat:f};if("wgs84"==e){var g=c.lng,k=c.lat,p;"wgs84"==RMap.baseMapType?p={lng:g,lat:k}:"bd09"==RMap.baseMapType?(p=a(g,k),p={lng:p.lng,lat:p.lat}):"gcj02"==RMap.baseMapType&&(p=h(g,k),p={lng:p.lng,lat:p.lat});p.proj="wgs84";c=p}else"gcj02"==e?(p=c.lng,k=c.lat,"wgs84"==RMap.baseMapType?(p=l(p,k),g={lng:p.lng,lat:p.lat}):"bd09"==RMap.baseMapType?(p=m(p,k),g={lng:p.lng,lat:p.lat}):"gcj02"==RMap.baseMapType&&(g={lng:p,lat:k}),g.proj="gcj02",c=g):"bd09"==e&&(p=c.lng,g=c.lat,"wgs84"==RMap.baseMapType?(p=d(p,g),k={lng:p.lng,lat:p.lat}):"bd09"==RMap.baseMapType?k={lng:p,lat:g}:"gcj02"==RMap.baseMapType&&(p=n(p,g),k={lng:p.lng,lat:p.lat}),k.proj="bd09",c=k);return c};var c=3.141592653589793,f=6378245,e=.006693421622965943,p=3E3*c/180;this.convert_bd09_To_gps84=function(c,f){return a(c,f)};this.convert_gps84_To_bd09=function(c,a){return d(c,a)};this.convert_gps84_To_gcj02=function(c,a){return l(c,a)};this.convert_gcj02_To_gps84=function(c,a){return h(c,a)};this.convert_gcj02_To_bd09=function(c,a){return n(c,a)};this.convert_bd09_To_gcj02=function(c,a){return m(c,a)}};RMap.DataManager=function(b){function a(a){n.add(a.key,a.value);h.dispatch(h.onShareDataChange,{key:a.key,value:a.value})}function d(a,k){var g=n.get(a);k&&k(g)}function l(a){n.remove(a)}var h=b.appEvent,n=new RMap.Hashtable;this.init=function(){h.on(h.addShareData,a);h.on(h.getShareData,d);h.on(h.removeShareData,l)}};RMap.config=ResourceListConfig;RMap.Map=function(b,a){function d(c){var a=c.type||"TDT_ArcGISCache",f=c.name||"",g=c.url||"{srciptUrl}/map/TDTSL/_alllayers";if(void 0==g||null==g)g=void 0;else if(-1!=g.search("{srciptUrl}")){var k=RMap.scriptLocation.split("/"),d=k[0];if(".."==d)for(var m=0;m<k.length-2;m++)d+="/..";else d=k[0]+"//"+k[2];g=g.replace("{srciptUrl}",d)}var b;switch(a){case "OnLineMap":a=new RMap.BaseMapLayer;b=a.OnLineMap(c);break;case "TDT_ArcGISCache":a=new RMap.TDTLayer;b=a.ArcGISTileLayer(g,f);break;case "GCJ_ArcGISCache":a=new RMap.GCJLayer;b=a.ArcGISTileLayer(g,f);break;case "ArcGISTiledMapLayer":a=new RMap.BaseMapLayer;b=a.ArcGISTiledMapLayer(c);break}return b}var l=RMap.scriptUrl.split("?");if(l&&1<l.length)for(var h=l[1].split("\x26"),l=0;l<h.length;l++){var n=h[l].split("\x3d");"key"==n[0]&&(RMap.config.license||(RMap.config.license=[]),RMap.config.license.push(n[1].toString()))}for(var m="EPSG:4326",h=function(){for(var c=RMap.extend({center:RMap.config.center,zoom:RMap.config.zoom,extent:RMap.config.extent,minZoom:RMap.config.minZoom,maxZoom:RMap.config.maxZoom,type:["GDSL_OL"]},a),f=0;f<c.type.length;f++)if("TDTSL"==c.type[f]||"TDTYX"==c.type[f])m="EPSG:4326",RMap.baseMapType="wgs84";else if("BDSL"==c.type[f]||"BDYX"==c.type[f])m="EPSG:102113",RMap.baseMapType="bd09";else if("GDSL"==c.type[f]||"GDYX"==c.type[f])m="EPSG:102113",RMap.baseMapType="gcj02";else if("GGSL"==c.type[f]||"GGYX"==c.type[f])m="EPSG:102113",RMap.baseMapType="gcj02";else if("TDTSL_OL"==c.type[f]||"TDTYX_OL"==c.type[f])m="EPSG:3857",RMap.baseMapType="wgs84";else if("BDSL_OL"==c.type[f])m="EPSG:3857",RMap.baseMapType="gcj02";else if("GDSL_OL"==c.type[f]||"GGSL_OL"==c.type[f]||"GGSL_OL"==c.type[f]||"GGDEM_OL"==c.type[f]||"GGYX_OL"==c.type[f])m="EPSG:3857",RMap.baseMapType="gcj02";return c}(),k=RMap.config.baseLayer,n=[],g,l=0;l<k.length;l++)for(var c=k[l],f=0;f<h.type.length;f++)c.name==h.type[f]&&(c.ESPG&&(m="EPSG:"+c.ESPG,RMap.sysProjection=m),g=d(k[l]),g.eachLayer(function(c){RMap.baseLayerList.push(c)}),0==f&&n.push(g));l=new RMap.AppCoord(h.proj);k=l.reSetCoordinate(h.center[0],h.center[1],h.proj);h.center[0]=k.lat;h.center[1]=k.lng;if(null==RMap.crs||void 0==RMap.crs)RMap.crs=L.CRS.EPSG3857;h=L.map("map",{crs:RMap.crs,center:h.center,zoom:h.zoom,layers:n,zoomControl:!1,closePopupOnClick:!1});L.control.zoom({zoomInTitle:"\u653e\u5927",zoomOutTitle:"\u7f29\u5c0f"}).addTo(h);n=new RMap.AppEvent;(new RMap.DataManager({appEvent:n})).init();return new RMap.InterfaceManager({map:h,appEvent:n,appConfig:RMap.config,appCoord:l})};RMap.InterfaceManager=function(b){var a=new RMap.View.ViewMap(b);this.center=a.center;this.zoom=a.zoom;this.centerZoom=a.centerZoom;this.extent=a.extent;this.extentByData=a.extentByData;a=new RMap.Layer.SwitchMap(b);a.init();this.switchMap=a.switchMap;a=new RMap.Layer.AddLayer(b);a.init();this.addLayer=a.addLayer;this.removeLayer=a.removeLayer;a=new RMap.Tools.Buffer(b);a.init();this.bufferPoint=a.bufferPoint;this.removeBuffer=a.removeBuffer;a=new RMap.Graphic.AddPolygon(b);a.init();this.addPolygon=a.addPolygon;this.removePolygon=a.removePolygon;a=new RMap.Graphic.AddLine(b);a.init();this.addLine=a.addLine;this.removeLine=a.removeLine;a=new RMap.InfoWindow.PopWindow(b);a.init();this.showPopWindow=a.showPopWindow;this.hidePopWindow=a.hidePopWindow;a=new RMap.InfoWindow.AlwaysShowWindow(b);a.init();this.addAlwaysShowWindow=a.addAlwaysShowWindow;this.removeAlwaysShowWindow=a.removeAlwaysShowWindow;a=new RMap.Draw.DrawCircle(b);a.init();this.drawCircle=a.drawCircle;this.removeDrawCircle=a.removeDrawCircle;a=new RMap.Draw.DrawRect(b);a.init();this.drawRect=a.drawRect;this.removeDrawRect=a.removeDrawRect;a=new RMap.Draw.DrawPolygon(b);a.init();this.drawPolygon=a.drawPolygon;this.removeDrawPolygon=a.removeDrawPolygon;a=new RMap.Draw.DrawLine(b);a.init();this.drawLine=a.drawLine;this.removeDrawLine=a.removeDrawLine;a=new RMap.Draw.DrawPoint(b);a.init();this.drawPoint=a.drawPoint;this.removeDrawPoint=a.removeDrawPoint;this.clearMap=(new RMap.Tools.ClearMap(b)).clearMap;this.convertCoord=(new RMap.Tools.ConvertCoord(b)).convertCoord;this.convertEncryptCoord=(new RMap.Tools.ConvertEncryptCoord(b)).convertEncryptCoord;a=new RMap.Tools.ShowCoordinate(b);a.init();this.showCoordinate=a.showCoordinate;this.hideCoordinate=a.hideCoordinate;a=new RMap.Tools.ShowZoomControl(b);a.init();this.showZoomControl=a.showZoomControl;this.hideZoomControl=a.hideZoomControl;a=new RMap.Tools.ShowScale(b);a.init();this.showScale=a.showScale;this.hideScale=a.hideScale;a=new RMap.Tools.GetMapInformation(b);a.init();this.getCoordinate=a.getCoordinate;this.stopGetCoordinate=a.stopGetCoordinate;this.getMapExtent=a.getMapExtent;this.getMapLevel=a.getMapLevel;a=new RMap.Tools.LocationToAddress(b);a.init();this.locationToAddress=a.locationToAddress;a=new RMap.Measure.Measure(b);a.init();this.measureLength=a.measureLength;this.measureArea=a.measureArea;this.measureCircle=a.measureCircle;this.measureRect=a.measureRect;this.removeMeasure=a.removeMeasure;a=new RMap.Control.PointCluster(b);a.init();this.addPointCluster=a.addPointCluster;this.removePointCluster=a.removePointCluster;a=new RMap.Control.TrackPlay(b);a.init();this.addTrackPlay=a.addTrackPlay;this.removeTrackPlay=a.removeTrackPlay;a=new RMap.Graphic.AddLightPoint(b);a.init();this.addLightPoint=a.addLightPoint;this.removeLightPoint=a.removeLightPoint;a=new RMap.Graphic.AddPoint(b);a.init();this.addPoint=a.addPoint;this.removePoint=a.removePoint;a=new RMap.Graphic.AddPointList(b);a.init();this.addPointList=a.addPointList;this.removePointList=a.removePointList;a=new RMap.Graphic.AddCirclePoint(b);a.init();this.addCirclePoint=a.addCirclePoint;this.removeCirclePoint=a.removeCirclePoint;a=new RMap.Graphic.AddTextPoint(b);a.init();this.addTextPoint=a.addTextPoint;this.removeTextPoint=a.removeTextPoint;a=new RMap.Graphic.AddComplexPoint(b);a.init();this.addComplexPoint=a.addComplexPoint;this.removeComplexPoint=a.removeComplexPoint;a=new RMap.Query.QueryLayer(b);a.init();this.queryLayer=a.queryLayer;this.removeQueryResult=a.removeQueryResult;a=new RMap.Query.QueryLayerByRect(b);a.init();this.queryLayerByRect=a.queryLayerByRect;b=new RMap.Query.QueryLayerByPointBuffer(b);b.init();this.queryLayerByPointBuffer=b.queryLayerByPointBuffer};RMap.BaseMapLayer=function(b){this.OnLineMap=function(a){var d=[];"GDSL_OL"==a.name&&(d=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),d=L.layerGroup([d]));if("GDYX_OL"==a.name)var d=L.tileLayer.chinaProvider("GaoDe.Satellite.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.tileLayer.chinaProvider("GaoDe.Satellite.Annotion",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),d=L.layerGroup([d,b]);"GEOQ_OL"==a.name&&(d=L.tileLayer.chinaProvider("Geoq.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),d=L.layerGroup([d]));return d};this.ArcGISTiledMapLayer=function(a){a.EPSG&&a.resolutions?RMap.crs=new L.Proj.CRS("EPSG:"+a.EPSG,a.proj4,{origin:a.origin,resolutions:a.resolutions}):"3857"==a.EPSG&&void 0==a.resolutions&&(RMap.crs=L.CRS.EPSG3857);var d=[];a=L.esri.tiledMapLayer({url:a.url});return d=L.layerGroup([a])}};RMap.GCJLayer=function(b){var a=[156543.03392800014,78271.51696399994,39135.75848200009,19567.87924099992,9783.93962049996,4891.96981024998,2445.98490512499,1222.992452562495,611.4962262813797,305.74811314055756,152.87405657041106,76.43702828507324,38.21851414253662,19.10925707126831,9.554628535634155,4.77731426794937,2.388657133974685,1.1943285668550503,.5971642835598172,.29858214164761665,.14929107082380833,.07464553541190416];RMap.crs=new L.Proj.CRS("EPSG:102113","+proj\x3dmerc +lon_0\x3d0 +k\x3d1 +x_0\x3d0 +y_0\x3d0 +a\x3d6378137 +b\x3d6378137 +units\x3dm +no_defs",{origin:[-2.0037508342787E7,2.0037508342787E7],resolutions:a});this.ArcGISTileLayer=function(b,h){var n=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+h,continuousWorld:!0});n.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var k=a.z.toString(16).toUpperCase();return"L"+d(k,2)},x:function(){var k=a.y.toString(16).toUpperCase();return"R"+d(k,8)},y:function(){var k=a.x.toString(16).toUpperCase();return"C"+d(k,8)}}))};return L.layerGroup([n])};var d=function(a,b){for(var d=a.length;d<b;)a="0"+a,d++;return a}};RMap.TDTLayer=function(b){var a=[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.1457672119140625E-5,1.0728836059570312E-5,5.364418029785156E-6,2.682209014892578E-6,1.341104507446289E-6,6.705522537231445E-7,3.3527612686157227E-7];RMap.crs=new L.Proj.CRS("EPSG:4326","+proj\x3dlonglat +datum\x3dWGS84 +no_defs",{origin:[-180,90],resolutions:a});this.ArcGISTileLayer=function(b,h){var n=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+h,continuousWorld:!0});n.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var b=a.z.toString(16).toUpperCase();return"L"+d(b,2)},x:function(){var b=a.y.toString(16).toUpperCase();return"R"+d(b,8)},y:function(){var b=a.x.toString(16).toUpperCase();return"C"+d(b,8)}}))};return L.layerGroup([n])};var d=function(a,b){for(var d=a.length;d<b;)a="0"+a,d++;return a}};RMap.View.ViewMap=function(b){var a=b.map,d=b.appCoord;this.center=function(b,h,n){n=RMap.extend({proj:null},n);h=d.reSetCoordinate(b,h,n.proj);null==h?console.error("center\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=h.lng,h=h.lat,a.setView([Number(h),Number(b)]))};this.zoom=function(b){a.setZoom(b)};this.centerZoom=function(b,h,n,m){m=RMap.extend({proj:null},m);h=d.reSetCoordinate(b,h,m.proj);null==h?console.error("centerZoom\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=h.lng,h=h.lat,a.setView([Number(h),Number(b)],n))};this.extent=function(b,h,n,m,k){k=RMap.extend({proj:null},k);b=d.reSetCoordinate(b,h,k.proj);n=d.reSetCoordinate(n,m,k.proj);a.fitBounds([[b.lat,b.lng],[n.lat,n.lng]])};this.extentByData=function(b,h){h=RMap.extend({proj:null},h);for(var n=[],m=0;m<b.length;m++){var k=d.reSetCoordinate(b[m][0],b[m][1],h.proj);n[m]=[k.lat,k.lng]}n=L.polygon(n);a.fitBounds(n.getBounds())}};RMap.Layer.AddLayer=function(b){function a(a){d.eachLayer(function(b){if(b&&b.options.attribution){var k=b.options.attribution.split("|");if("addLayer"==k[0])if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var g=0;g<a.length;g++)k[1]==a[g]&&d.removeLayer(b)}else d.removeLayer(b)}})}var d=b.map,l=b.appEvent,h=b.appCoord;this.init=function(){l.on(l.clearMap,function(b){a()})};this.addLayer=function(a,b){b=RMap.extend({opacity:1},b);for(var k=RMap.config.thematicLayer,g=0;g<k.length;g++){var c=k[g];if(a==c.layerName){if("ArcGISRest"==c.layerType){var f=c,e=b;1==f.isQueryLayer?(e.where||(e.where="1\x3d1"),L.esri.featureLayer({url:f.url,opacity:e.opacity,where:e.where,attribution:"addLayer|"+f.layerName}).addTo(d)):L.esri.dynamicMapLayer({url:f.url,opacity:e.opacity,attribution:"addLayer|"+f.layerName}).addTo(d)}else"WFS_GeoServer"==c.layerType&&L.tileLayer.wms(c.url,{layers:c.typeName,format:"image/png",transparent:!0,opacity:b.opacity,attribution:"addLayer|"+c.layerName}).addTo(d);b.isCenter&&c.extent&&(f=h.reSetCoordinate(c.extent[0],c.extent[1]),c=h.reSetCoordinate(c.extent[2],c.extent[3]),d.fitBounds([[f.lat,f.lng],[c.lat,c.lng]]))}}};this.removeLayer=function(b){a(b)}};RMap.Layer.SwitchMap=function(b){var a=b.map,d=b.appEvent;this.init=function(){d.on(d.clearMap,function(a){})};this.switchMap=function(b){a.eachLayer(function(d){if(d&&d.options.layerName){var g=d.options.layerName.split("|");"BaseMap"==g[0]&&g[1]!=b&&a.removeLayer(d)}});for(var d=0;d<RMap.baseLayerList.length;d++){var n=RMap.baseLayerList[d],m=n.options.layerName.split("|");"BaseMap"==m[0]&&m[1]==b&&a.addLayer(n)}}};RMap.Graphic.AddCirclePoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var g=n.getLayers(),c=0;c<g.length;c++)a[b]==g[c].options.attribute.id&&n.removeLayer(g[c])}else n.clearLayers()}var d=b.map,l=b.appEvent,h=b.appCoord,n;this.init=function(){n=L.layerGroup().addTo(d);l.on(l.clearMap,function(b){a()})};this.addCirclePoint=function(a,b,g){g=RMap.extend({lng:Number(a),lat:Number(b),id:null,radius:3,color:"#3388ff",opacity:1,data:null,onClick:null,proj:null},g);var c=h.reSetCoordinate(a,b,g.proj);if(null==c)console.error("addCirclePoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=c.lng,b=c.lat,a=L.divIcon({className:"my-lf-label-circle",iconSize:[2*g.radius,2*g.radius],html:'\x3cdiv style\x3d"width: '+2*g.radius+"px; height: "+2*g.radius+"px; border-radius: "+g.radius+"px; background-color: "+g.color+"; opacity: "+g.opacity+';"\x3e\x3c/div\x3e'}),c=L.marker([c.lat,c.lng],{icon:a,attribute:g}),n.addLayer(c),g.onClick)c.on("click",function(c){g.onClick(g)})};this.callbackFun_onClick=function(){};this.removeCirclePoint=function(b){a(b)}};RMap.Graphic.AddLightPoint=function(b){function a(a,c,f){f=RMap.extend({lng:a,lat:c,proj:null},f);if(null!=f.pic){var e=new Image;e.src=f.pic;e.onload=function(){f.imgWidth=e.width;f.imgHeight=e.height;d(f)}}else d(f)}function d(a){var c=m.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var f=L.icon.pulse({iconSize:[12,12],color:"red"}),c=L.marker([c.lat,c.lng],{icon:f}).addTo(h);a.pic&&(a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]),a=L.icon({iconUrl:a.pic,iconAnchor:a.anchor}),c.setIcon(a));k.addLayer(c);$(".leaflet-pulsing-icon").css("pointer-events","none")}}function l(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var f=k.getLayers(),e=0;e<f.length;e++)a[c]==f[e].options.attribute.id&&k.removeLayer(f[e])}else k.clearLayers()}var h=b.map,n=b.appEvent,m=b.appCoord,k;this.init=function(){k=L.layerGroup().addTo(h);n.on(n.clearMap,function(a){l()});n.on(n.clearHightLight,function(a){l()})};this.addLightPoint=function(b,c,f){n.dispatch(n.clearHightLight);l();a(b,c,f)};this.removeLightPoint=function(a){l(a);n.dispatch(n.clearHightLight)}};RMap.Graphic.AddLine=function(b){function a(c,a){a=RMap.extend({points:c,id:null,width:2,color:"#3388ff",opacity:1,style:"",isCenter:!1,isShowArrow:!1,data:null,onClick:null,proj:null},a);for(var b=[],e=[],g=0;g<c.length;g++){var m=p.reSetCoordinate(c[g][0],c[g][1],a.proj);b[g]=[m.lat,m.lng];e[g]=[m.lng,m.lat]}m=L.polyline(b,{color:a.color,opacity:a.opacity,weight:a.width,attribute:a});u.addLayer(m);e=n(e);for(g=0;g<e.length;g++)if(e[g][2]&&0<e[g][2]){if((e[g-1][0]!=e[g][0]||e[g-1][1]!=e[g][1])&&e[g][4]==e[g][5]){var l=k(e[g-1],e[g],e[g][2],e[g][3]);d(l,a,e[g])}}else a.isShowArrow&&b[g-1]&&b[g]&&h([b[g-1],b[g]],u,a);if(a.onClick)m.on("click",function(c){c=c.latlng;c=p.reSetCoordinate_out(c.lng,c.lat);a.onClick({id:a.id,pointList:a.points,data:a.data,clickPosition:[c.lng,c.lat]})});1==a.isCenter&&f.fitBounds(m.getBounds())}function d(c,a,f){for(var e=[],g=0;g<c.length;g++)e[g]=[c[g][1],c[g][0]];e=L.polyline(e,{color:a.color,opacity:a.opacity,weight:a.width,attribute:a});u.addLayer(e);a.isShowArrow&&f[4]==f[5]&&(g=c[Math.floor(c.length/2)],c=c[Math.floor(c.length/2)+1],g=[g[1],g[0]],c=[c[1],c[0]],h([g,c],u,a,f[5].toString()));if(a.onClick)e.on("click",function(c){a.onClick(a)})}function l(c){if(void 0!=c&&null!=c){c.constructor!=Array&&(c=[c]);for(var a=0;a<c.length;a++)for(var f=u.getLayers(),g=0;g<f.length;g++)c[a]==f[g].options.attribute.id&&u.removeLayer(f[g])}else u.clearLayers()}function h(c,a,f,g){for(var e=0;e<c.length-1;e++){var b=c[e],d=c[e+1],k=d[0]-b[0],p=d[1]-b[1],m=[(b[0]+d[0])/2,(b[1]+d[1])/2],b=180*Math.atan2(d[0]-b[0],d[1]-b[1])/Math.PI;-180<b&&0>b&&(b=360+b);d=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");b=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+d+'" style\x3d"transform:rotate(-'+b+'deg)"/\x3e'});b=L.marker(m,{icon:b,attribute:f});0==k&&0==p||a.addLayer(b);g&&(k=L.divIcon({className:"my-lf-label",iconSize:[20,20],html:g}),m=L.marker(m,{icon:k,attribute:f}),u.addLayer(m),$(".my-lf-label").css("text-align","center"),$(".my-lf-label").css("font-weight","bold"),$(".my-lf-label").css("font-size",15),$(".my-lf-label").css("font-family","\u5fae\u8f6f\u96c5\u9ed1"),$(".my-lf-label").css("color","#000"),$(".my-lf-label").css("text-shadow","#FFF 2px 0 0,#FFF 0 2px 0,#FFF -2px 0 0,#FFF 0 -2px 0"))}}function n(c){for(var a=[],f=0;f<c.length-1;f++)a[0]=c[0],m(c[f],c[f+1])||a.push(c[f+1]);for(c=0;c<a.length;c++)for(var g=f=0,e=0;e<c;e++){var b;b=a[c];var d=a[c-1],k=a[e],p=a[e-1];b=m(b,d)&&m(k,p)?!1:m(b,k)&&m(d,p)?!0:m(b,p)&&m(k,d)?!0:!1;b&&(a[c][2]=a[c][2]&&0<a[c][2]?a[c][2]+1:1,void 0==a[c][3]&&(m(a[c],a[e])?(a[c][3]=1,f++,a[c][4]=f):(a[c][3]=-1,g++,a[c][4]=g)),1==a[e][3]&&a[c][3]==a[e][3]?(f++,a[c][4]=f,a[e][5]=f):-1==a[e][3]&&a[c][3]==a[e][3]&&(g++,a[c][4]=g,a[e][5]=g),a[c][5]=a[c][4])}return a}function m(c,a){return void 0==c||void 0==a?!1:c[0]==a[0]&&c[1]==a[1]?!0:!1}function k(a,f,e,b){var d;b=e;b=1;e=[(a[0]+f[0])/2,(a[1]+f[1])/2];d=g(a,f);b=-b*d/10;d=90*Math.PI/180;d=c(a,e)-d;d=[e[0]+b*Math.cos(d),e[1]+b*Math.sin(d)];e=[(a[0]+f[0])/2,(a[1]+f[1])/2];b=[(a[0]+d[0])/2,(a[1]+d[1])/2];var k=[e[0]-a[1]+f[1],e[1]+a[0]-f[0]],p=[b[0]-a[1]+d[1],b[1]+a[0]-d[0]];e[1]==k[1]?(p=(p[0]-b[0])/(p[1]-b[1]),k=p*(e[1]-b[1])+b[0],b=e[1]):b[1]==p[1]?(k=(k[0]-e[0])/(k[1]-e[1]),k=k*(b[1]-e[1])+e[0],b=b[1]):(k=(k[0]-e[0])/(k[1]-e[1]),p=(p[0]-b[0])/(p[1]-b[1]),b=(k*e[1]-e[0]-p*b[1]+b[0])/(k-p),k=k*b-k*e[1]+e[0]);e=[k,b];b=g(a,e);k=c(a,e);p=c(f,e);(d[1]-a[1])*(f[0]-a[0])>(f[1]-a[1])*(d[0]-a[0])?(a=p,d=k):(a=k,d=p);var m;f=[];k=d-a;k=0>k?k+2*Math.PI:k;for(p=0;100>=p;p++)m=a+k*p/100,d=e[0]+b*Math.cos(m),m=e[1]+b*Math.sin(m),f.push([d,m]);return f}function g(a,c){return Math.sqrt(Math.pow(a[0]-c[0],2)+Math.pow(a[1]-c[1],2))}function c(a,c){var f,e=Math.asin(Math.abs(c[1]-a[1])/g(a,c));c[1]>=a[1]&&c[0]>=a[0]?f=e+Math.PI:c[1]>=a[1]&&c[0]<a[0]?f=2*Math.PI-e:c[1]<a[1]&&c[0]<a[0]?f=e:c[1]<a[1]&&c[0]>=a[0]&&(f=Math.PI-e);return f}var f=b.map,e=b.appEvent,p=b.appCoord,u;this.init=function(){u=L.layerGroup().addTo(f);e.on(e.clearMap,function(a){l()})};this.addLine=function(c,f){a(c,f)};this.callbackFun_onClick=function(){};this.removeLine=function(a){l(a)}};RMap.Graphic.AddPoint=function(b){function a(a,c,f){f=RMap.extend({lng:a,lat:c,id:null,isCenter:!1,tooltip:null,tooltipDirection:"auto",data:null,onClick:null,onMouseOver:null,onMouseOut:null,onTooltipOpen:null,proj:null},f);if(null!=f.pic){var e=new Image;e.src=f.pic;e.onload=function(){f.imgWidth=e.width;f.imgHeight=e.height;d(f)}}else d(f)}function d(a){var c=m.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{c=L.marker([c.lat,c.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var f=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});c.setIcon(f)}k.addLayer(c);if(a.onClick)c.on("click",function(c){a.onClick(a)});if(a.onMouseOver)c.on("mouseover",function(c){a.onMouseOver(a)});if(a.onMouseOut)c.on("mouseout",function(c){a.onMouseOut(a)});if(a.onTooltipOpen)c.on("tooltipopen",function(c){a.onTooltipOpen(a)});a.tooltip&&c.bindTooltip(a.tooltip,{direction:a.tooltipDirection})}}function l(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var f=k.getLayers(),e=0;e<f.length;e++)a[c]==f[e].options.attribute.id&&k.removeLayer(f[e])}else k.clearLayers()}var h=b.map,n=b.appEvent,m=b.appCoord,k;this.init=function(){k=L.layerGroup().addTo(h);n.on(n.clearMap,function(a){l()})};this.addPoint=function(b,c,f){a(b,c,f)};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.callbackFun_onMouseOut=function(){};this.callbackFun_onTooltipOpen=function(){};this.removePoint=function(a){l(a)}};RMap.Graphic.AddPointList=function(b){function a(a){a=RMap.extend(null,a);if(null!=a.pic){var c=new Image;c.src=a.pic;c.onload=function(){a.imgWidth=c.width;a.imgHeight=c.height;d(a)}}else d(a)}function d(a){var c=m.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{c=L.marker([c.lat,c.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var f=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});c.setIcon(f)}k.addLayer(c);var e={id:a.id,lng:a.lng,lat:a.lat,data:a.data};if(a.onClick)c.on("click",function(c){a.onClick(e)});if(a.onMouseOver)c.on("mouseover",function(c){a.onMouseOver(e)})}}function l(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var f=k.getLayers(),e=0;e<f.length;e++)a[c]==f[e].options.attribute.id&&k.removeLayer(f[e])}else k.clearLayers()}var h=b.map,n=b.appEvent,m=b.appCoord,k;this.init=function(){k=L.layerGroup().addTo(h);n.on(n.clearMap,function(a){l()})};this.addPointList=function(b,c){c=RMap.extend({id:null,attrPic:null,lngField:"lng",latField:"lat",isCenter:!1,data:null,onClick:null,onMouseOver:null,proj:null},c);for(var f=eval("("+b+")"),e=[],d=0;d<f.length;d++){var k=f[d];c.lng=k[c.lngField];c.lat=k[c.latField];c.data=k;if(null!=c.attrPic)for(var n=0;n<c.attrPic.length;n++){var l=c.attrPic[n];k[l.field]==l.value&&(c.pic=l.pic)}a(c);c.isCenter&&(k=m.reSetCoordinate(c.lng,c.lat,c.proj),e.push([k.lat,k.lng]))}c.isCenter&&(f=L.polygon(e),h.fitBounds(f.getBounds()))};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.removePointList=function(a){l(a)}};RMap.Graphic.AddPolygon=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=n.getLayers(),c=0;c<d.length;c++)a[b]==d[c].options.attribute.id&&n.removeLayer(d[c])}else n.clearLayers()}var d=b.map,l=b.appEvent,h=b.appCoord,n;this.init=function(){n=L.layerGroup().addTo(d);l.on(l.clearMap,function(b){a()})};this.addPolygon=function(a,b){b=RMap.extend({pointList:a,id:null,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5,outLineStyle:"",color:"#3388ff",opacity:.3,data:null,isCenter:!1,onClick:null,proj:null},b);for(var g=[],c=0;c<a.length;c++){var f=h.reSetCoordinate(a[c][0],a[c][1],b.proj);g[c]=[f.lat,f.lng]}g=L.polygon(g,{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity,attribute:b});n.addLayer(g);if(b.onClick)g.on("click",function(a){a=a.latlng;a=h.reSetCoordinate_out(a.lng,a.lat);b.onClick({id:b.id,pointList:b.pointList,data:b.data,clickPosition:[a.lng,a.lat]})});1==b.isCenter&&d.fitBounds(g.getBounds())};this.callbackFun_onClick=function(){};this.removePolygon=function(b){a(b)}};RMap.Graphic.AddTextPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var c=n.getLayers(),f=0;f<c.length;f++)a[b]==c[f].options.attribute.id&&n.removeLayer(c[f])}else n.clearLayers()}var d=b.map,l=b.appEvent,h=b.appCoord,n,m=0;this.init=function(){n=L.layerGroup().addTo(d);l.on(l.clearMap,function(b){a()})};this.addTextPoint=function(a,b,c,f){var e={lng:Number(a),lat:Number(b),txt:c,id:null,color:0,offsetX:0,offsetY:0,font_weight:"bold",font_size:"16px",font_family:"\u5fae\u8f6f\u96c5\u9ed1",data:null,onClick:null,proj:null};c="my-lf-label";f&&(f.color||f.offsetX||f.offsetY||f.font_weight||f.font_size||f.font_family)&&(m++,c+=m);f=RMap.extend(e,f);e=h.reSetCoordinate(a,b,f.proj);if(null==e)console.error("addTextPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=e.lng,b=e.lat,a=L.divIcon({className:c,iconSize:[100,24],html:f.txt}),a=L.marker([e.lat,e.lng],{icon:a,attribute:f}),n.addLayer(a),$("."+c).css("text-align","center"),$("."+c).css("font-weight",f.font_weight),$("."+c).css("font-size",f.font_size),$("."+c).css("font-family",f.font_family),$("."+c).css("color",f.color),$("."+c).css("top",f.offsetX),$("."+c).css("left",f.offsetY),f.onClick)a.on("click",function(a){f.onClick({lng:f.lng,lat:f.lat,txt:f.txt,data:f.data,id:f.id})})};this.callbackFun_onClick=function(){};this.removeTextPoint=function(b){a(b)}};RMap.Graphic.AddComplexPoint=function(b){var a=b.map,d=b.appEvent,l=b.appCoord,h,n=0;this.init=function(){h=L.layerGroup().addTo(a);d.on(d.clearMap,function(a){doRemoveTextPoint()})};this.addComplexPoint=function(a,b,d,c){c=RMap.extend({lng:Number(a),lat:Number(b),id:null,width:0,height:0,offsetX:0,offsetY:0,data:null,onClick:null,proj:null},c);var f=l.reSetCoordinate(a,b,c.proj);if(null==f)console.error("addComplexPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=f.lng,b=f.lat,n++,a="my-lf-label-complex"+n,d=L.divIcon({className:a,iconSize:[c.width,c.height],html:d}),f=L.marker([f.lat,f.lng],{icon:d,attribute:c}),h.addLayer(f),$("."+a).css("left",c.offsetX),$("."+a).css("top",c.offsetY),c.onClick)f.on("click",function(a){c.onClick({lng:c.lng,lat:c.lat,data:c.data,id:c.id})})};this.callbackFun_onClick=function(){};this.removeComplexPoint=function(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=h.getLayers(),c=0;c<d.length;c++)a[b]==d[c].options.attribute.id&&h.removeLayer(d[c])}else h.clearLayers()}};RMap.Draw.DrawPoint=function(b){function a(b){g++;b.layer.drawId=void 0!=k.id||null!=k.id?k.id:"DrawPoint"+g;c.addLayer(b.layer);b=b.layer;if(k.callback){var e=m.reSetCoordinate_out(b._latlng.lng,b._latlng.lat);b={id:b.drawId,lng:e.lng.toFixed(6),lat:e.lat.toFixed(6)};k.callback(b)}h.off(L.Draw.Event.CREATED,a)}function d(c,b,d){k=b=RMap.extend(d,b);h.off(L.Draw.Event.CREATED,a);h.on(L.Draw.Event.CREATED,a);c=new L.Draw.Marker(h);b.pic&&(b.anchor||(b.anchor=[b.imgWidth/2,b.imgHeight/2]),b=L.icon({iconUrl:b.pic,iconAnchor:b.anchor}),c.options.shapeOptions=RMap.extend(c.options.icon,b));L.Handler.prototype.enable.call(c);c.fire("enabled",{handler:c.type});c._map.fire(L.Draw.Event.DRAWSTART,{layerType:c.type})}function l(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=c.getLayers(),g=0;g<d.length;g++)a[b]==d[g].drawId&&c.removeLayer(d[g])}else c.clearLayers()}var h=b.map,n=b.appEvent,m=b.appCoord,k,g=0,c;this.init=function(){c=(new L.FeatureGroup).addTo(h);n.on(n.clearMap,function(a){l()});n.on(n.clearDrawMeasure,function(a){l()})};this.drawPoint=function(a,c){var b={id:null,callback:a};if(c&&null!=c.pic){var g=new Image;g.src=c.pic;g.onload=function(){c.imgWidth=g.width;c.imgHeight=g.height;d(a,c,b)}}else d(a,c,b)};this.callbackFun_callback=function(){};this.removeDrawPoint=function(a){l(a)}};RMap.Draw.DrawCircle=function(b){function a(c){k++;c.layer.drawId=void 0!=m.id||null!=m.id?m.id:"DrawCircle"+k;g.addLayer(c.layer);c=c.layer;if(m.callback){var b=n.reSetCoordinate_out(c.getBounds()._southWest.lng,c.getBounds()._southWest.lat),e=n.reSetCoordinate_out(c.getBounds()._northEast.lng,c.getBounds()._northEast.lat),b=[b.lng,b.lat,e.lng,e.lat],e=n.reSetCoordinate_out(c._latlng.lng,c._latlng.lat),d=L.Circle.toPolygon(c,64,l),h=[],r=[e.lat,e.lng],v=c.getRadius()/L.CRS.Earth.R/(Math.PI/180),D=l.project([r[0]+v,r[1]]),F=l.project([r[0]-v,r[1]]),D=D.add(F).divideBy(2),D=l.unproject(D),D=[D.lat,D.lng],r=L.latLng([r[0]+v,r[1]]),v=L.latLng(D);r.distanceTo(v);r=D[0]-e.lat;for(v=0;v<d.length;v++)h[v]=[d[v].lng,d[v].lat+r];m.callback({id:c.drawId,center:[e.lng,e.lat],radius:c._mRadius,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],extent:b,pointList:h})}l.off(L.Draw.Event.CREATED,a)}function d(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=g.getLayers(),d=0;d<e.length;d++)a[b]==e[d].drawId&&g.removeLayer(e[d])}else g.clearLayers()}var l=b.map,h=b.appEvent,n=b.appCoord,m,k=0,g;this.init=function(){g=(new L.FeatureGroup).addTo(l);h.on(h.clearMap,function(a){d()});h.on(h.clearDrawMeasure,function(a){d()})};this.drawCircle=function(c,b){var e;m=e=RMap.extend({id:null,callback:c,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},b);l.off(L.Draw.Event.CREATED,a);l.on(L.Draw.Event.CREATED,a);var d=new L.Draw.Circle(l);d.options.shapeOptions=RMap.extend(d.options.shapeOptions,{stroke:!0,color:e.outLineColor,weight:e.outLineWidth,opacity:e.outLineOpacity,fillColor:e.color,fillOpacity:e.opacity,showMeasurements:e.showMeasurements});L.Handler.prototype.enable.call(d);d.fire("enabled",{handler:d.type});d._map.fire(L.Draw.Event.DRAWSTART,{layerType:d.type})};this.callbackFun_callback=function(){};this.removeDrawCircle=function(a){d(a)}};RMap.Draw.DrawLine=function(b){function a(c){k++;c.layer.drawId=void 0!=m.id||null!=m.id?m.id:"DrawLine"+k;g.addLayer(c.layer);c=c.layer;if(m.callback){for(var b=n.reSetCoordinate_out(c._bounds._southWest.lng,c._bounds._southWest.lat),e=n.reSetCoordinate_out(c._bounds._northEast.lng,c._bounds._northEast.lat),b=[b.lng,b.lat,e.lng,e.lat],e=c._latlngs,d=[],h=0;h<e.length;h++){var r=n.reSetCoordinate_out(e[h].lng,e[h].lat);d[h]=[r.lng,r.lat]}m.callback({id:c.drawId,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],pointList:d,extent:b})}l.off(L.Draw.Event.CREATED,a)}function d(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=g.getLayers(),d=0;d<e.length;d++)a[b]==e[d].drawId&&g.removeLayer(e[d])}else g.clearLayers()}var l=b.map,h=b.appEvent,n=b.appCoord,m,k=0,g;this.init=function(){g=(new L.FeatureGroup).addTo(l);h.on(h.clearMap,function(a){d()});h.on(h.clearDrawMeasure,function(a){d()})};this.drawLine=function(c,b){var e;m=e=RMap.extend({id:null,callback:c,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!1},b);l.off(L.Draw.Event.CREATED,a);l.on(L.Draw.Event.CREATED,a);var d=new L.Draw.Polyline(l);d.options.shapeOptions=RMap.extend(d.options.shapeOptions,{stroke:!0,color:e.color,weight:e.width,opacity:e.opacity,showMeasurements:e.showMeasurements});L.Handler.prototype.enable.call(d);d.fire("enabled",{handler:d.type});d._map.fire(L.Draw.Event.DRAWSTART,{layerType:d.type})};this.callbackFun_callback=function(){};this.removeDrawLine=function(a){d(a)}};RMap.Draw.DrawPolygon=function(b){function a(c){k++;c.layer.drawId=void 0!=m.id||null!=m.id?m.id:"DrawPolygon"+k;g.addLayer(c.layer);c=c.layer;if(m.callback){for(var b=n.reSetCoordinate_out(c._bounds._southWest.lng,c._bounds._southWest.lat),d=n.reSetCoordinate_out(c._bounds._northEast.lng,c._bounds._northEast.lat),b=[b.lng,b.lat,d.lng,d.lat],d=c._latlngs[0],h=[],u=0;u<d.length;u++){var r=n.reSetCoordinate_out(d[u].lng,d[u].lat);h[u]=[r.lng,r.lat]}m.callback({id:c.drawId,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],pointList:h,extent:b})}l.off(L.Draw.Event.CREATED,a)}function d(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=g.getLayers(),k=0;k<d.length;k++)a[b]==d[k].drawId&&g.removeLayer(d[k])}else g.clearLayers()}var l=b.map,h=b.appEvent,n=b.appCoord,m,k=0,g;this.init=function(){g=(new L.FeatureGroup).addTo(l);h.on(h.clearMap,function(a){d()});h.on(h.clearDrawMeasure,function(a){d()})};this.drawPolygon=function(c,b){var d;m=d=RMap.extend({id:null,callback:c,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},b);l.off(L.Draw.Event.CREATED,a);l.on(L.Draw.Event.CREATED,a);var g=new L.Draw.Polygon(l);g.options.shapeOptions=RMap.extend(g.options.shapeOptions,{stroke:!0,color:d.outLineColor,weight:d.outLineWidth,opacity:d.outLineOpacity,fillColor:d.color,fillOpacity:d.opacity,showMeasurements:d.showMeasurements});L.Handler.prototype.enable.call(g);g.fire("enabled",{handler:g.type});g._map.fire(L.Draw.Event.DRAWSTART,{layerType:g.type})};this.callbackFun_callback=function(){};this.removeDrawPolygon=function(a){d(a)}};RMap.Draw.DrawRect=function(b){function a(c){k++;c.layer.drawId=void 0!=m.id||null!=m.id?m.id:"DrawRect"+k;g.addLayer(c.layer);c=c.layer;if(m.callback){for(var b=n.reSetCoordinate_out(c._bounds._southWest.lng,c._bounds._southWest.lat),d=n.reSetCoordinate_out(c._bounds._northEast.lng,c._bounds._northEast.lat),b=[b.lng,b.lat,d.lng,d.lat],d=c._latlngs[0],h=[],u=0;u<d.length;u++){var r=n.reSetCoordinate_out(d[u].lng,d[u].lat);h[u]=[r.lng,r.lat]}m.callback({id:c.drawId,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],pointList:h,extent:b})}l.off(L.Draw.Event.CREATED,a)}function d(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=g.getLayers(),k=0;k<d.length;k++)a[b]==d[k].drawId&&g.removeLayer(d[k])}else g.clearLayers()}var l=b.map,h=b.appEvent,n=b.appCoord,m,k=0,g;this.init=function(){g=(new L.FeatureGroup).addTo(l);h.on(h.clearMap,function(a){d()});h.on(h.clearDrawMeasure,function(a){d()})};this.drawRect=function(c,b){var d;m=d=RMap.extend({id:null,callback:c,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},b);l.off(L.Draw.Event.CREATED,a);l.on(L.Draw.Event.CREATED,a);var g=new L.Draw.Rectangle(l);g.options.shapeOptions=RMap.extend(g.options.shapeOptions,{stroke:!0,color:d.outLineColor,weight:d.outLineWidth,opacity:d.outLineOpacity,fillColor:d.color,fillOpacity:d.opacity,showMeasurements:d.showMeasurements});L.Handler.prototype.enable.call(g);g.fire("enabled",{handler:g.type});g._map.fire(L.Draw.Event.DRAWSTART,{layerType:g.type})};this.callbackFun_callback=function(){};this.removeDrawRect=function(a){d(a)}};RMap.Measure.Measure=function(b){var a=b.appEvent,d=new RMap.Draw.DrawLine(b),l=new RMap.Draw.DrawRect(b),h=new RMap.Draw.DrawCircle(b),n=new RMap.Draw.DrawPolygon(b);this.init=function(){d.init();l.init();h.init();n.init()};this.measureLength=function(a){a=RMap.extend({id:null,callback:null,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!0},a);d.drawLine(null,a)};this.measureRect=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);l.drawRect(null,a)};this.measureCircle=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);h.drawCircle(null,a)};this.measureArea=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);n.drawPolygon(null,a)};this.removeMeasure=function(){a.dispatch(a.clearDrawMeasure)}};RMap.InfoWindow.AlwaysShowWindow=function(b){var a=b.map,d=b.appEvent,l=b.appCoord,h;new RMap.Graphic.AddLightPoint(b);this.init=function(){h=L.layerGroup().addTo(a);d.on(d.clearMap,function(a){doHidePopWindow()})};this.addAlwaysShowWindow=function(a,b,d,g){g=RMap.extend({proj:null},g);a=l.reSetCoordinate(a,b,g.proj);null==a?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=L.popup(),b.setLatLng([Number(a.lat),Number(a.lng)]),b.setContent(d),h.addLayer(b))};this.removeAlwaysShowWindow=function(){h.clearLayers()}};RMap.InfoWindow.PopWindow=function(b){function a(a){k&&m.removeLightPoint()}var d=b.map,l=b.appEvent,h=b.appCoord,n=L.popup(),m=new RMap.Graphic.AddLightPoint(b),k=!1;this.init=function(){m.init();l.on(l.clearMap,function(a){d.removeLayer(n)})};this.showPopWindow=function(b,c,f,e){e=RMap.extend({isCenter:!1,isHighLight:!1,autoPan:!0,proj:null},e);var l=h.reSetCoordinate(b,c,e.proj);null==l?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(e.isCenter&&d.setView([Number(l.lat),Number(l.lng)]),n=L.popup({autoPan:e.autoPan,maxWidth:2E3}),n.on("remove",a),n.setLatLng([Number(l.lat),Number(l.lng)]),n.setContent(f),n.openOn(d),(k=e.isHighLight)&&m.addLightPoint(b,c,e))};this.hidePopWindow=function(){d.removeLayer(n)}};RMap.Tools.Buffer=function(b){var a,d,l;function h(b,h,m,r){r=RMap.extend({outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.3,isCenter:!1,proj:null},r);b=Number(b);h=Number(h);m=Number(m);a=b;d=h;l=r;var z=k.reSetCoordinate(b,h,r.proj);if(null==z)console.error("bufferPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var E=L.circle([z.lat,z.lng],{radius:m});E.setStyle({stroke:!0,color:r.outLineColor,weight:r.outLineWidth,opacity:r.outLineOpacity,fillColor:r.color,fillOpacity:r.opacity});g.clearLayers();g.addLayer(E);var w=n.getZoom();n.dragging.enabled()&&n.setZoom(RMap.config.maxZoom);var A=E.getBounds(),G=k.reSetCoordinate_out(A.getWest(),A.getSouth()),t=k.reSetCoordinate_out(A.getEast(),A.getNorth()),G=[G.lng,G.lat,t.lng,t.lat],t=L.Circle.toPolygon(E,64,n),E=[],y=[z.lat,z.lng],x=m/L.CRS.Earth.R/(Math.PI/180),B=n.project([y[0]+x,y[1]]),N=n.project([y[0]-x,y[1]]),B=B.add(N).divideBy(2),B=n.unproject(B),B=[B.lat,B.lng],y=L.latLng([y[0]+x,y[1]]),x=L.latLng(B);y.distanceTo(x);y=B[0]-z.lat;for(x=0;x<t.length;x++)z=k.reSetCoordinate_out(t[x].lng,t[x].lat+y),E[x]=[z.lng,z.lat];z=[A.getEast(),(A.getSouth()+A.getNorth())/2];t=m;y="";y=1E4<=t?(t/1E3).toFixed(1)+"km":t.toFixed(0)+"m";t=L.marker([z[1],z[0]],{icon:L.icon({iconUrl:RMap.scriptLocation+"image/tuodong.png",iconAnchor:[17.8,10]})});g.addLayer(t);y=L.divIcon({className:"my-lf-label",iconSize:[50,20],html:y});z=L.marker([z[1],z[0]],{icon:y});g.addLayer(z);$(".my-lf-label").css("text-align","center");$(".my-lf-label").css("top",2);$(".my-lf-label").css("left",42);t.on("mousedown",u);t.on("mouseup",p);n.on("mouseup",p);b={pointList:E,extent:G,lat:h,lng:b,radius:m};f=r.callback;e=b;r.callback&&!c&&r.callback(b);n.setZoom(w);1==r.isCenter&&n.fitBounds(A)}}var n=b.map,m=b.appEvent,k=b.appCoord,g;this.init=function(){g=L.layerGroup().addTo(n);m.on(m.clearMap,function(a){g.clearLayers()})};this.bufferPoint=function(a,b,d,f){c=!1;h(a,b,d,f)};this.callbackFun_onResult=function(){};this.removeBuffer=function(){g.clearLayers()};var c=!1;l=d=a=void 0;var f,e,p=function(a){n.dragging.enabled()||(n.dragging.enable(),r(a),f(e),console.log("end"));n.off("mousemove",r)},u=function(a){n.dragging.enabled()&&n.dragging.disable();c=!0;console.log("start");n.off("mousemove",r);n.on("mousemove",r)},r=function(c){var b=k.reSetCoordinate_out(c.latlng.lng,c.latlng.lat);c=[a,d];b=[b.lng,b.lat];c=k.reSetCoordinate(c[0],c[1]);b=k.reSetCoordinate(b[0],b[1]);c=L.latLng(c);b=L.latLng(b);c=c.distanceTo(b);h(a,d,c,l)}};RMap.Tools.ClearMap=function(b){var a=b.appEvent;this.clearMap=function(){a.dispatch(a.clearMap)}};RMap.Tools.ConvertCoord=function(b){this.convertCoord=function(a,b,l,h){l==h?a={lng:a,lat:b}:(l=new proj4.Proj(l.proj4),h=new proj4.Proj(h.proj4),a=proj4(l,h,[a,b]),a={lng:a[0],lat:a[1]});return a}};RMap.Tools.ConvertEncryptCoord=function(b){var a=b.appCoord;this.convertEncryptCoord=function(b,l,h,n){return h==n?{lng:b,lat:l}:"bd09"==h&&"wgs84"==n?a.convert_bd09_To_gps84(Number(b),Number(l)):"wgs84"==h&&"bd09"==n?a.convert_gps84_To_bd09(Number(b),Number(l)):"wgs84"==h&&"gcj02"==n?a.convert_gps84_To_gcj02(Number(b),Number(l)):"gcj02"==h&&"wgs84"==n?a.convert_gcj02_To_gps84(Number(b),Number(l)):"gcj02"==h&&"bd09"==n?a.convert_gcj02_To_bd09(Number(b),Number(l)):"bd09"==h&&"gcj02"==n?a.convert_bd09_To_gcj02(Number(b),Number(l)):null}};RMap.Tools.GetMapInformation=function(b){function a(a){e++;a.layer.drawId=void 0!=f.id||null!=f.id?f.id:"DrawPoint"+e;g.addLayer(a.layer);0<=f.showTime&&setTimeout(function(){g.removeLayer(a.layer)},f.showTime);d(a.layer)}function d(a){if(f.callback){var b=m.reSetCoordinate_out(a._latlng.lng,a._latlng.lat);a={id:a.drawId,lng:b.lng.toFixed(6),lat:b.lat.toFixed(6)};f.callback(a);0==f.repeatMode&&(c=null)}}function l(){c&&c.removeHooks();c=null;g.clearLayers();k&&(k.parentNode.removeChild(k),k=void 0)}var h=b.map,n=b.appEvent,m=b.appCoord,k,g,c,f,e=0;this.init=function(){g=(new L.FeatureGroup).addTo(h);n.on(n.clearMap,function(a){l()})};this.getCoordinate=function(b,d){c||(f={showTime:3E3,repeatMode:!0},f=RMap.extend(f,d),f.callback=b,h.off(L.Draw.Event.CREATED,a),h.on(L.Draw.Event.CREATED,a),c=new L.Draw.Marker(h),c.options.repeatMode=f.repeatMode,L.Handler.prototype.enable.call(c),c.fire("enabled",{handler:c.type}),c._map.fire(L.Draw.Event.DRAWSTART,{layerType:c.type}))};this.callbackFun_onResult=function(){};this.stopGetCoordinate=function(){l()};this.getMapExtent=function(){var a=h.getBounds(),c=m.reSetCoordinate_out(a._southWest.lng,a._southWest.lat),a=m.reSetCoordinate_out(a._northEast.lng,a._northEast.lat);return[c.lng,c.lat,a.lng,a.lat]};this.getMapLevel=function(){return h.getZoom()}};RMap.Tools.ShowCoordinate=function(b){function a(){var a="\u7ea7\u6570\uff1a"+n+"\uff0c\u7ecf\u5ea6\uff1a"+m.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+m.lat.toFixed(6),b="\u7ecf\u5ea6\uff1a"+m.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+m.lat.toFixed(6);k.innerHTML=a;h&&(h.innerHTML=b,helpTooltip.setPosition([m.lng,m.lat]),$(h).removeClass("hidden"))}var d=b.map,l=b.appCoord,h,n,m,k,g=!1;this.init=function(){k=document.createElement("label");k.style.position="absolute";k.style.bottom="10px";k.style.left="10px";m=l.reSetCoordinate_out(d.getCenter().lng,d.getCenter().lat);n=d.getZoom();d.on("zoom",function(c){n=d.getZoom();a()});d.on("mousemove",function(c){m=l.reSetCoordinate_out(c.latlng.lng,c.latlng.lat);n&&a()})};this.showCoordinate=function(a){a&&(a.top&&(k.style.bottom=null,k.style.top=a.top+"px"),a.bottom&&(k.style.top=null,k.style.bottom=a.bottom+"px"),a.left&&(k.style.right=null,k.style.left=a.left+"px"),a.right&&(k.style.left=null,k.style.right=a.right+"px"));k.style["z-index"]=99999;d.getContainer().appendChild(k);g=!0};this.hideCoordinate=function(){g&&(d.getContainer().removeChild(k),g=!1)}};RMap.Tools.ShowZoomControl=function(b){var a;this.init=function(){a=$(".leaflet-control-zoom.leaflet-bar.leaflet-control")};this.showZoomControl=function(b){a.css("display","block");a.css("margin-left",0);a.css("margin-top",0);a.css("position","absolute");$(".leaflet-control-zoom.leaflet-bar.leaflet-control").remove();b&&(b.top&&(a.css("bottom",""),a.css("top",b.top)),b.bottom&&(a.css("top",""),a.css("bottom",b.bottom)),b.left&&(a.css("right",""),a.css("left",b.left)),b.right&&(a.css("left",""),a.css("right",b.right)));$(".leaflet-control-container").append(a)};this.hideZoomControl=function(){a.css("display","none")}};RMap.Tools.ShowScale=function(b){var a=b.map,d;this.init=function(){};this.showScale=function(b){b=RMap.extend({metric:!0,imperial:!1,maxWidth:100},b);L.control.scale({metric:b.metric,imperial:b.imperial,maxWidth:b.maxWidth}).addTo(a);d=$(".leaflet-control-scale.leaflet-control");d.css("margin-left",0);d.css("margin-top",0);d.css("position","absolute");b&&(b.top&&(d.css("bottom",""),d.css("top",b.top)),b.bottom&&(d.css("top",""),d.css("bottom",b.bottom)),b.left&&(d.css("right",""),d.css("left",b.left)),b.right&&(d.css("left",""),d.css("right",b.right)));$(".leaflet-control-container").append(d)};this.hideScale=function(){d.css("display","none")}};RMap.Tools.LocationToAddress=function(b){var a=b.map,d=b.appEvent,l=b.appCoord;this.init=function(){L.layerGroup().addTo(a);d.on(d.clearMap,function(a){doRemoveBuffer()})};this.locationToAddress=function(a,b,d,k){a=l.convert_gps84_To_gcj02(Number(a),Number(b));console.log(a);$.ajax({url:ResourceListConfig.amapGeocodeUrl+"\x26location\x3d"+a.lng+","+a.lat+"\x26extensions\x3dall\x26batch\x3dfalse\x26roadlevel\x3d0",success:function(a){"DAILY_QUERY_OVER_LIMIT"==a.info?console.warn("\u8bbf\u95ee\u5df2\u8d85\u51fa\u65e5\u8bbf\u95ee\u91cf\uff01"):"ACCESS_TOO_FREQUENT"==a.info?console.warn("\u5355\u4f4d\u65f6\u95f4\u5185\u8bbf\u95ee\u8fc7\u4e8e\u9891\u7e41\uff01"):"OK"==a.info&&d({address:a.regeocode.formatted_address,province:a.regeocode.addressComponent.province,city:a.regeocode.addressComponent.city,district:a.regeocode.addressComponent.district,township:a.regeocode.addressComponent.township})},error:function(a){console.error(a)}})};this.callbackFun_onResult=function(){}};RMap.Control.PointCluster=function(b){function a(a,b){for(var e=0;e<a.length;e++){var g={};for(items in a[e])g[items]=a[e][items];a[e].attribute=g;null!=a[e].pic?d(a[e]):b.pic&&(g=RMap.extend(a[e],b),l(g))}if(b.onClick)k.on("click",function(a){b.onClick(a.layer.options.attribute)})}function d(a){var b=new Image;b.src=a.pic;b.onload=function(){a.imgWidth=b.width;a.imgHeight=b.height;l(a)}}function l(a){var b=m.reSetCoordinate(a.lng,a.lat);null==b?console.error("addPointCluster\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=L.marker([b.lat,b.lng],{attribute:a.attribute}),a.pic&&(a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]),a=L.icon({iconUrl:a.pic,iconAnchor:a.anchor}),b.setIcon(a)),k.addLayer(b))}var h=b.map,n=b.appEvent,m=b.appCoord,k,g;this.init=function(){g=L.layerGroup().addTo(h);n.on(n.clearMap,function(a){doRemoveTrackPlay()})};this.addPointCluster=function(b,d){k=(new L.MarkerClusterGroup).addTo(h);g.addLayer(k);if(null!=d.pic){var e=new Image;e.src=d.pic;e.onload=function(){d.imgWidth=e.width;d.imgHeight=e.height;a(b,d)}}else a(b,d)};this.callbackFun_point=function(){};this.callbackFun_onClick=function(){};this.removePointCluster=function(a){g.clearLayers()}};RMap.Control.TrackPlay=function(b){function a(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=[a[d][1],a[d][0]];d=L.polyline(c,{color:"#323232",opacity:.5,weight:b.width,data:b});b.isShowArrow&&l(c,r);if(b.onClick)d.on("click",function(a){b.onClick(b)});p.addLayer(d)}function d(){y&&(document.body.removeChild(x),y=!1);p.clearLayers();u.clearLayers();r.clearLayers();v.clearLayers();c.off("mousemove",O)}function l(a,b){for(var c=0;c<a.length-1;c++){var d=a[c],e=a[c+1],f=e[0]-d[0],g=e[1]-d[1],k=[(d[0]+e[0])/2,(d[1]+e[1])/2],d=180*Math.atan2(e[0]-d[0],e[1]-d[1])/Math.PI;-180<d&&0>d&&(d=360+d);e=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");d=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+e+'" style\x3d"transform:rotate(-'+d+'deg)"/\x3e'});k=L.marker(k,{icon:d});0==f&&0==g||b.addLayer(k)}}function h(a,b,c,d){H&&(window.clearTimeout(I),b.getLatLng(),b.setLatLng([d[1],d[0]]),H=!1);var e=[c[0]+(d[0]-c[0])*J/20,c[1]+(d[1]-c[1])*J/20];b.setLatLng([e[1],e[0]]);J++;20>=J&&(I=window.setTimeout(function(){h(a,b,c,d)},a/20))}function n(a,b){var c=180*Math.atan2(b[1]-a[1],b[0]-a[0])/Math.PI;-180<c&&0>c&&(c=360+c);$(".RotatedMarker").css("text-align","center");return L.divIcon({iconAnchor:t.trackPointAnchor,className:"RotatedMarker",html:'\x3cimg src\x3d"'+t.trackPointPic+'" style\x3d"transform:rotate(-'+c+'deg)"/\x3e'})}function m(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=[a[d][1],a[d][0]];c=L.polyline(c,{color:b.color,opacity:b.opacity,weight:b.width,attribute:b});if(b.onClick)c.on("click",function(a){b.onClick(b)});u.addLayer(c)}function k(a){var b;b="\x3ctr class\x3d'tracktr'\x3e"+("\x3ctd style\x3d'width:140px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/span\x3e\x3c/td\x3e");b+="\x3ctd style\x3d'width:150px;'\x3e\x3ca id\x3d'trackListShowMapPoint' data-lng\x3d'"+a.lng+"' data-lat\x3d'"+a.lat+"' style\x3d'cursor:pointer;' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/a\x3e\x3c/td\x3e";b+="\x3ctd style\x3d'width:150px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.time+"'\x3e"+a.data.time+"\x3c/span\x3e\x3c/td\x3e";b+="\x3c/tr\x3e";$("#trackBody").after(b)}function g(){if(q.playing){var a=parseInt($(".j_curNum").text());a>=q.dataTotal+1&&--a;var b=q.slideBarW/q.dataTotal*a;$(".j_curNum").text(a+1);$(".sCur").stop().animate({width:b},q.speed,"linear");$(".sPoint").stop().animate({left:b},q.speed,"linear",function(){b<q.slideBarW?g():q.pause()});q.callback&&q.callback(parseInt($(".j_curNum").text())-1)}}var c=b.map,f=b.appEvent,e=b.appCoord,p,u,r,v,D,F=[],M=[],z=[],E=800,w=0,A=0,G=!1,t,y=!1,x,B=[],N="#02EE82 #0C7FF8 #D12DF7 #FF0000 #F5DF26 #91F90A".split(" "),R=L.icon({iconUrl:RMap.scriptLocation+"image/trackStart.png",iconAnchor:[13.5,39]}),S=L.icon({iconUrl:RMap.scriptLocation+"image/trackEnd.png",iconAnchor:[13.5,39]});this.init=function(){p=L.layerGroup().addTo(c);u=L.layerGroup().addTo(c);r=L.layerGroup().addTo(c);v=L.layerGroup().addTo(c);D=L.layerGroup();f.on(f.clearMap,function(a){d()})};this.addTrackPlay=function(b,d){p.clearLayers();u.clearLayers();r.clearLayers();v.clearLayers();B=[];A=0;F=[];M=[];z=[];c.on("mousemove",O);for(var f=[b],g=0;g<f.length;g++){var h={id:null,width:2,color:0,style:"",isCenter:!1,isShowArrow:!1,isShowTime:!1,showTimeKey:"time",trackPointPic:RMap.scriptLocation+"image/trackPoint.png",trackPointAnchor:[15.5,9],speed:800,data:null,onClick:null};d.speed&&(E=d.speed,q.speed=d.speed);d=RMap.extend(h,d);d.color=N[g%6];t=d;var l=f[g],h=RMap.extend(h,l.styleOption),m;m=l;for(var w=d,w=RMap.extend({proj:null},w),P=[],K=0;K<m.pointList.length;K++){var C=e.reSetCoordinate(m.pointList[K].lng,m.pointList[K].lat,w.proj),C=[C.lng,C.lat,m.pointList[K].data,m.trackId];P.push(C);B.push(C);C=L.circleMarker([C[1],C[0]],{radius:3,color:"white",weight:2,opacity:1,attribute:C[2],trackId:C[3]});z.push(C);C.on("click",T);v.addLayer(C);D.addLayer(C)}m=P;F.push({originalCoords:l.pointList,routeCoords:m,option:h});a(m,h);A<m.length&&(A=m.length);h=m;m=n(h[0],h[1]);m=L.marker([h[0][1],h[0][0]],{icon:m});M.push(m);v.addLayer(m);m=L.marker([h[0][1],h[0][0]],{icon:R});v.addLayer(m);h=L.marker([h[h.length-1][1],h[h.length-1][0]],{icon:S});v.addLayer(h);h="";l.pointList[0].data[t.showTimeKey]&&(h=l.pointList[0].data[t.showTimeKey]);l="";m='\x3cdiv class\x3d"conBtnWrap clearfix"\x3e';t.isShowTime&&(m='\x3cdiv class\x3d"conBtnWrap_showTime clearfix"\x3e',l='\x3cspan id\x3d"currentTime_track" class\x3d"right schedule_right"\x3e'+h+"\x3c/span\x3e");y&&x&&(document.body.removeChild(x),y=!1);x=document.createElement("div");x.id="conPanel";x.className="j_conPanel conPanelWrap";x.innerHTML='\x3cdiv class\x3d"slideBarWrap"\x3e\x3ca href\x3d"javascript:;" class\x3d"conPanelCloser"\x3e\x3c/a\x3e\x3cdiv class\x3d"j_sDefault sDefault"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_sCur sCur"\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" id\x3d"sPoint" class\x3d"sPoint"\x3e\x3c/a\x3e\x3c/div\x3e'+m+'\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPre left btnPre"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnRest left btnRest"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPause left btnPause stop"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnNext left btnNext"\x3e\x3c/a\x3e\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3cspan class\x3d"left schedule"\x3e\x3cem class\x3d"j_curNum"\x3e0\x3c/em\x3e/\x3cem class\x3d"j_dataTotal"\x3e100\x3c/em\x3e\x3c/span\x3e'+l+'\x3ca href\x3d"javascript:;" class\x3d"conPanelShowTrackList"\x3e\u663e\u793a\u5217\u8868\x3c/a\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f star--\x3e\x3cdiv id\x3d"trackList" class\x3d"relTableWrap relTableWrap_relation r-grid" style\x3d"height:215px;width:auto;margin-top:8px;display:none;"\x3e\t\x3cdiv class\x3d"r-grid-bd-box" id\x3d"trackResult_grid_bd_box" style\x3d"height:215px;padding-top:0px;margin-top:0px;"\x3e\t\t\x3ctable class\x3d"r-grid-center" style\x3d"width:auto;" id\x3d"trackListTable"\x3e\t\t\t\x3cthead\x3e\t\t\t\t\x3ctr\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 100px;"\x3e\u8bbe\u5907\u7f16\u53f7\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 150px;"\x3e\u5730\u5740\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 121px;"\x3e\u83b7\u53d6\u65f6\u95f4\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\x3c/tr\x3e\t\t\t\x3c/thead\x3e\t\t\t\x3ctbody id\x3d"trackBody"\x3e\t\t\t\x3c/tbody\x3e\t\t\x3c/table\x3e\t\x3c/div\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f end--\x3e';document.body.appendChild(x);t.top&&(x.style.top=t.top+"px");t.left&&(x.style.left=t.left+"px");q.init(A-1,c,U);y=!0;k(f[0].pointList[0])}if(1==d.isCenter){f=[];for(g=0;g<B.length;g++)f[g]=[B[g][1],B[g][0]];g=L.polyline(f);1==d.isCenter&&c.fitBounds(g.getBounds())}};this.callbackFun_trackObj=function(){};this.callbackFun_mouseMove=function(){};this.callbackFun_play=function(){};this.removeTrackPlay=function(){d()};var J,I,H=!1,U=function(a){w=a;if(w>=A)H=G=!0,window.clearTimeout(I);else if(0==w)for(H=G=!0,window.clearTimeout(I),u.clearLayers(),a=0;a<F.length;a++){var b=F[a].routeCoords,d=M[a],e=b[0];if(t.playCallback){var f={lng:e[0],lat:e[1],data:e[2],trackId:e[3]};k(f);t.playCallback(f)}e[2][t.showTimeKey]&&$("#currentTime_track").html(e[2][t.showTimeKey]);d.setLatLng([e[1],e[0]]);b=n(b[0],b[1]);d.setIcon(b)}else G=!1;if(!G)for(u.clearLayers(),a=0;a<F.length;a++)if(d=F[a].routeCoords,e=F[a].originalCoords,b=M[a],t.playCallback&&d&&(e={lng:e[w].lng,lat:e[w].lat,data:d[w][2],trackId:d[w][3]},k(e),t.playCallback(e)),d[w]&&3<d[w].length&&d[w][2][t.showTimeKey]&&$("#currentTime_track").html(d[w][2][t.showTimeKey]),w<d.length){var e=n(d[w-1],d[w]),f=d[w],g=c.getBounds();(f[0]<g.getWest()||f[0]>g.getEast()||f[1]<g.getSouth()||f[1]>g.getNorth())&&c.setView([f[1],f[0]]);J=0;H=!0;window.clearTimeout(I);h(q.speed,b,d[w-1],d[w]);b.setIcon(e);b=[];for(e=0;e<=w;e++)b.push(d[e]);m(b,F[a].option)}},Q=function(a){var b=L.GeometryUtil.closestLayer(c,z,a.latlng,!1),d=b.latlng;if(null!=b){var f=a.layerPoint;a=c.latLngToLayerPoint(d);f=Math.sqrt((f.x-a.x)*(f.x-a.x)+(f.y-a.y)*(f.y-a.y));point=b;t.mouseMoveCallback&&(d=e.reSetCoordinate_out(d.lng,d.lat),t.mouseMoveCallback({lng:d.lng,lat:d.lat,data:b.layer.options.attribute,trackId:b.layer.options.trackId}))}50<f&&t.mouseMoveCallback&&t.mouseMoveCallback(null)},O=function(a){a.dragging||t.mouseMoveCallback&&Q(a)},T=function(a){Q(a)},q={dataTotal:100,slideBarW:482,step:1,speed:E,playing:!1,callback:null,init:function(a,c,e){function f(a){var b=$(".sPoint"),c=$(".slideBarWrap").offset().left;a=a.clientX-c;c=q.slideBarW;0>a&&(a=0);a>c&&(a=c);b.css({left:a+"px"});$(".sCur").width(a);b=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(b+1);q.callback&&q.callback(parseInt($(".j_curNum").text())-1);return!1}a&&(q.dataTotal=a);e&&(q.callback=e);$(".j_dataTotal").text(q.dataTotal+1);$(".j_curNum").text(1);$(".conPanelCloser").on("click",function(a){d()});$("#trackListShowMapPoint").die().live("click",function(){var a=$(this).attr("data-lng"),c=$(this).attr("data-lat"),d=new RMap.LightPoint(b);d.init();d.hideLightPoint();d.showLightPoint(a,c);setTimeout(function(){d.hideLightPoint()},6E4)});$(".conPanelShowTrackList").on("click",function(a){"\u663e\u793a\u5217\u8868"==$(this).html()?($(this).html("\u6536\u8d77\u5217\u8868"),$("#trackList").show()):"\u6536\u8d77\u5217\u8868"==$(this).html()&&($(this).html("\u663e\u793a\u5217\u8868"),$("#trackList").hide())});$(".btnPause").on("click",function(a){$(this).hasClass("stop")?(w>=A-1&&q.stop(),$(".j_sCur").width()<$(".j_sDefault").width()&&q.start()):q.pause();a.stopPropagation()});$(".j_btnRest").on("click",function(){q.stop()});$(".j_btnNext").on("click",function(){var a=q.step;16>a&&(q.step=2*a,q.speed/=2,q.playing&&q.start());$(this).next().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnNext").next().find(".mulText").fadeOut()},800)});$(".j_btnPre").on("click",function(){var a=q.step;1<a&&(q.step=a/2,q.speed*=2,q.playing&&q.start());$(this).prev().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnPre").prev().find(".mulText").fadeOut()},800)});$(".sPoint").on("mousedown",function(a){var b=$(".sPoint"),c=$(".slideBarWrap").offset().left,d;$(document).on("mousemove.slideBar",function(a){a=a.clientX-c;var e=q.slideBarW;0>a&&(a=0);a>e&&(a=e);b.css({left:a+"px"});$(".sCur").width(a);d=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(d+1);return!1});$(document).on("mouseup.slideBar",function(a){$(document).off("mousemove.slideBar");$(document).off("mouseup.slideBar");q.callback&&q.callback(parseInt($(".j_curNum").text())-1)});return!1});$(".j_sDefault").on("click",f);$(".j_sCur").on("click",f);$(".j_conPanel").on("mousedown",function(a){var b=$(".j_conPanel"),d=a.clientX-b.offset().left,e=a.clientY-b.offset().top;$(document).on("mousemove.conPanel",function(a){var f=a.clientX-d;a=a.clientY-e;var g=0,h=0,k=c.getContainer();if(k){g=k.offsetLeft;h=k.offsetTop+document.body.scrollTop;do k=k.offsetParent,g+=k.offsetLeft,h+=k.offsetTop;while("BODY"!=k.tagName)}var k=g+c.getSize()[0]-$(".j_conPanel").width(),l=h+c.getSize()[1]-$(".j_conPanel").height();f<g&&(f=g);a<h&&(a=h);f>k&&(f=k);a>l&&(a=l);b.css({left:f+"px",top:a+"px"});return!1});$(document).on("mouseup.conPanel",function(a){$(document).off("mousemove.conPanel");$(document).off("mouseup.conPanel")});return!1})},stop:function(){$(".btnPause").addClass("stop");q.playing=!1;$(".sCur").stop();$(".sPoint").stop();q.step=1;q.speed=E;$(".j_curNum").text(1);$(".sCur").width(0);$(".sPoint").css("left",0);q.callback&&q.callback(parseInt($(".j_curNum").text())-1)},pause:function(){$(".btnPause").addClass("stop");q.playing=!1;g()},start:function(){$(".btnPause").removeClass("stop");q.playing=!0;g()}}};RMap.Query.QueryLayer=function(b){function a(a,b){b=RMap.extend({queryWhere:"1\x3d1",geoQueryType:"intersects"},b);var c=L.esri.query({url:a.url});if(b.queryPointList){for(var h=b.queryPointList,k=[],l=0;l<h.length;l++){var n=g.reSetCoordinate(h[l][0],h[l][1],b.proj);k[l]=[n.lat,n.lng]}h=L.polygon(k);"intersects"==b.geoQueryType?c.intersects(h):"within"==b.geoQueryType&&c.within(h)}c.where(b.queryWhere);c.run(function(a,c){d(c,b)})}function d(a,b){var d=L.geoJSON(a,{pointToLayer:function(a,c){if(b.pic){var d=L.icon({iconUrl:b.pic,iconAnchor:b.anchor});return L.marker(c,{icon:d})}return L.marker(c)}});if(a.features&&!(0>=a.features.length)){var g=a.features[0].geometry.type;"Point"!=g&&(g=l(g,b),d.setStyle(g));c.addLayer(d);if(b.onClick)d.on("click",function(a){a.layer.feature.properties.clickPosition=a.latlng;b.onClick(a.layer.feature.properties)});if(b.onResult)b.onResult(a.features)}}function l(a,b){if("MultiLineString"==a){var c={color:"#3388ff",width:2,opacity:.8};b=RMap.extend(c,b);return{color:b.color,opacity:b.opacity,weight:b.width}}return"Polygon"==a?(c={color:"#3388ff",width:2,opacity:.3,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5},b=RMap.extend(c,b),{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity}):null}function h(a,b){var c="",h="";if(b.queryPointList){for(var c=b.queryPointList,k=0;k<c.length;k++)var l=g.reSetCoordinate(c[k][0],c[k][1],b.proj),h=0==k?h+("(the_geom,POLYGON(("+l.lng+" "+l.lat):h+(","+l.lng+" "+l.lat);h+=")))";"intersects"==b.geoQueryType?h="INTERSECTS"+h:"within"==b.geoQueryType&&(h="WITHIN"+h)}b.queryWhere?(c=b.queryWhere,""!=h&&(c+=" AND "+h)):c=h;h=L.Util.extend({service:"WFS",version:"1.0.0",request:"GetFeature",typeName:a.typeName,outputFormat:"text/javascript",format_options:"callback:getJson",SrsName:a.srsName,cql_filter:c});h=a.url+L.Util.getParamString(h);$.ajax({url:h,dataType:"jsonp",jsonpCallback:"getJson",success:function(a){d(a,b)}})}function n(){c.clearLayers();k.dispatch(k.clearDrawMeasure)}var m=b.map,k=b.appEvent,g=b.appCoord,c;this.init=function(){c=L.layerGroup().addTo(m);k.on(k.clearMap,function(a){n()});k.on(k.clearQueryResult,function(a){n()})};this.queryLayer=function(b,c){for(var d=RMap.config.thematicLayer,g=0;g<d.length;g++){var k=d[g];b==k.layerName&&("ArcGISRest"==k.layerType?a(k,c):"WFS_GeoServer"==k.layerType&&h(k,c))}};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){};this.removeQueryResult=function(){n();k.dispatch(k.clearQueryResult)}};RMap.Query.QueryLayerByPointBuffer=function(b){var a=b.appEvent,d=new RMap.Tools.Buffer(b),l=new RMap.Query.QueryLayer(b);this.init=function(){d.init();l.init();a.on(a.clearMap,function(a){d.removeBuffer()});a.on(a.clearQueryResult,function(a){d.removeBuffer()})};this.queryLayerByPointBuffer=function(a,b,m,k,g){var c=g.styleIn;c||(c={});c.callback=function(a){g.queryPointList=a.pointList;l.queryLayer(k,g)};c.proj=g.proj;d.bufferPoint(a,b,m,c)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};RMap.Query.QueryLayerByRect=function(b){var a=b.appEvent,d=new RMap.Draw.DrawRect(b),l=new RMap.Query.QueryLayer(b);this.init=function(){d.init();l.init();a.on(a.clearMap,function(a){d.removeDrawRect()});a.on(a.clearQueryResult,function(a){d.removeDrawRect()})};this.queryLayerByRect=function(a,b){b=RMap.extend({id:null,callback:null,styleIn:{outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5},showMeasurements:!1},b);d.drawRect(function(d){b.queryPointList=d.pointList;l.queryLayer(a,b)},b.styleIn)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};