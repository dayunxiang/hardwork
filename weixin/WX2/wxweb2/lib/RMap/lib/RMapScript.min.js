///<jscompress sourcefile="ClassManager.js" />
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

/**
 * @requires OpenLayers/SingleFile.js
 */

/**
 * Constructor: OpenLayers.Class
 * Base class used to construct all other classes. Includes support for 
 *     multiple inheritance. 
 *     
 * This constructor is new in OpenLayers 2.5.  At OpenLayers 3.0, the old 
 *     syntax for creating classes and dealing with inheritance 
 *     will be removed.
 * 
 * To create a new OpenLayers-style class, use the following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(prototype);
 * (end)
 *
 * To create a new OpenLayers-style class with multiple inheritance, use the
 *     following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(Class1, Class2, prototype);
 * (end)
 * 
 * Note that instanceof reflection will only reveal Class1 as superclass.
 *
 *////<jscompress sourcefile="Hashtable.js" />
/**
 * 哈希表
 *////<jscompress sourcefile="BaseWidget.js" />

 //地图管理类
///<jscompress sourcefile="AppEvent.js" />
/**
 * 全局事件类，可以进行项目全局的监听和派发
 *////<jscompress sourcefile="DataManager.js" />
/**
 * 数据共享管理
 *////<jscompress sourcefile="BaseMapLayer.js" />
//天地图
///<jscompress sourcefile="GCJLayer.js" />
//国测局地图
///<jscompress sourcefile="TDTLayer.js" />
//天地图
///<jscompress sourcefile="ViewMap.js" />
/**
 * @class 地图浏览
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLayer.js" />
/**
 * @class 添加图层
 * @param {Object} classOption
 *////<jscompress sourcefile="SwitchMap.js" />
/**
 * @class 切换底图
 * @param {Object} classOption
 *////<jscompress sourcefile="AddCirclePoint.js" />
/**
 * @class 添加圆形点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLightPoint.js" />
/**
 * @class 添加高亮点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLine.js" />
/**
 * @class 添加折线
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPoint.js" />
/**
 * @class 添加图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPointList.js" />
/**
 * @class 添加一组图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPolygon.js" />
/**
 * @class 添加面
 * @param {Object} classOption
 *////<jscompress sourcefile="AddTextPoint.js" />
/**
 * @class 添加文字标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddComplexPoint.js" />
/**
 * @class 添加复合点位
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPoint.js" />
/**
 * @class 绘制点
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawCircle.js" />
/**
 * @class 绘制圆形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawLine.js" />
/**
 * @class 绘制折线
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPolygon.js" />
/**
 * @class 绘制多边形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawRect.js" />
/**
 * @class 绘制矩形
 * @param {Object} classOption
 *////<jscompress sourcefile="Measure.js" />
/**
 * @class 测量
 * @param {Object} classOption
 *////<jscompress sourcefile="AlwaysShowWindow.js" />
/**
 * @class 常显式气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="PopWindow.js" />
/**
 * @class 气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="Buffer.js" />
/**
 * @class 缓冲
 * @param {Object} classOption
 *////<jscompress sourcefile="ClearMap.js" />
/**
 * @class 清空地图
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertCoord.js" />
/**
 * @class 坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertEncryptCoord.js" />
/**
 * @class 加密坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="GetMapInformation.js" />
/**
 * @class 获取地图信息
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowCoordinate.js" />
/**
 * @class 显示地图坐标
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowZoomControl.js" />
/**
 * @class 显示地图放大缩小控制按钮
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowScale.js" />
/**
 * @class 显示比例尺
 * @param {Object} classOption
 *////<jscompress sourcefile="LocationToAddress.js" />
/**
 * @class 坐标转地址
 * @param {Object} classOption
 *////<jscompress sourcefile="PointCluster.js" />
/**
 * @class 点聚合分析
 * @param {Object} classOption
 *////<jscompress sourcefile="HeatMap.js" />
/**
 * @class 热力图分析
 * @param {Object} classOption
 *////<jscompress sourcefile="TrackPlay.js" />
/**
 * @class 轨迹回放
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayer.js" />
/**
 * @class 查询（查询对象为发布的图层服务）
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByRect.js" />
/**
 * @class 拉框查询（查询对象为发布的图层服务）
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByPointBuffer.js" />
/**
 * @class 点缓冲查询（查询对象为发布的图层服务）
 * @param {Object} classOption
 *////<jscompress sourcefile="BufferSelect.js" />
/**
 * @class 点缓冲选择查询，（查询在面中的点，查询对象为一组点数据）
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawSelect.js" />
/**
 * @class 画图（矩形、圆形、多边形）选择查询，默认绘制矩形（查询在面中的点，查询对象为一组点数据）
 * @param {Object} classOption
 *////<jscompress sourcefile="PointSelect.js" />
/**
 * @class 点选查询（查询点选中的图形，查询对象为调用接口添加的图形）
 * @param {Object} classOption
 *////<jscompress sourcefile="PolygonSelect.js" />
/**
 * @class 面选择查询（查询在面中的点，查询对象为一组点数据）
 * @param {Object} classOption
 */RMap.Class=function(){var b=arguments.length,a=arguments[0],e=arguments[b-1],m="function"==typeof e.initialize?e.initialize:function(){a.prototype.initialize.apply(this,arguments)};1<b?(b=[m,a].concat(Array.prototype.slice.call(arguments).slice(1,b-1),e),RMap.inherit.apply(null,b)):m.prototype=e;return m};RMap.inherit=function(b,a){var e=function(){};e.prototype=a.prototype;b.prototype=new e;var m,g,e=2;for(m=arguments.length;e<m;e++)g=arguments[e],"function"===typeof g&&(g=g.prototype),RMap.extend(b.prototype,g)};RMap.extend=function(b,a){b=b||{};if(a){for(var e in a){var m=a[e];void 0!==m&&(b[e]=m)}"function"==typeof window.Event&&a instanceof window.Event||!a.hasOwnProperty||!a.hasOwnProperty("toString")||(b.toString=a.toString)}return b};RMap.Hashtable=function(){var b=[];this.add=function(a,e){for(var m=!1,g=0;g<b.length;g++)b[g][0]==a&&(b[g][1]=e,m=!0);0==m&&b.push([a,e])};this.get=function(a){for(var e=0;e<b.length;e++)if(b[e][0]==a)return b[e][1];return null};this.foreach=function(a){for(var e=0;e<b.length;e++)a(b[e][0],b[e][1])};this.remove=function(a){for(var e=0;e<b.length;e++)b[e][0]==a&&b.splice(e,1)};this.clear=function(){}};RMap.BaseWidget=RMap.Class({initialize:function(){},map:null});RMap.AppEvent=function(){this.clearMap="tools_clearMap";this.clearDrawMeasure="clearDrawMeasure";this.clearQueryResult="clearQueryResult";this.clearHightLight="clearHightLight";this.addShareData="dataManager_addShareData";this.getShareData="dataManager_getShareData";this.removeShareData="dataManager_removeShareData";this.onShareDataChange="dataManager_onShareDataChange";var b=document.createElement("a");this.dispatch=function(a,e,m){var g=document.createEvent("Event");g.initEvent(a,e,m);b.dispatchEvent(g)};this.on=function(a,e){b.addEventListener(a,e)}};RMap.AppCoord=function(b){function a(a,d){var c=n(a,d);return g(c.lng,c.lat)}function e(a,d){var c=m(a,d);return l(c.lng,c.lat)}function m(a,E){var p=h(a-105,E-35),b=f(a-105,E-35),n=E/180*d,e=Math.sin(n),e=1-k*e*e,g=Math.sqrt(e),p=180*p/(c*(1-k)/(e*g)*d),b=180*b/(c/g*Math.cos(n)*d);return{lng:a+b,lat:E+p}}function g(a,E){var p=h(a-105,E-35),b=f(a-105,E-35),n=E/180*d,e=Math.sin(n),e=1-k*e*e,g=Math.sqrt(e),p=180*p/(c*(1-k)/(e*g)*d),b=180*b/(c/g*Math.cos(n)*d);return{lng:2*a-(a+b),lat:2*E-(E+p)}}function l(a,c){var d=Math.sqrt(a*a+c*c)+2E-5*Math.sin(c*p),k=Math.atan2(c,a)+3E-6*Math.cos(a*p);return{lng:d*Math.cos(k)+.0065,lat:d*Math.sin(k)+.006}}function n(a,c){var d=a-.0065,k=c-.006,f=Math.sqrt(d*d+k*k)-2E-5*Math.sin(k*p),d=Math.atan2(k,d)-3E-6*Math.cos(d*p);return{lng:f*Math.cos(d),lat:f*Math.sin(d)}}function h(a,c){var k=-100+2*a+3*c+.2*c*c+.1*a*c+.2*Math.sqrt(Math.abs(a)),k=k+2*(20*Math.sin(6*a*d)+20*Math.sin(2*a*d))/3,k=k+2*(20*Math.sin(c*d)+40*Math.sin(c/3*d))/3;return k+=2*(160*Math.sin(c/12*d)+320*Math.sin(c*d/30))/3}function f(a,c){var k=300+a+2*c+.1*a*a+.1*a*c+.1*Math.sqrt(Math.abs(a)),k=k+2*(20*Math.sin(6*a*d)+20*Math.sin(2*a*d))/3,k=k+2*(20*Math.sin(a*d)+40*Math.sin(a/3*d))/3;return k+=2*(150*Math.sin(a/12*d)+300*Math.sin(a/30*d))/3}this.reSetCoordinate=function(c,d,k){c=void 0==c||void 0==d||null==c||null==d||NaN==c||NaN==d?null:{lng:Number(c),lat:Number(d)};"wgs84"!=k&&"gcj02"!=k&&"bd09"!=k&&(k=b?b:"wgs84");if("wgs84"==k){var f=c.lng,p=c.lat,h;"wgs84"==RMap.baseMapType?h={lng:f,lat:p}:"bd09"==RMap.baseMapType?h=e(f,p):"gcj02"==RMap.baseMapType&&(h=m(f,p));c=h}else"gcj02"==k?(h=c.lng,p=c.lat,"wgs84"==RMap.baseMapType?newCoord=f=g(h,p):"bd09"==RMap.baseMapType?f=l(h,p):"gcj02"==RMap.baseMapType&&(f={lng:h,lat:p}),c=f):"bd09"==k&&(h=c.lng,f=c.lat,"wgs84"==RMap.baseMapType?p=a(h,f):"bd09"==RMap.baseMapType?p={lng:h,lat:f}:"gcj02"==RMap.baseMapType&&(p=n(h,f)),c=p);return c};this.reSetCoordinate_out=function(c,d,k){"wgs84"!=k&&"gcj02"!=k&&"bd09"!=k&&(k=b?b:"wgs84");c={lng:c,lat:d};if("wgs84"==k){var f=c.lng,p=c.lat,h;"wgs84"==RMap.baseMapType?h={lng:f,lat:p}:"bd09"==RMap.baseMapType?(h=a(f,p),h={lng:h.lng,lat:h.lat}):"gcj02"==RMap.baseMapType&&(h=g(f,p),h={lng:h.lng,lat:h.lat});h.proj="wgs84";c=h}else"gcj02"==k?(h=c.lng,p=c.lat,"wgs84"==RMap.baseMapType?(h=m(h,p),f={lng:h.lng,lat:h.lat}):"bd09"==RMap.baseMapType?(h=n(h,p),f={lng:h.lng,lat:h.lat}):"gcj02"==RMap.baseMapType&&(f={lng:h,lat:p}),f.proj="gcj02",c=f):"bd09"==k&&(h=c.lng,f=c.lat,"wgs84"==RMap.baseMapType?(h=e(h,f),p={lng:h.lng,lat:h.lat}):"bd09"==RMap.baseMapType?p={lng:h,lat:f}:"gcj02"==RMap.baseMapType&&(h=l(h,f),p={lng:h.lng,lat:h.lat}),p.proj="bd09",c=p);return c};var d=3.141592653589793,c=6378245,k=.006693421622965943,p=3E3*d/180;this.convert_bd09_To_gps84=function(c,k){return a(c,k)};this.convert_gps84_To_bd09=function(c,a){return e(c,a)};this.convert_gps84_To_gcj02=function(c,a){return m(c,a)};this.convert_gcj02_To_gps84=function(c,a){return g(c,a)};this.convert_gcj02_To_bd09=function(c,a){return l(c,a)};this.convert_bd09_To_gcj02=function(c,a){return n(c,a)}};RMap.DataManager=function(b){function a(a){l.add(a.key,a.value);g.dispatch(g.onShareDataChange,{key:a.key,value:a.value})}function e(a,h){var f=l.get(a);h&&h(f)}function m(a){l.remove(a)}var g=b.appEvent,l=new RMap.Hashtable;this.init=function(){g.on(g.addShareData,a);g.on(g.getShareData,e);g.on(g.removeShareData,m)}};RMap.config=ResourceListConfig;RMap.Map=function(b,a){function e(a){var c=a.type||"TDT_ArcGISCache",d=a.name||"",f=a.url||"{srciptUrl}/map/TDTSL/_alllayers";if(void 0==f||null==f)f=void 0;else if(-1!=f.search("{srciptUrl}")){var h=RMap.scriptLocation.split("/"),b=h[0];if(".."==b)for(var e=0;e<h.length-2;e++)b+="/..";else b=h[0]+"//"+h[2];f=f.replace("{srciptUrl}",b)}var n;switch(c){case "OnLineMap":c=new RMap.BaseMapLayer;n=c.OnLineMap(a);break;case "TDT_ArcGISCache":c=new RMap.TDTLayer;n=c.ArcGISTileLayer(f,d);break;case "GCJ_ArcGISCache":c=new RMap.GCJLayer;n=c.ArcGISTileLayer(f,d);break;case "ArcGISTiledMapLayer":c=new RMap.BaseMapLayer;n=c.ArcGISTiledMapLayer(a);break}return n}var m=RMap.scriptUrl.split("?");if(m&&1<m.length)for(var g=m[1].split("\x26"),m=0;m<g.length;m++){var l=g[m].split("\x3d");"key"==l[0]&&(RMap.config.license||(RMap.config.license=[]),RMap.config.license.push(l[1].toString()))}for(var n="EPSG:4326",g=function(){for(var c=RMap.extend({center:RMap.config.center,zoom:RMap.config.zoom,extent:RMap.config.extent,minZoom:RMap.config.minZoom,maxZoom:RMap.config.maxZoom,type:["GDSL_OL"]},a),d=0;d<c.type.length;d++)if("TDTSL"==c.type[d]||"TDTYX"==c.type[d])n="EPSG:4326",RMap.baseMapType="wgs84";else if("BDSL"==c.type[d]||"BDYX"==c.type[d])n="EPSG:102113",RMap.baseMapType="bd09";else if("GDSL"==c.type[d]||"GDYX"==c.type[d])n="EPSG:102113",RMap.baseMapType="gcj02";else if("GGSL"==c.type[d]||"GGYX"==c.type[d])n="EPSG:102113",RMap.baseMapType="gcj02";else if("TDTSL_OL"==c.type[d]||"TDTYX_OL"==c.type[d])n="EPSG:3857",RMap.baseMapType="wgs84";else if("BDSL_OL"==c.type[d])n="EPSG:3857",RMap.baseMapType="gcj02";else if("GDSL_OL"==c.type[d]||"GGSL_OL"==c.type[d]||"GGSL_OL"==c.type[d]||"GGDEM_OL"==c.type[d]||"GGYX_OL"==c.type[d])n="EPSG:3857",RMap.baseMapType="gcj02";return c}(),h=RMap.config.baseLayer,l=[],f,m=0;m<h.length;m++)for(var d=h[m],c=0;c<g.type.length;c++)d.name==g.type[c]&&(d.ESPG&&(n="EPSG:"+d.ESPG,RMap.sysProjection=n),f=e(h[m]),f.eachLayer(function(c){RMap.baseLayerList.push(c)}),0==c&&l.push(f));m=new RMap.AppCoord(g.proj);h=m.reSetCoordinate(g.center[0],g.center[1],g.proj);g.center[0]=h.lat;g.center[1]=h.lng;if(null==RMap.crs||void 0==RMap.crs)RMap.crs=L.CRS.EPSG3857;g=L.map(b,{crs:RMap.crs,center:g.center,zoom:g.zoom,layers:l,zoomControl:!1,closePopupOnClick:!1});L.control.zoom({zoomInTitle:"\u653e\u5927",zoomOutTitle:"\u7f29\u5c0f"}).addTo(g);l=new RMap.AppEvent;(new RMap.DataManager({appEvent:l})).init();return new RMap.InterfaceManager({map:g,appEvent:l,appConfig:RMap.config,appCoord:m})};RMap.InterfaceManager=function(b){var a=new RMap.View.ViewMap(b);this.center=a.center;this.zoom=a.zoom;this.centerZoom=a.centerZoom;this.extent=a.extent;this.extentByData=a.extentByData;a=new RMap.Layer.SwitchMap(b);a.init();this.switchMap=a.switchMap;a=new RMap.Layer.AddLayer(b);a.init();this.addLayer=a.addLayer;this.removeLayer=a.removeLayer;a=new RMap.Tools.Buffer(b);a.init();this.bufferPoint=a.bufferPoint;this.removeBuffer=a.removeBuffer;a=new RMap.Graphic.AddPolygon(b);a.init();this.addPolygon=a.addPolygon;this.removePolygon=a.removePolygon;a=new RMap.Graphic.AddLine(b);a.init();this.addLine=a.addLine;this.removeLine=a.removeLine;a=new RMap.InfoWindow.PopWindow(b);a.init();this.showPopWindow=a.showPopWindow;this.hidePopWindow=a.hidePopWindow;a=new RMap.InfoWindow.AlwaysShowWindow(b);a.init();this.addAlwaysShowWindow=a.addAlwaysShowWindow;this.removeAlwaysShowWindow=a.removeAlwaysShowWindow;a=new RMap.Draw.DrawCircle(b);a.init();this.drawCircle=a.drawCircle;this.removeDrawCircle=a.removeDrawCircle;a=new RMap.Draw.DrawRect(b);a.init();this.drawRect=a.drawRect;this.removeDrawRect=a.removeDrawRect;a=new RMap.Draw.DrawPolygon(b);a.init();this.drawPolygon=a.drawPolygon;this.removeDrawPolygon=a.removeDrawPolygon;a=new RMap.Draw.DrawLine(b);a.init();this.drawLine=a.drawLine;this.removeDrawLine=a.removeDrawLine;a=new RMap.Draw.DrawPoint(b);a.init();this.drawPoint=a.drawPoint;this.removeDrawPoint=a.removeDrawPoint;this.clearMap=(new RMap.Tools.ClearMap(b)).clearMap;this.convertCoord=(new RMap.Tools.ConvertCoord(b)).convertCoord;this.convertEncryptCoord=(new RMap.Tools.ConvertEncryptCoord(b)).convertEncryptCoord;a=new RMap.Tools.ShowCoordinate(b);a.init();this.showCoordinate=a.showCoordinate;this.hideCoordinate=a.hideCoordinate;a=new RMap.Tools.ShowZoomControl(b);a.init();this.showZoomControl=a.showZoomControl;this.hideZoomControl=a.hideZoomControl;a=new RMap.Tools.ShowScale(b);a.init();this.showScale=a.showScale;this.hideScale=a.hideScale;a=new RMap.Tools.GetMapInformation(b);a.init();this.getCoordinate=a.getCoordinate;this.stopGetCoordinate=a.stopGetCoordinate;this.getMapExtent=a.getMapExtent;this.getMapLevel=a.getMapLevel;a=new RMap.Tools.LocationToAddress(b);a.init();this.locationToAddress=a.locationToAddress;a=new RMap.Measure.Measure(b);a.init();this.measureLength=a.measureLength;this.measureArea=a.measureArea;this.measureCircle=a.measureCircle;this.measureRect=a.measureRect;this.removeMeasure=a.removeMeasure;a=new RMap.Control.PointCluster(b);a.init();this.addPointCluster=a.addPointCluster;this.removePointCluster=a.removePointCluster;a=new RMap.Control.HeatMap(b);a.init();this.addHeatMap=a.addHeatMap;this.removeHeatMap=a.removeHeatMap;a=new RMap.Control.TrackPlay(b);a.init();this.addTrackPlay=a.addTrackPlay;this.removeTrackPlay=a.removeTrackPlay;a=new RMap.Graphic.AddLightPoint(b);a.init();this.addLightPoint=a.addLightPoint;this.removeLightPoint=a.removeLightPoint;a=new RMap.Graphic.AddPoint(b);a.init();this.addPoint=a.addPoint;this.removePoint=a.removePoint;a=new RMap.Graphic.AddPointList(b);a.init();this.addPointList=a.addPointList;this.removePointList=a.removePointList;a=new RMap.Graphic.AddCirclePoint(b);a.init();this.addCirclePoint=a.addCirclePoint;this.removeCirclePoint=a.removeCirclePoint;a=new RMap.Graphic.AddTextPoint(b);a.init();this.addTextPoint=a.addTextPoint;this.removeTextPoint=a.removeTextPoint;a=new RMap.Graphic.AddComplexPoint(b);a.init();this.addComplexPoint=a.addComplexPoint;this.removeComplexPoint=a.removeComplexPoint;a=new RMap.Query.PointSelect(b);a.init();this.pointSelect=a.pointSelect;a=new RMap.Query.PolygonSelect(b);a.init();this.polygonSelect=a.polygonSelect;this.removePolygonSelect=a.removePolygonSelect;a=new RMap.Query.DrawSelect(b);a.init();this.drawSelect=a.drawSelect;this.removeDrawSelect=a.removeDrawSelect;a=new RMap.Query.BufferSelect(b);a.init();this.bufferSelect=a.bufferSelect;this.removeBufferSelect=a.removeBufferSelect;a=new RMap.Query.QueryLayer(b);a.init();this.queryLayer=a.queryLayer;this.removeQueryResult=a.removeQueryResult;a=new RMap.Query.QueryLayerByRect(b);a.init();this.queryLayerByRect=a.queryLayerByRect;b=new RMap.Query.QueryLayerByPointBuffer(b);b.init();this.queryLayerByPointBuffer=b.queryLayerByPointBuffer};RMap.BaseMapLayer=function(b){this.OnLineMap=function(a){var b=[];"GDSL_OL"==a.name&&(b=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b]));if("GDYX_OL"==a.name)var b=L.tileLayer.chinaProvider("GaoDe.Satellite.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),m=L.tileLayer.chinaProvider("GaoDe.Satellite.Annotion",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b,m]);"GEOQ_OL"==a.name&&(b=L.tileLayer.chinaProvider("Geoq.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b]));return b};this.ArcGISTiledMapLayer=function(a){a.EPSG&&a.resolutions?RMap.crs=new L.Proj.CRS("EPSG:"+a.EPSG,a.proj4,{origin:a.origin,resolutions:a.resolutions}):"3857"==a.EPSG&&void 0==a.resolutions&&(RMap.crs=L.CRS.EPSG3857);var b=[];a=L.esri.tiledMapLayer({url:a.url});return b=L.layerGroup([a])}};RMap.GCJLayer=function(b){var a=[156543.03392800014,78271.51696399994,39135.75848200009,19567.87924099992,9783.93962049996,4891.96981024998,2445.98490512499,1222.992452562495,611.4962262813797,305.74811314055756,152.87405657041106,76.43702828507324,38.21851414253662,19.10925707126831,9.554628535634155,4.77731426794937,2.388657133974685,1.1943285668550503,.5971642835598172,.29858214164761665,.14929107082380833,.07464553541190416];RMap.crs=new L.Proj.CRS("EPSG:102113","+proj\x3dmerc +lon_0\x3d0 +k\x3d1 +x_0\x3d0 +y_0\x3d0 +a\x3d6378137 +b\x3d6378137 +units\x3dm +no_defs",{origin:[-2.0037508342787E7,2.0037508342787E7],resolutions:a});this.ArcGISTileLayer=function(b,g){var l=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+g,continuousWorld:!0});l.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var h=a.z.toString(16).toUpperCase();return"L"+e(h,2)},x:function(){var h=a.y.toString(16).toUpperCase();return"R"+e(h,8)},y:function(){var h=a.x.toString(16).toUpperCase();return"C"+e(h,8)}}))};return L.layerGroup([l])};var e=function(a,b){for(var e=a.length;e<b;)a="0"+a,e++;return a}};RMap.TDTLayer=function(b){var a=[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.1457672119140625E-5,1.0728836059570312E-5,5.364418029785156E-6,2.682209014892578E-6,1.341104507446289E-6,6.705522537231445E-7,3.3527612686157227E-7];RMap.crs=new L.Proj.CRS("EPSG:4326","+proj\x3dlonglat +datum\x3dWGS84 +no_defs",{origin:[-180,90],resolutions:a});this.ArcGISTileLayer=function(b,g){var l=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+g,continuousWorld:!0});l.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var h=a.z.toString(16).toUpperCase();return"L"+e(h,2)},x:function(){var h=a.y.toString(16).toUpperCase();return"R"+e(h,8)},y:function(){var h=a.x.toString(16).toUpperCase();return"C"+e(h,8)}}))};return L.layerGroup([l])};var e=function(a,b){for(var e=a.length;e<b;)a="0"+a,e++;return a}};RMap.View.ViewMap=function(b){var a=b.map,e=b.appCoord;this.center=function(b,g,l){l=RMap.extend({proj:null},l);g=e.reSetCoordinate(b,g,l.proj);null==g?console.error("center\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=g.lng,g=g.lat,a.setView([Number(g),Number(b)]))};this.zoom=function(b){a.setZoom(b)};this.centerZoom=function(b,g,l,n){n=RMap.extend({proj:null},n);g=e.reSetCoordinate(b,g,n.proj);null==g?console.error("centerZoom\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=g.lng,g=g.lat,a.setView([Number(g),Number(b)],l))};this.extent=function(b,g,l,n,h){h=RMap.extend({proj:null},h);b=e.reSetCoordinate(b,g,h.proj);l=e.reSetCoordinate(l,n,h.proj);a.fitBounds([[b.lat,b.lng],[l.lat,l.lng]])};this.extentByData=function(b,g){g=RMap.extend({proj:null},g);for(var l=[],n=0;n<b.length;n++){var h=e.reSetCoordinate(b[n][0],b[n][1],g.proj);l[n]=[h.lat,h.lng]}l=L.polygon(l);a.fitBounds(l.getBounds())}};RMap.Layer.AddLayer=function(b){function a(a){e.eachLayer(function(b){if(b&&b.options.attribution){var h=b.options.attribution.split("|");if("addLayer"==h[0])if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var f=0;f<a.length;f++)h[1]==a[f]&&e.removeLayer(b)}else e.removeLayer(b)}})}var e=b.map,m=b.appEvent,g=b.appCoord;this.init=function(){m.on(m.clearMap,function(b){a()})};this.addLayer=function(a,b){b=RMap.extend({opacity:1},b);for(var h=RMap.config.thematicLayer,f=0;f<h.length;f++){var d=h[f];if(a==d.layerName){if("ArcGISRest"==d.layerType){var c=d,k=b;1==c.isQueryLayer?(k.where||(k.where="1\x3d1"),L.esri.featureLayer({url:c.url,opacity:k.opacity,where:k.where,attribution:"addLayer|"+c.layerName}).addTo(e)):L.esri.dynamicMapLayer({url:c.url,opacity:k.opacity,attribution:"addLayer|"+c.layerName}).addTo(e)}else"WFS_GeoServer"==d.layerType&&L.tileLayer.wms(d.url,{layers:d.typeName,format:"image/png",transparent:!0,opacity:b.opacity,attribution:"addLayer|"+d.layerName}).addTo(e);b.isCenter&&d.extent&&(c=g.reSetCoordinate(d.extent[0],d.extent[1]),d=g.reSetCoordinate(d.extent[2],d.extent[3]),e.fitBounds([[c.lat,c.lng],[d.lat,d.lng]]))}}};this.removeLayer=function(b){a(b)}};RMap.Layer.SwitchMap=function(b){var a=b.map,e=b.appEvent;this.init=function(){e.on(e.clearMap,function(a){})};this.switchMap=function(b){a.eachLayer(function(h){if(h&&h.options.layerName){var f=h.options.layerName.split("|");"BaseMap"==f[0]&&f[1]!=b&&a.removeLayer(h)}});for(var e=0;e<RMap.baseLayerList.length;e++){var l=RMap.baseLayerList[e],n=l.options.layerName.split("|");"BaseMap"==n[0]&&n[1]==b&&a.addLayer(l)}}};RMap.Graphic.AddCirclePoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var f=l.getLayers(),d=0;d<f.length;d++)a[b]==f[d].options.attribute.id&&l.removeLayer(f[d])}else l.clearLayers()}var e=b.map,m=b.appEvent,g=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(e);m.on(m.clearMap,function(b){a()})};this.addCirclePoint=function(a,b,f){f=RMap.extend({lng:Number(a),lat:Number(b),id:null,radius:3,color:"#3388ff",opacity:1,data:null,onClick:null,proj:null,properties:{lng:a,lat:b,option:f}},f);var d=g.reSetCoordinate(a,b,f.proj);if(null==d)console.error("addCirclePoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=d.lng,b=d.lat,a=L.divIcon({className:"my-lf-label-circle",iconSize:[2*f.radius,2*f.radius],html:'\x3cdiv style\x3d"width: '+2*f.radius+"px; height: "+2*f.radius+"px; border-radius: "+f.radius+"px; background-color: "+f.color+"; opacity: "+f.opacity+';"\x3e\x3c/div\x3e'}),d=L.marker([d.lat,d.lng],{icon:a,attribute:f}),l.addLayer(d),f.onClick)d.on("click",function(a){f.onClick(f)})};this.callbackFun_onClick=function(){};this.removeCirclePoint=function(b){a(b)}};RMap.Graphic.AddLightPoint=function(b){function a(a,d,c){c=RMap.extend({lng:a,lat:d,proj:null},c);if(null!=c.pic){var k=new Image;k.src=c.pic;k.onload=function(){c.imgWidth=k.width;c.imgHeight=k.height;e(c)}}else e(c)}function e(a){var d=n.reSetCoordinate(a.lng,a.lat,a.proj);if(null==d)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var c=L.icon.pulse({iconSize:[12,12],color:"red"}),d=L.marker([d.lat,d.lng],{icon:c}).addTo(g);a.pic&&(a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]),a=L.icon({iconUrl:a.pic,iconAnchor:a.anchor}),d.setIcon(a));h.addLayer(d);$(".leaflet-pulsing-icon").css("pointer-events","none")}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var d=0;d<a.length;d++)for(var c=h.getLayers(),k=0;k<c.length;k++)a[d]==c[k].options.attribute.id&&h.removeLayer(c[k])}else h.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){m()});l.on(l.clearHightLight,function(a){m()})};this.addLightPoint=function(b,d,c){l.dispatch(l.clearHightLight);m();a(b,d,c)};this.removeLightPoint=function(a){m(a);l.dispatch(l.clearHightLight)}};RMap.Graphic.AddLine=function(b){function a(a,d){d=RMap.extend({points:a,id:null,width:2,color:"#3388ff",opacity:1,style:"",isCenter:!1,isShowArrow:!1,data:null,onClick:null,proj:null,properties:{pointList:a,option:d}},d);for(var k=[],b=[],f=0;f<a.length;f++){var n=p.reSetCoordinate(a[f][0],a[f][1],d.proj);k[f]=[n.lat,n.lng];b[f]=[n.lng,n.lat]}n=L.polyline(k,{color:d.color,opacity:d.opacity,weight:d.width,attribute:d});u.addLayer(n);b=l(b);for(f=0;f<b.length;f++)if(b[f][2]&&0<b[f][2]){if((b[f-1][0]!=b[f][0]||b[f-1][1]!=b[f][1])&&b[f][4]==b[f][5]){var m=h(b[f-1],b[f],b[f][2],b[f][3]);e(m,d,b[f])}}else d.isShowArrow&&k[f-1]&&k[f]&&g([k[f-1],k[f]],u,d);if(d.onClick)n.on("click",function(a){a=a.latlng;a=p.reSetCoordinate_out(a.lng,a.lat);d.onClick({id:d.id,pointList:d.points,data:d.data,clickPosition:[a.lng,a.lat]})});1==d.isCenter&&c.fitBounds(n.getBounds())}function e(a,c,d){for(var k=[],f=0;f<a.length;f++)k[f]=[a[f][1],a[f][0]];k=L.polyline(k,{color:c.color,opacity:c.opacity,weight:c.width,attribute:c});u.addLayer(k);c.isShowArrow&&d[4]==d[5]&&(f=a[Math.floor(a.length/2)],a=a[Math.floor(a.length/2)+1],f=[f[1],f[0]],a=[a[1],a[0]],g([f,a],u,c,d[5].toString()));if(c.onClick)k.on("click",function(a){c.onClick(c)})}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var d=u.getLayers(),f=0;f<d.length;f++)a[c]==d[f].options.attribute.id&&u.removeLayer(d[f])}else u.clearLayers()}function g(a,c,d,f){for(var k=0;k<a.length-1;k++){var b=a[k],h=a[k+1],p=h[0]-b[0],e=h[1]-b[1],g=[(b[0]+h[0])/2,(b[1]+h[1])/2],b=180*Math.atan2(h[0]-b[0],h[1]-b[1])/Math.PI;-180<b&&0>b&&(b=360+b);h=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");b=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+h+'" style\x3d"transform:rotate(-'+b+'deg)"/\x3e'});b=L.marker(g,{icon:b,attribute:d});0==p&&0==e||c.addLayer(b);f&&(p=L.divIcon({className:"my-lf-label",iconSize:[20,20],html:f}),g=L.marker(g,{icon:p,attribute:d}),u.addLayer(g),$(".my-lf-label").css("text-align","center"),$(".my-lf-label").css("font-weight","bold"),$(".my-lf-label").css("font-size",15),$(".my-lf-label").css("font-family","\u5fae\u8f6f\u96c5\u9ed1"),$(".my-lf-label").css("color","#000"),$(".my-lf-label").css("text-shadow","#FFF 2px 0 0,#FFF 0 2px 0,#FFF -2px 0 0,#FFF 0 -2px 0"))}}function l(a){for(var c=[],d=0;d<a.length-1;d++)c[0]=a[0],n(a[d],a[d+1])||c.push(a[d+1]);for(a=0;a<c.length;a++)for(var f=d=0,b=0;b<a;b++){var k;k=c[a];var h=c[a-1],p=c[b],e=c[b-1];k=n(k,h)&&n(p,e)?!1:n(k,p)&&n(h,e)?!0:n(k,e)&&n(p,h)?!0:!1;k&&(c[a][2]=c[a][2]&&0<c[a][2]?c[a][2]+1:1,void 0==c[a][3]&&(n(c[a],c[b])?(c[a][3]=1,d++,c[a][4]=d):(c[a][3]=-1,f++,c[a][4]=f)),1==c[b][3]&&c[a][3]==c[b][3]?(d++,c[a][4]=d,c[b][5]=d):-1==c[b][3]&&c[a][3]==c[b][3]&&(f++,c[a][4]=f,c[b][5]=f),c[a][5]=c[a][4])}return c}function n(a,c){return void 0==a||void 0==c?!1:a[0]==c[0]&&a[1]==c[1]?!0:!1}function h(a,c,b,k){var h;k=b;k=1;b=[(a[0]+c[0])/2,(a[1]+c[1])/2];h=f(a,c);k=-k*h/10;h=90*Math.PI/180;h=d(a,b)-h;h=[b[0]+k*Math.cos(h),b[1]+k*Math.sin(h)];b=[(a[0]+c[0])/2,(a[1]+c[1])/2];k=[(a[0]+h[0])/2,(a[1]+h[1])/2];var p=[b[0]-a[1]+c[1],b[1]+a[0]-c[0]],e=[k[0]-a[1]+h[1],k[1]+a[0]-h[0]];b[1]==p[1]?(e=(e[0]-k[0])/(e[1]-k[1]),p=e*(b[1]-k[1])+k[0],k=b[1]):k[1]==e[1]?(p=(p[0]-b[0])/(p[1]-b[1]),p=p*(k[1]-b[1])+b[0],k=k[1]):(p=(p[0]-b[0])/(p[1]-b[1]),e=(e[0]-k[0])/(e[1]-k[1]),k=(p*b[1]-b[0]-e*k[1]+k[0])/(p-e),p=p*k-p*b[1]+b[0]);b=[p,k];k=f(a,b);p=d(a,b);e=d(c,b);(h[1]-a[1])*(c[0]-a[0])>(c[1]-a[1])*(h[0]-a[0])?(a=e,h=p):(a=p,h=e);var g;c=[];p=h-a;p=0>p?p+2*Math.PI:p;for(e=0;100>=e;e++)g=a+p*e/100,h=b[0]+k*Math.cos(g),g=b[1]+k*Math.sin(g),c.push([h,g]);return c}function f(a,c){return Math.sqrt(Math.pow(a[0]-c[0],2)+Math.pow(a[1]-c[1],2))}function d(a,c){var d,b=Math.asin(Math.abs(c[1]-a[1])/f(a,c));c[1]>=a[1]&&c[0]>=a[0]?d=b+Math.PI:c[1]>=a[1]&&c[0]<a[0]?d=2*Math.PI-b:c[1]<a[1]&&c[0]<a[0]?d=b:c[1]<a[1]&&c[0]>=a[0]&&(d=Math.PI-b);return d}var c=b.map,k=b.appEvent,p=b.appCoord,u;this.init=function(){u=L.layerGroup().addTo(c);k.on(k.clearMap,function(a){m()})};this.addLine=function(c,d){a(c,d)};this.callbackFun_onClick=function(){};this.removeLine=function(a){m(a)}};RMap.Graphic.AddPoint=function(b){function a(a,d,c){c=RMap.extend({lng:a,lat:d,id:null,isCenter:!1,tooltip:null,tooltipDirection:"auto",data:null,onClick:null,onMouseOver:null,onMouseOut:null,onTooltipOpen:null,proj:null,properties:{lng:a,lat:d,option:c}},c);if(null!=c.pic){var b=new Image;b.src=c.pic;b.onload=function(){c.imgWidth=b.width;c.imgHeight=b.height;e(c)}}else e(c)}function e(a){var d=n.reSetCoordinate(a.lng,a.lat,a.proj);if(null==d)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{d=L.marker([d.lat,d.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var c=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});d.setIcon(c)}h.addLayer(d);if(a.onClick)d.on("click",function(c){a.onClick(a)});if(a.onMouseOver)d.on("mouseover",function(c){a.onMouseOver(a)});if(a.onMouseOut)d.on("mouseout",function(c){a.onMouseOut(a)});if(a.onTooltipOpen)d.on("tooltipopen",function(c){a.onTooltipOpen(a)});a.tooltip&&d.bindTooltip(a.tooltip,{direction:a.tooltipDirection})}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var d=0;d<a.length;d++)for(var c=h.getLayers(),b=0;b<c.length;b++)a[d]==c[b].options.attribute.id&&h.removeLayer(c[b])}else h.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){m()})};this.addPoint=function(b,d,c){a(b,d,c)};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.callbackFun_onMouseOut=function(){};this.callbackFun_onTooltipOpen=function(){};this.removePoint=function(a){m(a)}};RMap.Graphic.AddPointList=function(b){function a(a){a=RMap.extend(null,a);if(null!=a.pic){var d=new Image;d.src=a.pic;d.onload=function(){a.imgWidth=d.width;a.imgHeight=d.height;e(a)}}else e(a)}function e(a){var d=n.reSetCoordinate(a.lng,a.lat,a.proj);if(null==d)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{d=L.marker([d.lat,d.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var c=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});d.setIcon(c)}h.addLayer(d);var b={id:a.id,lng:a.lng,lat:a.lat,data:a.data};if(a.onClick)d.on("click",function(c){a.onClick(b)});if(a.onMouseOver)d.on("mouseover",function(c){a.onMouseOver(b)})}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var d=0;d<a.length;d++)for(var c=h.getLayers(),b=0;b<c.length;b++)a[d]==c[b].options.attribute.id&&h.removeLayer(c[b])}else h.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){m()})};this.addPointList=function(b,d){d=RMap.extend({id:null,attrPic:null,lngField:"lng",latField:"lat",isCenter:!1,data:null,onClick:null,onMouseOver:null,proj:null},d);for(var c=eval("("+b+")"),k=[],h=0;h<c.length;h++){var e=c[h];d.lng=e[d.lngField];d.lat=e[d.latField];d.data=e;if(null!=d.attrPic)for(var l=0;l<d.attrPic.length;l++){var m=d.attrPic[l];e[m.field]==m.value&&(d.pic=m.pic)}a(d);d.isCenter&&(e=n.reSetCoordinate(d.lng,d.lat,d.proj),k.push([e.lat,e.lng]))}d.isCenter&&(c=L.polygon(k),g.fitBounds(c.getBounds()))};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.removePointList=function(a){m(a)}};RMap.Graphic.AddPolygon=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var f=l.getLayers(),d=0;d<f.length;d++)a[b]==f[d].options.attribute.id&&l.removeLayer(f[d])}else l.clearLayers()}var e=b.map,m=b.appEvent,g=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(e);m.on(m.clearMap,function(b){a()})};this.addPolygon=function(a,b){b=RMap.extend({pointList:a,id:null,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5,outLineStyle:"",color:"#3388ff",opacity:.3,data:null,isCenter:!1,onClick:null,proj:null,properties:{pointList:a,option:b}},b);var f=[];if("[object Array]"==Object.prototype.toString.call(a[0][0][0]))for(var d=0;d<a.length;d++){f[d]=[];for(var c=0;c<a[d].length;c++){f[d][c]=[];for(var k=0;k<a[d][c].length;k++){var p=g.reSetCoordinate(a[d][c][k][0],a[d][c][k][1],b.proj),p=[p.lat,p.lng];f[d][c][k]=p}}}else for(d=0;d<a.length;d++)p=g.reSetCoordinate(a[d][0],a[d][1],b.proj),p=[p.lat,p.lng],f[d]=p;f=L.polygon(f,{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity,attribute:b});l.addLayer(f);if(b.onClick)f.on("click",function(a){a=a.latlng;a=g.reSetCoordinate_out(a.lng,a.lat);b.onClick({id:b.id,pointList:b.pointList,data:b.data,clickPosition:[a.lng,a.lat]})});1==b.isCenter&&e.fitBounds(f.getBounds())};this.callbackFun_onClick=function(){};this.removePolygon=function(b){a(b)}};RMap.Graphic.AddTextPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=l.getLayers(),c=0;c<d.length;c++)a[b]==d[c].options.attribute.id&&l.removeLayer(d[c])}else l.clearLayers()}var e=b.map,m=b.appEvent,g=b.appCoord,l,n=0;this.init=function(){l=L.layerGroup().addTo(e);m.on(m.clearMap,function(b){a()})};this.addTextPoint=function(a,b,d,c){var k={lng:Number(a),lat:Number(b),txt:d,id:null,color:0,offsetX:0,offsetY:0,font_weight:"bold",font_size:"16px",font_family:"\u5fae\u8f6f\u96c5\u9ed1",data:null,onClick:null,proj:null,properties:{lng:a,lat:b,option:c}};d="my-lf-label";c&&(c.color||c.offsetX||c.offsetY||c.font_weight||c.font_size||c.font_family)&&(n++,d+=n);c=RMap.extend(k,c);k=g.reSetCoordinate(a,b,c.proj);if(null==k)console.error("addTextPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=k.lng,b=k.lat,a=L.divIcon({className:d,iconSize:[100,24],html:c.txt}),a=L.marker([k.lat,k.lng],{icon:a,attribute:c}),l.addLayer(a),$("."+d).css("text-align","center"),$("."+d).css("font-weight",c.font_weight),$("."+d).css("font-size",c.font_size),$("."+d).css("font-family",c.font_family),$("."+d).css("color",c.color),$("."+d).css("top",c.offsetX),$("."+d).css("left",c.offsetY),c.onClick)a.on("click",function(a){c.onClick({lng:c.lng,lat:c.lat,txt:c.txt,data:c.data,id:c.id})})};this.callbackFun_onClick=function(){};this.removeTextPoint=function(b){a(b)}};RMap.Graphic.AddComplexPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=l.getLayers(),c=0;c<d.length;c++)a[b]==d[c].options.attribute.id&&l.removeLayer(d[c])}else l.clearLayers()}var e=b.map,m=b.appEvent,g=b.appCoord,l,n=0;this.init=function(){l=L.layerGroup().addTo(e);m.on(m.clearMap,function(b){a()})};this.addComplexPoint=function(a,b,d,c){c=RMap.extend({lng:Number(a),lat:Number(b),id:null,width:0,height:0,offsetX:0,offsetY:0,data:null,onClick:null,proj:null,properties:{lng:a,lat:b,option:c}},c);var k=g.reSetCoordinate(a,b,c.proj);if(null==k)console.error("addComplexPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=k.lng,b=k.lat,n++,a="my-lf-label-complex"+n,d=L.divIcon({className:a,iconSize:[c.width,c.height],html:d}),k=L.marker([k.lat,k.lng],{icon:d,attribute:c}),l.addLayer(k),$("."+a).css("left",c.offsetX),$("."+a).css("top",c.offsetY),c.onClick)k.on("click",function(a){c.onClick({lng:c.lng,lat:c.lat,data:c.data,id:c.id})})};this.callbackFun_onClick=function(){};this.removeComplexPoint=function(b){a(b)}};RMap.Draw.DrawPoint=function(b){function a(b){f++;b.layer.drawId=void 0!=h.id||null!=h.id?h.id:"DrawPoint"+f;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;c.addLayer(b.layer);b=b.layer;if(h.callback){var d=n.reSetCoordinate_out(b._latlng.lng,b._latlng.lat);b={id:b.drawId,lng:d.lng.toFixed(6),lat:d.lat.toFixed(6)};h.callback(b)}g.off(L.Draw.Event.CREATED,a)}function e(c,b,e){h=b=RMap.extend(e,b);g.off(L.Draw.Event.CREATED,a);g.on(L.Draw.Event.CREATED,a);d.addHooks();b.pic&&(b.anchor||(b.anchor=[b.imgWidth/2,b.imgHeight/2]),c=L.icon({iconUrl:b.pic,iconAnchor:b.anchor}),d.options.shapeOptions=RMap.extend(d.options.icon,c));L.Handler.prototype.enable.call(d);d.fire("enabled",{handler:d.type});d._map.fire(L.Draw.Event.DRAWSTART,{layerType:d.type})}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=c.getLayers(),e=0;e<d.length;e++)a[b]==d[e].drawId&&c.removeLayer(d[e])}else c.clearLayers()}var g=b.map,l=b.appEvent,n=b.appCoord,h,f=0,d=new L.Draw.Marker(g),c;this.init=function(){c=(new L.FeatureGroup).addTo(g);l.on(l.clearMap,function(a){m()});l.on(l.clearDrawMeasure,function(a){m()})};this.drawPoint=function(a,c){var b={id:null,callback:a};L.drawLocal.draw.handlers.marker.tooltip.start="\u5728\u5730\u56fe\u4e0a\u6807\u8bb0\u70b9\u4f4d\uff08\u6309Esc\u53d6\u6d88\uff09";if(c&&null!=c.pic){var d=new Image;d.src=c.pic;d.onload=function(){c.imgWidth=d.width;c.imgHeight=d.height;e(a,c,b)}}else e(a,c,b)};this.callbackFun_callback=function(){};this.removeDrawPoint=function(a){m(a)}};RMap.Draw.DrawCircle=function(b){function a(b){d++;b.layer.drawId=void 0!=f.id||null!=f.id?f.id:"DrawCircle"+d;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;p.addLayer(b.layer);b=b.layer;if(f.callback){var k=n.reSetCoordinate_out(b.getBounds()._southWest.lng,b.getBounds()._southWest.lat),l=n.reSetCoordinate_out(b.getBounds()._northEast.lng,b.getBounds()._northEast.lat),l=[k.lng,k.lat,l.lng,l.lat],m=n.reSetCoordinate_out(b._latlng.lng,b._latlng.lat),k=g.getZoom();g.setZoom(RMap.config.maxZoom);var v=L.Circle.toPolygon(b,64,g),x=[],y=[m.lat,m.lng],r=b.getRadius()/L.CRS.Earth.R/(Math.PI/180),w=g.project([y[0]+r,y[1]]),H=g.project([y[0]-r,y[1]]),w=w.add(H).divideBy(2),w=g.unproject(w),w=[w.lat,w.lng],y=L.latLng([y[0]+r,y[1]]),r=L.latLng(w);y.distanceTo(r);y=w[0]-m.lat;for(r=0;r<v.length;r++)w=n.reSetCoordinate_out(v[r].lng,v[r].lat+y),x[r]=[w.lng,w.lat];u.id=b.drawId;c.push(b.drawId);p.clearLayers();h.addPolygon(x,u);b={id:b.drawId,center:[m.lng,m.lat],radius:b.getRadius(),minPoint:[l[0],l[1]],maxPoint:[l[2],l[3]],extent:l,pointList:x};f.callback(b);e(k,RMap.config.maxZoom)}g.off(L.Draw.Event.CREATED,a)}function e(a,b){setTimeout(function(){g.getZoom()==b?g.setZoom(a):e(a,b)},10)}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=p.getLayers(),k=0;k<d.length;k++)a[b]==d[k].drawId&&p.removeLayer(d[k])}else for(p.clearLayers(),b=0;b<c.length;b++)h.removePolygon(c[b])}var g=b.map,l=b.appEvent,n=b.appCoord,h=new RMap.Graphic.AddPolygon(b),f,d=0,c=[],k=new L.Draw.Circle(g),p,u;this.init=function(){h.init();p=(new L.FeatureGroup).addTo(g);l.on(l.clearMap,function(a){m()});l.on(l.clearDrawMeasure,function(a){m()})};this.drawCircle=function(b,c){var d;d=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},c);u={outLineWidth:d.outLineWidth,outLineColor:d.outLineColor,outLineOpacity:d.outLineOpacity,outLineStyle:d.outLineStyle,opacity:d.opacity,color:d.color};f=d;g.off(L.Draw.Event.CREATED,a);g.on(L.Draw.Event.CREATED,a);k.addHooks();k.options.shapeOptions=RMap.extend(k.options.shapeOptions,{stroke:!0,color:d.outLineColor,weight:d.outLineWidth,opacity:d.outLineOpacity,fillColor:d.color,fillOpacity:d.opacity,showMeasurements:d.showMeasurements});L.Handler.prototype.enable.call(k);k.fire("enabled",{handler:k.type});k._map.fire(L.Draw.Event.DRAWSTART,{layerType:k.type})};this.callbackFun_callback=function(){};this.removeDrawCircle=function(a){m(a)}};RMap.Draw.DrawLine=function(b){function a(b){h++;b.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawLine"+h;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;d.addLayer(b.layer);b=b.layer;if(n.callback){for(var k=l.reSetCoordinate_out(b._bounds._southWest.lng,b._bounds._southWest.lat),e=l.reSetCoordinate_out(b._bounds._northEast.lng,b._bounds._northEast.lat),k=[k.lng,k.lat,e.lng,e.lat],e=b._latlngs,f=[],g=0;g<e.length;g++){var C=l.reSetCoordinate_out(e[g].lng,e[g].lat);f[g]=[C.lng,C.lat]}n.callback({id:b.drawId,minPoint:[k[0],k[1]],maxPoint:[k[2],k[3]],pointList:f,extent:k})}m.off(L.Draw.Event.CREATED,a)}function e(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=d.getLayers(),f=0;f<e.length;f++)a[b]==e[f].drawId&&d.removeLayer(e[f])}else d.clearLayers()}var m=b.map,g=b.appEvent,l=b.appCoord,n,h=0,f=new L.Draw.Polyline(m),d;this.init=function(){d=(new L.FeatureGroup).addTo(m);g.on(g.clearMap,function(a){e()});g.on(g.clearDrawMeasure,function(a){e()})};this.drawLine=function(b,d){var e;n=e=RMap.extend({id:null,callback:b,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!1},d);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);f.addHooks();f.options.shapeOptions=RMap.extend(f.options.shapeOptions,{stroke:!0,color:e.color,weight:e.width,opacity:e.opacity,showMeasurements:e.showMeasurements});L.Handler.prototype.enable.call(f);f.fire("enabled",{handler:f.type});f._map.fire(L.Draw.Event.DRAWSTART,{layerType:f.type})};this.callbackFun_callback=function(){};this.removeDrawLine=function(a){e(a)}};RMap.Draw.DrawPolygon=function(b){function a(b){h++;b.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawPolygon"+h;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;d.addLayer(b.layer);b=b.layer;if(n.callback){for(var k=l.reSetCoordinate_out(b._bounds._southWest.lng,b._bounds._southWest.lat),e=l.reSetCoordinate_out(b._bounds._northEast.lng,b._bounds._northEast.lat),k=[k.lng,k.lat,e.lng,e.lat],e=b._latlngs[0],f=[],g=0;g<e.length;g++){var C=l.reSetCoordinate_out(e[g].lng,e[g].lat);f[g]=[C.lng,C.lat]}n.callback({id:b.drawId,minPoint:[k[0],k[1]],maxPoint:[k[2],k[3]],pointList:f,extent:k})}m.off(L.Draw.Event.CREATED,a)}function e(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=d.getLayers(),f=0;f<e.length;f++)a[b]==e[f].drawId&&d.removeLayer(e[f])}else d.clearLayers()}var m=b.map,g=b.appEvent,l=b.appCoord,n,h=0,f=new L.Draw.Polygon(m),d;this.init=function(){d=(new L.FeatureGroup).addTo(m);g.on(g.clearMap,function(a){e()});g.on(g.clearDrawMeasure,function(a){e()})};this.drawPolygon=function(b,d){var e;n=e=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},d);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);f.addHooks();f.options.shapeOptions=RMap.extend(f.options.shapeOptions,{stroke:!0,color:e.outLineColor,weight:e.outLineWidth,opacity:e.outLineOpacity,fillColor:e.color,fillOpacity:e.opacity,showMeasurements:e.showMeasurements});L.Handler.prototype.enable.call(f);f.fire("enabled",{handler:f.type});f._map.fire(L.Draw.Event.DRAWSTART,{layerType:f.type})};this.callbackFun_callback=function(){};this.removeDrawPolygon=function(a){e(a)}};RMap.Draw.DrawRect=function(b){function a(b){h++;b.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawRect"+h;b.layer.options.attribute=b.layer.options;b.layer.options.attribute.id=b.layer.drawId;d.addLayer(b.layer);b=b.layer;if(n.callback){for(var k=l.reSetCoordinate_out(b._bounds._southWest.lng,b._bounds._southWest.lat),e=l.reSetCoordinate_out(b._bounds._northEast.lng,b._bounds._northEast.lat),k=[k.lng,k.lat,e.lng,e.lat],e=b._latlngs[0],f=[],g=0;g<e.length;g++){var C=l.reSetCoordinate_out(e[g].lng,e[g].lat);f[g]=[C.lng,C.lat]}n.callback({id:b.drawId,minPoint:[k[0],k[1]],maxPoint:[k[2],k[3]],pointList:f,extent:k})}m.off(L.Draw.Event.CREATED,a)}function e(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=d.getLayers(),f=0;f<e.length;f++)a[b]==e[f].drawId&&d.removeLayer(e[f])}else d.clearLayers()}var m=b.map,g=b.appEvent,l=b.appCoord,n,h=0,f=new L.Draw.Rectangle(m),d;this.init=function(){d=(new L.FeatureGroup).addTo(m);g.on(g.clearMap,function(a){e()});g.on(g.clearDrawMeasure,function(a){e()})};this.drawRect=function(b,d){var e;n=e=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},d);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);f.addHooks();f.options.shapeOptions=RMap.extend(f.options.shapeOptions,{stroke:!0,color:e.outLineColor,weight:e.outLineWidth,opacity:e.outLineOpacity,fillColor:e.color,fillOpacity:e.opacity,showMeasurements:e.showMeasurements});L.Handler.prototype.enable.call(f);f.fire("enabled",{handler:f.type});f._map.fire(L.Draw.Event.DRAWSTART,{layerType:f.type})};this.callbackFun_callback=function(){};this.removeDrawRect=function(a){e(a)}};RMap.Measure.Measure=function(b){var a=b.appEvent,e=new RMap.Draw.DrawLine(b),m=new RMap.Draw.DrawRect(b),g=new RMap.Draw.DrawCircle(b),l=new RMap.Draw.DrawPolygon(b);this.init=function(){e.init();m.init();g.init();l.init()};this.measureLength=function(a){a=RMap.extend({id:null,callback:null,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!0},a);e.drawLine(null,a)};this.measureRect=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);m.drawRect(null,a)};this.measureCircle=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);g.drawCircle(null,a)};this.measureArea=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);l.drawPolygon(null,a)};this.removeMeasure=function(){a.dispatch(a.clearDrawMeasure)}};RMap.InfoWindow.AlwaysShowWindow=function(b){var a=b.map,e=b.appEvent,m=b.appCoord,g;new RMap.Graphic.AddLightPoint(b);this.init=function(){g=L.layerGroup().addTo(a);e.on(e.clearMap,function(a){g.clearLayers()})};this.addAlwaysShowWindow=function(a,b,e,f){f=RMap.extend({proj:null},f);a=m.reSetCoordinate(a,b,f.proj);null==a?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=L.popup(),b.setLatLng([Number(a.lat),Number(a.lng)]),b.setContent(e),g.addLayer(b))};this.removeAlwaysShowWindow=function(){g.clearLayers()}};RMap.InfoWindow.PopWindow=function(b){function a(a){h&&n.removeLightPoint()}var e=b.map,m=b.appEvent,g=b.appCoord,l=L.popup(),n=new RMap.Graphic.AddLightPoint(b),h=!1;this.init=function(){n.init();m.on(m.clearMap,function(a){e.removeLayer(l)})};this.showPopWindow=function(b,d,c,k){k=RMap.extend({isShowCloseButton:!0,isCenter:!1,isHighLight:!1,autoPan:!0,proj:null},k);var p=g.reSetCoordinate(b,d,k.proj);null==p?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(k.isCenter&&e.setView([Number(p.lat),Number(p.lng)]),l=L.popup({closeButton:k.isShowCloseButton,autoPan:k.autoPan,maxWidth:2E3}),l.on("remove",a),l.setLatLng([Number(p.lat),Number(p.lng)]),l.setContent(c),l.openOn(e),(h=k.isHighLight)&&n.addLightPoint(b,d,k))};this.hidePopWindow=function(){e.removeLayer(l)}};RMap.Tools.Buffer=function(b){var a,e,m;function g(b,d,h,g){g=RMap.extend({outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.3,isCenter:!1,proj:null},g);b=Number(b);d=Number(d);h=Number(h);a=b;e=d;m=g;var t=c.reSetCoordinate(b,d,g.proj);if(null==t)console.error("bufferPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var x=L.circle([t.lat,t.lng],{radius:h});x.setStyle({stroke:!0,color:g.outLineColor,weight:g.outLineWidth,opacity:g.outLineOpacity,fillColor:g.color,fillOpacity:g.opacity});p.clearLayers();k.removePolygon("Buffer"+u);p.addLayer(x);var F=f.getZoom();if(f.dragging.enabled()){f.setZoom(RMap.config.maxZoom);var A=x.getBounds(),M=c.reSetCoordinate_out(A.getWest(),A.getSouth()),B=c.reSetCoordinate_out(A.getEast(),A.getNorth()),M=[M.lng,M.lat,B.lng,B.lat],B=L.Circle.toPolygon(x,64,f),x=[],z=[t.lat,t.lng],D=h/L.CRS.Earth.R/(Math.PI/180),I=f.project([z[0]+D,z[1]]),O=f.project([z[0]-D,z[1]]),I=I.add(O).divideBy(2),I=f.unproject(I),I=[I.lat,I.lng],z=L.latLng([z[0]+D,z[1]]),D=L.latLng(I);z.distanceTo(D);z=I[0]-t.lat;for(D=0;D<B.length;D++)t=c.reSetCoordinate_out(B[D].lng,B[D].lat+z),x[D]=[t.lng,t.lat];p.clearLayers();u++;g.id="Buffer"+u;k.addPolygon(x,g);t=[A.getEast(),(A.getSouth()+A.getNorth())/2];B=h;z="";z=1E4<=B?(B/1E3).toFixed(1)+"km":B.toFixed(0)+"m";B=L.marker([t[1],t[0]],{icon:L.icon({iconUrl:RMap.scriptLocation+"image/tuodong.png",iconAnchor:[17.8,10]})});p.addLayer(B);z=L.divIcon({className:"my-lf-label",iconSize:[50,20],html:z});t=L.marker([t[1],t[0]],{icon:z});p.addLayer(t);$(".my-lf-label").css("text-align","center");$(".my-lf-label").css("top",2);$(".my-lf-label").css("left",42);B.on("mousedown",v);B.on("mouseup",G);f.on("mouseup",G);b={id:g.id,pointList:x,extent:M,lat:d,lng:b,radius:h};C=g.callback;N=b;g.callback&&!E&&g.callback(b);1==g.isCenter?n(A,RMap.config.maxZoom):l(F,RMap.config.maxZoom)}}}function l(a,b){setTimeout(function(){f.getZoom()==b?f.setZoom(a):l(a,b)},10)}function n(a,b){setTimeout(function(){f.getZoom()==b?f.fitBounds(a):n(a,b)},10)}function h(){p.clearLayers();for(var a=0;a<=u;a++)k.removePolygon("Buffer"+u)}var f=b.map,d=b.appEvent,c=b.appCoord,k=new RMap.Graphic.AddPolygon(b),p,u=0;this.init=function(){k.init();p=L.layerGroup().addTo(f);d.on(d.clearMap,function(a){h()})};this.bufferPoint=function(a,b,d,c){E=!1;g(a,b,d,c)};this.callbackFun_onResult=function(){};this.removeBuffer=function(){h()};var E=!1;m=e=a=void 0;var C,N,G=function(a){f.dragging.enabled()||(f.dragging.enable(),x(a),C(N),console.log("end"));f.off("mousemove",x)},v=function(a){f.dragging.enabled()&&f.dragging.disable();E=!0;console.log("start");f.off("mousemove",x);f.on("mousemove",x)},x=function(b){var d=c.reSetCoordinate_out(b.latlng.lng,b.latlng.lat);b=[a,e];d=[d.lng,d.lat];b=c.reSetCoordinate(b[0],b[1]);d=c.reSetCoordinate(d[0],d[1]);b=L.latLng(b);d=L.latLng(d);b=b.distanceTo(d);g(a,e,b,m)}};RMap.Tools.ClearMap=function(b){var a=b.appEvent;this.clearMap=function(){a.dispatch(a.clearMap)}};RMap.Tools.ConvertCoord=function(b){this.convertCoord=function(a,b,m,g){m==g?a={lng:a,lat:b}:(m=new proj4.Proj(m.proj4),g=new proj4.Proj(g.proj4),a=proj4(m,g,[a,b]),a={lng:a[0],lat:a[1]});return a}};RMap.Tools.ConvertEncryptCoord=function(b){var a=b.appCoord;this.convertEncryptCoord=function(b,m,g,l){return g==l?{lng:b,lat:m}:"bd09"==g&&"wgs84"==l?a.convert_bd09_To_gps84(Number(b),Number(m)):"wgs84"==g&&"bd09"==l?a.convert_gps84_To_bd09(Number(b),Number(m)):"wgs84"==g&&"gcj02"==l?a.convert_gps84_To_gcj02(Number(b),Number(m)):"gcj02"==g&&"wgs84"==l?a.convert_gcj02_To_gps84(Number(b),Number(m)):"gcj02"==g&&"bd09"==l?a.convert_gcj02_To_bd09(Number(b),Number(m)):"bd09"==g&&"gcj02"==l?a.convert_bd09_To_gcj02(Number(b),Number(m)):null}};RMap.Tools.GetMapInformation=function(b){function a(a){k++;a.layer.drawId=void 0!=c.id||null!=c.id?c.id:"DrawPoint"+k;f.addLayer(a.layer);0<=c.showTime&&setTimeout(function(){f.removeLayer(a.layer)},c.showTime);e(a.layer)}function e(a){if(c.callback){var b=n.reSetCoordinate_out(a._latlng.lng,a._latlng.lat);a={id:a.drawId,lng:b.lng.toFixed(6),lat:b.lat.toFixed(6)};c.callback(a);0==c.repeatMode&&(d=null)}}function m(){d&&d.removeHooks();d=null;f.clearLayers();h&&(h.parentNode.removeChild(h),h=void 0)}var g=b.map,l=b.appEvent,n=b.appCoord,h,f,d,c,k=0;this.init=function(){f=(new L.FeatureGroup).addTo(g);l.on(l.clearMap,function(a){m()})};this.getCoordinate=function(b,e){d||(c={showTime:3E3,repeatMode:!0},c=RMap.extend(c,e),c.callback=b,g.off(L.Draw.Event.CREATED,a),g.on(L.Draw.Event.CREATED,a),d=new L.Draw.Marker(g),d.options.repeatMode=c.repeatMode,L.Handler.prototype.enable.call(d),d.fire("enabled",{handler:d.type}),d._map.fire(L.Draw.Event.DRAWSTART,{layerType:d.type}))};this.callbackFun_onResult=function(){};this.stopGetCoordinate=function(){m()};this.getMapExtent=function(){var a=g.getBounds(),b=n.reSetCoordinate_out(a._southWest.lng,a._southWest.lat),a=n.reSetCoordinate_out(a._northEast.lng,a._northEast.lat);return[b.lng,b.lat,a.lng,a.lat]};this.getMapLevel=function(){return g.getZoom()}};RMap.Tools.ShowCoordinate=function(b){function a(){var a="\u7ea7\u6570\uff1a"+l+"\uff0c\u7ecf\u5ea6\uff1a"+n.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+n.lat.toFixed(6),b="\u7ecf\u5ea6\uff1a"+n.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+n.lat.toFixed(6);h.innerHTML=a;g&&(g.innerHTML=b,helpTooltip.setPosition([n.lng,n.lat]),$(g).removeClass("hidden"))}var e=b.map,m=b.appCoord,g,l,n,h,f=!1;this.init=function(){h=document.createElement("label");h.style.position="absolute";h.style.bottom="10px";h.style.left="10px";n=m.reSetCoordinate_out(e.getCenter().lng,e.getCenter().lat);l=e.getZoom();e.on("zoom",function(b){l=e.getZoom();a()});e.on("mousemove",function(b){n=m.reSetCoordinate_out(b.latlng.lng,b.latlng.lat);l&&a()})};this.showCoordinate=function(a){a&&(a.top&&(h.style.bottom=null,h.style.top=a.top+"px"),a.bottom&&(h.style.top=null,h.style.bottom=a.bottom+"px"),a.left&&(h.style.right=null,h.style.left=a.left+"px"),a.right&&(h.style.left=null,h.style.right=a.right+"px"));h.style["z-index"]=99999;e.getContainer().appendChild(h);f=!0};this.hideCoordinate=function(){f&&(e.getContainer().removeChild(h),f=!1)}};RMap.Tools.ShowZoomControl=function(b){var a;this.init=function(){a=$(".leaflet-control-zoom.leaflet-bar.leaflet-control")};this.showZoomControl=function(b){a.css("display","block");a.css("margin-left",0);a.css("margin-top",0);a.css("position","absolute");$(".leaflet-control-zoom.leaflet-bar.leaflet-control").remove();b&&(b.top&&(a.css("bottom",""),a.css("top",b.top)),b.bottom&&(a.css("top",""),a.css("bottom",b.bottom)),b.left&&(a.css("right",""),a.css("left",b.left)),b.right&&(a.css("left",""),a.css("right",b.right)));$(".leaflet-control-container").append(a)};this.hideZoomControl=function(){a.css("display","none")}};RMap.Tools.ShowScale=function(b){var a=b.map,e;this.init=function(){};this.showScale=function(b){b=RMap.extend({metric:!0,imperial:!1,maxWidth:100},b);L.control.scale({metric:b.metric,imperial:b.imperial,maxWidth:b.maxWidth}).addTo(a);e=$(".leaflet-control-scale.leaflet-control");e.css("margin-left",0);e.css("margin-top",0);e.css("position","absolute");b&&(b.top&&(e.css("bottom",""),e.css("top",b.top)),b.bottom&&(e.css("top",""),e.css("bottom",b.bottom)),b.left&&(e.css("right",""),e.css("left",b.left)),b.right&&(e.css("left",""),e.css("right",b.right)));$(".leaflet-control-container").append(e)};this.hideScale=function(){e.css("display","none")}};RMap.Tools.LocationToAddress=function(b){var a=b.appCoord;this.init=function(){};this.locationToAddress=function(b,m,g,l){b=a.convert_gps84_To_gcj02(Number(b),Number(m));console.log(b);$.ajax({url:ResourceListConfig.amapGeocodeUrl+"\x26location\x3d"+b.lng+","+b.lat+"\x26extensions\x3dall\x26batch\x3dfalse\x26roadlevel\x3d0",success:function(a){"DAILY_QUERY_OVER_LIMIT"==a.info?console.warn("\u8bbf\u95ee\u5df2\u8d85\u51fa\u65e5\u8bbf\u95ee\u91cf\uff01"):"ACCESS_TOO_FREQUENT"==a.info?console.warn("\u5355\u4f4d\u65f6\u95f4\u5185\u8bbf\u95ee\u8fc7\u4e8e\u9891\u7e41\uff01"):"OK"==a.info&&g({address:a.regeocode.formatted_address,province:a.regeocode.addressComponent.province,city:a.regeocode.addressComponent.city,district:a.regeocode.addressComponent.district,township:a.regeocode.addressComponent.township})},error:function(a){console.error(a)}})};this.callbackFun_onResult=function(){}};RMap.Control.PointCluster=function(b){function a(a,b){for(var k=0;k<a.length;k++){var f={};for(items in a[k])f[items]=a[k][items];a[k].attribute=f;null!=a[k].pic?e(a[k]):b.pic&&(f=RMap.extend(a[k],b),m(f))}if(b.onClick)h.on("click",function(a){b.onClick(a.layer.options.attribute)})}function e(a){var b=new Image;b.src=a.pic;b.onload=function(){a.imgWidth=b.width;a.imgHeight=b.height;m(a)}}function m(a){var b=n.reSetCoordinate(a.lng,a.lat);null==b?console.error("addPointCluster\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=L.marker([b.lat,b.lng],{attribute:a.attribute}),a.pic&&(a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]),a=L.icon({iconUrl:a.pic,iconAnchor:a.anchor}),b.setIcon(a)),h.addLayer(b))}var g=b.map,l=b.appEvent,n=b.appCoord,h,f;this.init=function(){f=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){f.clearLayers()})};this.addPointCluster=function(b,c){h=(new L.MarkerClusterGroup).addTo(g);f.addLayer(h);if(null!=c.pic){var k=new Image;k.src=c.pic;k.onload=function(){c.imgWidth=k.width;c.imgHeight=k.height;a(b,c)}}else a(b,c)};this.callbackFun_point=function(){};this.callbackFun_onClick=function(){};this.removePointCluster=function(a){f.clearLayers()}};RMap.Control.HeatMap=function(b){var a=b.map,e=b.appEvent,m=b.appCoord,g;this.init=function(){g=L.layerGroup().addTo(a);e.on(e.clearMap,function(a){g.clearLayers()})};this.addHeatMap=function(a,b){for(var e=[],f=0;f<a.length;f++){var d=m.reSetCoordinate(a[f].lng,a[f].lat);e.push([d.lat,d.lng,a[f].weight])}e=L.heatLayer(e,{radius:12,maxZoom:0});g.addLayer(e)};this.callbackFun_point=function(){};this.removeHeatMap=function(a){g.clearLayers()}};RMap.Control.TrackPlay=function(b){function a(a,b){for(var d=[],c=0;c<a.length;c++)d[c]=[a[c][1],a[c][0]];c=L.polyline(d,{color:"#323232",opacity:.5,weight:b.width,data:b});b.isShowArrow&&m(d,E);if(b.onClick)c.on("click",function(a){b.onClick(b)});p.addLayer(c)}function e(){J&&(document.body.removeChild(F),J=!1);p.clearLayers();u.clearLayers();E.clearLayers();C.clearLayers();d.off("mousemove",P)}function m(a,b){for(var d=0;d<a.length-1;d++){var c=a[d],k=a[d+1],e=k[0]-c[0],f=k[1]-c[1],g=[(c[0]+k[0])/2,(c[1]+k[1])/2],c=180*Math.atan2(k[0]-c[0],k[1]-c[1])/Math.PI;-180<c&&0>c&&(c=360+c);k=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");c=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+k+'" style\x3d"transform:rotate(-'+c+'deg)"/\x3e'});g=L.marker(g,{icon:c});0==e&&0==f||b.addLayer(g)}}function g(a,b,c,d){O&&(window.clearTimeout(I),b.getLatLng(),b.setLatLng([d[1],d[0]]),O=!1);var k=[c[0]+(d[0]-c[0])*D/20,c[1]+(d[1]-c[1])*D/20];b.setLatLng([k[1],k[0]]);D++;20>=D&&(I=window.setTimeout(function(){g(a,b,c,d)},a/20))}function l(a,b){var c=180*Math.atan2(b[1]-a[1],b[0]-a[0])/Math.PI;-180<c&&0>c&&(c=360+c);$(".RotatedMarker").css("text-align","center");return L.divIcon({iconAnchor:t.trackPointAnchor,className:"RotatedMarker",html:'\x3cimg src\x3d"'+t.trackPointPic+'" style\x3d"transform:rotate(-'+c+'deg)"/\x3e'})}function n(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=[a[d][1],a[d][0]];c=L.polyline(c,{color:b.color,opacity:b.opacity,weight:b.width,attribute:b});if(b.onClick)c.on("click",function(a){b.onClick(b)});u.addLayer(c)}function h(a){var b;b="\x3ctr class\x3d'tracktr'\x3e"+("\x3ctd style\x3d'width:140px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/span\x3e\x3c/td\x3e");b+="\x3ctd style\x3d'width:150px;'\x3e\x3ca id\x3d'trackListShowMapPoint' data-lng\x3d'"+a.lng+"' data-lat\x3d'"+a.lat+"' style\x3d'cursor:pointer;' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/a\x3e\x3c/td\x3e";b+="\x3ctd style\x3d'width:150px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.time+"'\x3e"+a.data.time+"\x3c/span\x3e\x3c/td\x3e";b+="\x3c/tr\x3e";$("#trackBody").after(b)}function f(){if(q.playing){var a=parseInt($(".j_curNum").text());a>=q.dataTotal+1&&--a;var b=q.slideBarW/q.dataTotal*a;$(".j_curNum").text(a+1);$(".sCur").stop().animate({width:b},q.speed,"linear");$(".sPoint").stop().animate({left:b},q.speed,"linear",function(){b<q.slideBarW?f():q.pause()});q.callback&&q.callback(parseInt($(".j_curNum").text())-1)}}var d=b.map,c=b.appEvent,k=b.appCoord,p,u,E,C,N,G=[],v=[],x=[],y=800,r=0,w=0,H=!1,t,J=!1,F,A=[],M="#02EE82 #0C7FF8 #D12DF7 #FF0000 #F5DF26 #91F90A".split(" "),B=L.icon({iconUrl:RMap.scriptLocation+"image/trackStart.png",iconAnchor:[13.5,39]}),z=L.icon({iconUrl:RMap.scriptLocation+"image/trackEnd.png",iconAnchor:[13.5,39]});this.init=function(){p=L.layerGroup().addTo(d);u=L.layerGroup().addTo(d);E=L.layerGroup().addTo(d);C=L.layerGroup().addTo(d);N=L.layerGroup();c.on(c.clearMap,function(a){e()})};this.addTrackPlay=function(b,c){p.clearLayers();u.clearLayers();E.clearLayers();C.clearLayers();A=[];w=0;G=[];v=[];x=[];d.on("mousemove",P);for(var e=[b],f=0;f<e.length;f++){var g={id:null,width:2,color:0,style:"",isCenter:!1,isShowArrow:!1,isShowTime:!1,showTimeKey:"time",trackPointPic:RMap.scriptLocation+"image/trackPoint.png",trackPointAnchor:[15.5,9],speed:800,data:null,onClick:null};c.speed&&(y=c.speed,q.speed=c.speed);c=RMap.extend(g,c);c.color=M[f%6];t=c;var m=e[f],g=RMap.extend(g,m.styleOption),n;n=m;for(var r=c,r=RMap.extend({proj:null},r),Q=[],D=0;D<n.pointList.length;D++){var K=k.reSetCoordinate(n.pointList[D].lng,n.pointList[D].lat,r.proj),K=[K.lng,K.lat,n.pointList[D].data,n.trackId];Q.push(K);A.push(K);K=L.circleMarker([K[1],K[0]],{radius:3,color:"white",weight:2,opacity:1,attribute:K[2],trackId:K[3]});x.push(K);K.on("click",S);C.addLayer(K);N.addLayer(K)}n=Q;G.push({originalCoords:m.pointList,routeCoords:n,option:g});a(n,g);w<n.length&&(w=n.length);g=n;n=l(g[0],g[1]);n=L.marker([g[0][1],g[0][0]],{icon:n});v.push(n);C.addLayer(n);n=L.marker([g[0][1],g[0][0]],{icon:B});C.addLayer(n);g=L.marker([g[g.length-1][1],g[g.length-1][0]],{icon:z});C.addLayer(g);g="";m.pointList[0].data[t.showTimeKey]&&(g=m.pointList[0].data[t.showTimeKey]);m="";n='\x3cdiv class\x3d"conBtnWrap clearfix"\x3e';t.isShowTime&&(n='\x3cdiv class\x3d"conBtnWrap_showTime clearfix"\x3e',m='\x3cspan id\x3d"currentTime_track" class\x3d"right schedule_right"\x3e'+g+"\x3c/span\x3e");J&&F&&(document.body.removeChild(F),J=!1);F=document.createElement("div");F.id="conPanel";F.className="j_conPanel conPanelWrap";F.innerHTML='\x3cdiv class\x3d"slideBarWrap"\x3e\x3ca href\x3d"javascript:;" class\x3d"conPanelCloser"\x3e\x3c/a\x3e\x3cdiv class\x3d"j_sDefault sDefault"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_sCur sCur"\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" id\x3d"sPoint" class\x3d"sPoint"\x3e\x3c/a\x3e\x3c/div\x3e'+n+'\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPre left btnPre"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnRest left btnRest"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPause left btnPause stop"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnNext left btnNext"\x3e\x3c/a\x3e\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3cspan class\x3d"left schedule"\x3e\x3cem class\x3d"j_curNum"\x3e0\x3c/em\x3e/\x3cem class\x3d"j_dataTotal"\x3e100\x3c/em\x3e\x3c/span\x3e'+m+'\x3ca href\x3d"javascript:;" class\x3d"conPanelShowTrackList"\x3e\u663e\u793a\u5217\u8868\x3c/a\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f star--\x3e\x3cdiv id\x3d"trackList" class\x3d"relTableWrap relTableWrap_relation r-grid" style\x3d"height:215px;width:auto;margin-top:8px;display:none;"\x3e\t\x3cdiv class\x3d"r-grid-bd-box" id\x3d"trackResult_grid_bd_box" style\x3d"height:215px;padding-top:0px;margin-top:0px;"\x3e\t\t\x3ctable class\x3d"r-grid-center" style\x3d"width:auto;" id\x3d"trackListTable"\x3e\t\t\t\x3cthead\x3e\t\t\t\t\x3ctr\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 100px;"\x3e\u8bbe\u5907\u7f16\u53f7\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 150px;"\x3e\u5730\u5740\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 121px;"\x3e\u83b7\u53d6\u65f6\u95f4\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\x3c/tr\x3e\t\t\t\x3c/thead\x3e\t\t\t\x3ctbody id\x3d"trackBody"\x3e\t\t\t\x3c/tbody\x3e\t\t\x3c/table\x3e\t\x3c/div\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f end--\x3e';document.body.appendChild(F);t.top&&(F.style.top=t.top+"px");t.left&&(F.style.left=t.left+"px");q.init(w-1,d,T);J=!0;h(e[0].pointList[0])}if(1==c.isCenter){e=[];for(f=0;f<A.length;f++)e[f]=[A[f][1],A[f][0]];f=L.polyline(e);1==c.isCenter&&d.fitBounds(f.getBounds())}};this.callbackFun_trackObj=function(){};this.callbackFun_mouseMove=function(){};this.callbackFun_play=function(){};this.removeTrackPlay=function(){e()};var D,I,O=!1,T=function(a){r=a;if(r>=w)O=H=!0,window.clearTimeout(I);else if(0==r)for(O=H=!0,window.clearTimeout(I),u.clearLayers(),a=0;a<G.length;a++){var b=G[a].routeCoords,c=v[a],k=b[0];if(t.playCallback){var e={lng:k[0],lat:k[1],data:k[2],trackId:k[3]};h(e);t.playCallback(e)}k[2][t.showTimeKey]&&$("#currentTime_track").html(k[2][t.showTimeKey]);c.setLatLng([k[1],k[0]]);b=l(b[0],b[1]);c.setIcon(b)}else H=!1;if(!H)for(u.clearLayers(),a=0;a<G.length;a++)if(c=G[a].routeCoords,k=G[a].originalCoords,b=v[a],t.playCallback&&c&&(k={lng:k[r].lng,lat:k[r].lat,data:c[r][2],trackId:c[r][3]},h(k),t.playCallback(k)),c[r]&&3<c[r].length&&c[r][2][t.showTimeKey]&&$("#currentTime_track").html(c[r][2][t.showTimeKey]),r<c.length){var k=l(c[r-1],c[r]),e=c[r],f=d.getBounds();(e[0]<f.getWest()||e[0]>f.getEast()||e[1]<f.getSouth()||e[1]>f.getNorth())&&d.setView([e[1],e[0]]);D=0;O=!0;window.clearTimeout(I);g(q.speed,b,c[r-1],c[r]);b.setIcon(k);b=[];for(k=0;k<=r;k++)b.push(c[k]);n(b,G[a].option)}},R=function(a){var b=L.GeometryUtil.closestLayer(d,x,a.latlng,!1),c=b.latlng;if(null!=b){var e=a.layerPoint;a=d.latLngToLayerPoint(c);e=Math.sqrt((e.x-a.x)*(e.x-a.x)+(e.y-a.y)*(e.y-a.y));point=b;t.mouseMoveCallback&&(c=k.reSetCoordinate_out(c.lng,c.lat),t.mouseMoveCallback({lng:c.lng,lat:c.lat,data:b.layer.options.attribute,trackId:b.layer.options.trackId}))}50<e&&t.mouseMoveCallback&&t.mouseMoveCallback(null)},P=function(a){a.dragging||t.mouseMoveCallback&&R(a)},S=function(a){R(a)},q={dataTotal:100,slideBarW:482,step:1,speed:y,playing:!1,callback:null,init:function(a,c,d){function k(a){var b=$(".sPoint"),c=$(".slideBarWrap").offset().left;a=a.clientX-c;c=q.slideBarW;0>a&&(a=0);a>c&&(a=c);b.css({left:a+"px"});$(".sCur").width(a);b=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(b+1);q.callback&&q.callback(parseInt($(".j_curNum").text())-1);return!1}a&&(q.dataTotal=a);d&&(q.callback=d);$(".j_dataTotal").text(q.dataTotal+1);$(".j_curNum").text(1);$(".conPanelCloser").on("click",function(a){e()});$("#trackListShowMapPoint").die().live("click",function(){var a=$(this).attr("data-lng"),c=$(this).attr("data-lat"),d=new RMap.LightPoint(b);d.init();d.hideLightPoint();d.showLightPoint(a,c);setTimeout(function(){d.hideLightPoint()},6E4)});$(".conPanelShowTrackList").on("click",function(a){"\u663e\u793a\u5217\u8868"==$(this).html()?($(this).html("\u6536\u8d77\u5217\u8868"),$("#trackList").show()):"\u6536\u8d77\u5217\u8868"==$(this).html()&&($(this).html("\u663e\u793a\u5217\u8868"),$("#trackList").hide())});$(".btnPause").on("click",function(a){$(this).hasClass("stop")?(r>=w-1&&q.stop(),$(".j_sCur").width()<$(".j_sDefault").width()&&q.start()):q.pause();a.stopPropagation()});$(".j_btnRest").on("click",function(){q.stop()});$(".j_btnNext").on("click",function(){var a=q.step;16>a&&(q.step=2*a,q.speed/=2,q.playing&&q.start());$(this).next().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnNext").next().find(".mulText").fadeOut()},800)});$(".j_btnPre").on("click",function(){var a=q.step;1<a&&(q.step=a/2,q.speed*=2,q.playing&&q.start());$(this).prev().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnPre").prev().find(".mulText").fadeOut()},800)});$(".sPoint").on("mousedown",function(a){var b=$(".sPoint"),c=$(".slideBarWrap").offset().left,d;$(document).on("mousemove.slideBar",function(a){a=a.clientX-c;var k=q.slideBarW;0>a&&(a=0);a>k&&(a=k);b.css({left:a+"px"});$(".sCur").width(a);d=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(d+1);return!1});$(document).on("mouseup.slideBar",function(a){$(document).off("mousemove.slideBar");$(document).off("mouseup.slideBar");q.callback&&q.callback(parseInt($(".j_curNum").text())-1)});return!1});$(".j_sDefault").on("click",k);$(".j_sCur").on("click",k);$(".j_conPanel").on("mousedown",function(a){var b=$(".j_conPanel"),d=a.clientX-b.offset().left,k=a.clientY-b.offset().top;$(document).on("mousemove.conPanel",function(a){var e=a.clientX-d;a=a.clientY-k;var f=0,g=0,h=c.getContainer();if(h){f=h.offsetLeft;g=h.offsetTop+document.body.scrollTop;do h=h.offsetParent,f+=h.offsetLeft,g+=h.offsetTop;while("BODY"!=h.tagName)}var h=f+c.getSize()[0]-$(".j_conPanel").width(),l=g+c.getSize()[1]-$(".j_conPanel").height();e<f&&(e=f);a<g&&(a=g);e>h&&(e=h);a>l&&(a=l);b.css({left:e+"px",top:a+"px"});return!1});$(document).on("mouseup.conPanel",function(a){$(document).off("mousemove.conPanel");$(document).off("mouseup.conPanel")});return!1})},stop:function(){$(".btnPause").addClass("stop");q.playing=!1;$(".sCur").stop();$(".sPoint").stop();q.step=1;q.speed=y;$(".j_curNum").text(1);$(".sCur").width(0);$(".sPoint").css("left",0);q.callback&&q.callback(parseInt($(".j_curNum").text())-1)},pause:function(){$(".btnPause").addClass("stop");q.playing=!1;f()},start:function(){$(".btnPause").removeClass("stop");q.playing=!0;f()}}};RMap.Query.QueryLayer=function(b){function a(a,b){b=RMap.extend({queryWhere:"1\x3d1",geoQueryType:"intersects"},b);var d=L.esri.query({url:a.url});if(b.queryPointList){for(var g=b.queryPointList,h=[],l=0;l<g.length;l++){var m=f.reSetCoordinate(g[l][0],g[l][1],b.proj);h[l]=[m.lat,m.lng]}g=L.polygon(h);"intersects"==b.geoQueryType?d.intersects(g):"within"==b.geoQueryType&&d.within(g)}d.where(b.queryWhere);d.run(function(a,c){e(c,b)})}function e(a,b){var e=L.geoJSON(a,{pointToLayer:function(a,c){if(b.pic){var d=L.icon({iconUrl:b.pic,iconAnchor:b.anchor});return L.marker(c,{icon:d})}return L.marker(c)}});if(a.features&&!(0>=a.features.length)){var f=a.features[0].geometry.type;"Point"!=f&&(f=m(f,b),e.setStyle(f));d.addLayer(e);if(b.onClick)e.on("click",function(a){var c={properties:a.layer.feature.properties,clickPosition:{lng:a.latlng.lng,lat:a.latlng.lat}};"Point"==a.layer.feature.geometry.type&&(c.point={lng:a.layer.feature.geometry.coordinates[0],lat:a.layer.feature.geometry.coordinates[1]});b.onClick(c)});if(b.onResult)b.onResult(a.features)}}function m(a,b){if("MultiLineString"==a){var d={color:"#3388ff",width:2,opacity:.8};b=RMap.extend(d,b);return{color:b.color,opacity:b.opacity,weight:b.width}}return"Polygon"==a?(d={color:"#3388ff",width:2,opacity:.3,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5},b=RMap.extend(d,b),{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity}):null}function g(a,b){var d="",g="";if(b.queryPointList){for(var d=b.queryPointList,h=0;h<d.length;h++)var l=f.reSetCoordinate(d[h][0],d[h][1],b.proj),g=0==h?g+("(the_geom,POLYGON(("+l.lng+" "+l.lat):g+(","+l.lng+" "+l.lat);g+=")))";"intersects"==b.geoQueryType?g="INTERSECTS"+g:"within"==b.geoQueryType&&(g="WITHIN"+g)}b.queryWhere?(d=b.queryWhere,""!=g&&(d+=" AND "+g)):d=g;g=L.Util.extend({service:"WFS",version:"1.0.0",request:"GetFeature",typeName:a.typeName,outputFormat:"text/javascript",format_options:"callback:getJson",SrsName:a.srsName,cql_filter:d});g=a.url+L.Util.getParamString(g);$.ajax({url:g,dataType:"jsonp",jsonpCallback:"getJson",success:function(a){e(a,b)}})}function l(){d.clearLayers();h.dispatch(h.clearDrawMeasure)}var n=b.map,h=b.appEvent,f=b.appCoord,d;this.init=function(){d=L.layerGroup().addTo(n);h.on(h.clearMap,function(a){l()});h.on(h.clearQueryResult,function(a){l()})};this.queryLayer=function(b,d){for(var e=RMap.config.thematicLayer,f=0;f<e.length;f++){var h=e[f];b==h.layerName&&("ArcGISRest"==h.layerType?a(h,d):"WFS_GeoServer"==h.layerType&&g(h,d))}};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){};this.removeQueryResult=function(){l();h.dispatch(h.clearQueryResult)}};RMap.Query.QueryLayerByRect=function(b){var a=b.appEvent,e=new RMap.Draw.DrawRect(b),m=new RMap.Query.QueryLayer(b);this.init=function(){e.init();m.init();a.on(a.clearMap,function(a){e.removeDrawRect()});a.on(a.clearQueryResult,function(a){e.removeDrawRect()})};this.queryLayerByRect=function(a,b){b=RMap.extend({id:null,callback:null,styleIn:{outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5},showMeasurements:!1},b);e.drawRect(function(e){b.queryPointList=e.pointList;m.queryLayer(a,b)},b.styleIn)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};RMap.Query.QueryLayerByPointBuffer=function(b){var a=b.appEvent,e=new RMap.Tools.Buffer(b),m=new RMap.Query.QueryLayer(b);this.init=function(){e.init();m.init();a.on(a.clearMap,function(a){e.removeBuffer()});a.on(a.clearQueryResult,function(a){e.removeBuffer()})};this.queryLayerByPointBuffer=function(a,b,n,h,f){var d=f.styleIn;d||(d={});d.callback=function(a){f.queryPointList=a.pointList;m.queryLayer(h,f)};d.proj=f.proj;e.bufferPoint(a,b,n,d)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};RMap.Query.BufferSelect=function(b){var a=b.map,e=b.appEvent,m=new RMap.Tools.Buffer(b),g=new RMap.Query.PolygonSelect(b),l=[16,16];this.init=function(){m.init();g.init();l=L.point(l);L.layerGroup().addTo(a);e.on(e.clearMap,function(a){m.removeBuffer();g.removePolygonSelect()})};this.bufferSelect=function(a,b,e,d,c,k){var l=k.styleIn;l||(l={});l.isCenter=k.isCenter;l.callback=function(a){g.polygonSelect(a.id,d,c,k)};l.proj=k.proj;m.bufferPoint(a,b,e,l)};this.callbackFun_onResult=function(){};this.callbackFun_polygonStyle=function(){};this.removeBufferSelect=function(){m.removeBuffer();g.removePolygonSelect()}};RMap.Query.DrawSelect=function(b){function a(){g.removeDrawRect();l.removeDrawCircle();n.removeDrawPolygon();h.removePolygonSelect()}var e=b.map,m=b.appEvent,g=new RMap.Draw.DrawRect(b),l=new RMap.Draw.DrawCircle(b),n=new RMap.Draw.DrawPolygon(b),h=new RMap.Query.PolygonSelect(b),f=[16,16];this.init=function(){g.init();l.init();n.init();h.init();f=L.point(f);L.layerGroup().addTo(e);m.on(m.clearMap,function(b){a()})};this.drawSelect=function(a,b,e){e=RMap.extend({drawType:"rect",styleIn:{outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5},showMeasurements:!1},e);"rect"==e.drawType?g.drawRect(function(f){h.polygonSelect(f.id,a,b,e)},e.styleIn):"circle"==e.drawType?l.drawCircle(function(f){h.polygonSelect(f.id,a,b,e)},e.styleIn):"polygon"==e.drawType&&n.drawPolygon(function(f){h.polygonSelect(f.id,a,b,e)},e.styleIn)};this.callbackFun_onResult=function(){};this.callbackFun_polygonStyle=function(){};this.removeDrawSelect=function(){a()}};RMap.Query.PointSelect=function(b){function a(a,b){var k=e.project(a),m,u;n=[];l=[];m=L.latLngBounds(e.unproject([k.x+h.x/2,k.y-h.y/2]),e.unproject([k.x-h.x/2,k.y+h.y/2]));u=L.rectangle(m).toGeoJSON().geometry.coordinates[0];b.eachLayer(function(b){var c=b.feature.geometry.coordinates,e,f=!1;switch(b.feature.geometry.type){case "Point":c=[c];case "MultiPoint":for(e=0;e<c.length;e++)m.contains(L.latLng([c[e][1],c[e][0]]))&&(f=!0);break;case "LineString":c=[c];case "MultiLineString":for(e=0;e<c.length;e++){var k;if(k=m.intersects(b.getBounds()))a:{k=c[e];for(var h=0;h<=u.length-2;++h)for(var y=0;y<=k.length-2;++y){var r=u[h][1],w=u[h][0],H=u[h+1][1],t=u[h+1][0],J=k[y][1],F=k[y][0],A=k[y+1][1],M=k[y+1][0],B=(A-J)*(w-F)-(M-F)*(r-J),z=(H-r)*(w-F)-(t-w)*(r-J),r=(M-F)*(H-r)-(A-J)*(t-w);if(0!==r&&(B/=r,z/=r,0<=B&&1>=B&&0<=z&&1>=z)){k=!0;break a}}k=!1}k&&(f=!0)}break;case "Polygon":c=[c];case "MultiPolygon":for(e=0;e<c.length;e++){if(k=m.intersects(b.getBounds())){k=a.lng;h=a.lat;y=c[e];for(B=z=0;B<y.length;B++){r=y[B];w=!1;A=H=t=void 0;H=0;for(A=r.length-1;H<r.length;A=H++)t=r[H][0],J=r[H][1],F=r[A][0],A=r[A][1],(t=J>h!==A>h&&k<(F-t)*(h-J)/(A-J)+t)&&(w=!w);w&&z++}k=0==z%2?!1:1==z%2?!0:void 0}k&&(f=!0)}}f?g[L.stamp(b)]||(g[L.stamp(b)]=b,b.feature.properties&&n.push(b.feature.properties)):g[L.stamp(b)]&&(delete g[L.stamp(b)],b.feature.properties&&l.push(b.feature.properties))});n.length&&f&&f(n)}var e=b.map,m=b.appCoord,g=[],l=[],n=[],h=[16,16],f;this.init=function(){h=L.point(h)};this.pointSelect=function(b,c,k,g,h){f=g;var l=L.geoJSON();e.eachLayer(function(a){if(a&&a.options.attribute)for(var b=0;b<k.length;b++)if(a.options.attribute.id==k[b]){var c=a.toGeoJSON();c.properties=a.options.attribute.properties;l.addData(c)}});b=m.reSetCoordinate(b,c);b=L.latLng(b.lat,b.lng);a(b,l)};this.callbackFun_onResult=function(){}};RMap.Query.PolygonSelect=function(b){function a(a,b,f){if(f&&null!=f.pic){var g=new Image;g.src=f.pic;g.onload=function(){f.imgWidth=g.width;f.imgHeight=g.height;e(a,b,f)}}else e(a,b,f)}function e(a,b,e){var f=null;e&&e.pic&&(e.anchor||(e.anchor=[e.imgWidth/2,e.imgHeight/2]),f=L.icon({iconUrl:e.pic,iconAnchor:e.anchor}));for(e=0;e<a.length;e++){var g=L.marker([b[e].lat,b[e].lng],{attribute:a[e]});null!=f&&g.setIcon(f);h.addLayer(g)}}function m(a,b,e){for(var f=0,g=0;g<e.length;g++){for(var h=e[g],l=!1,m=void 0,n=void 0,v=void 0,n=0,v=h.length-1;n<h.length;v=n++){var m=h[n][0],x=h[n][1],y=h[v][0],v=h[v][1];(m=x>b!==v>b&&a<(y-m)*(b-x)/(v-x)+m)&&(l=!l)}l&&f++}if(0==f%2)return!1;if(1==f%2)return!0}var g=b.map,l=b.appEvent,n=b.appCoord,h,f=[16,16];this.init=function(){f=L.point(f);h=L.layerGroup().addTo(g);l.on(l.clearMap,function(a){h.clearLayers()})};this.polygonSelect=function(b,c,e,f){f=RMap.extend({styleOut:{}},f);var h;g.eachLayer(function(a){a&&a.options.attribute&&a.options.attribute.id==b&&(h=a.toGeoJSON())});for(var l=[],C=[],N=[],G,v=0;v<c.length;v++){var x=n.reSetCoordinate(c[v].lng,c[v].lat);l[v]=x}"Polygon"==h.geometry.type?G=[h.geometry.coordinates]:"MultiPolygon"==h.geometry.type&&(G=h.geometry.coordinates);for(j=0;j<G.length;j++)for(v=0;v<l.length;v++)m(l[v].lng,l[v].lat,G[j])&&(C.push(c[v]),N.push(l[v]));a(C,N,f.styleOut);e(C)};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.removePolygonSelect=function(){h.clearLayers()}};