///<jscompress sourcefile="ClassManager.js" />
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

/**
 * @requires OpenLayers/SingleFile.js
 */

/**
 * Constructor: OpenLayers.Class
 * Base class used to construct all other classes. Includes support for 
 *     multiple inheritance. 
 *     
 * This constructor is new in OpenLayers 2.5.  At OpenLayers 3.0, the old 
 *     syntax for creating classes and dealing with inheritance 
 *     will be removed.
 * 
 * To create a new OpenLayers-style class, use the following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(prototype);
 * (end)
 *
 * To create a new OpenLayers-style class with multiple inheritance, use the
 *     following syntax:
 * (code)
 *     var MyClass = OpenLayers.Class(Class1, Class2, prototype);
 * (end)
 * 
 * Note that instanceof reflection will only reveal Class1 as superclass.
 *
 *////<jscompress sourcefile="Hashtable.js" />
/**
 * 哈希表
 *////<jscompress sourcefile="AppEvent.js" />
/**
 * 全局事件类，可以进行项目全局的监听和派发
 *////<jscompress sourcefile="DataManager.js" />
/**
 * 数据共享管理
 *////<jscompress sourcefile="ViewMap.js" />
/**
 * @class 地图浏览
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLayer.js" />
/**
 * @class 添加图层
 * @param {Object} classOption
 *////<jscompress sourcefile="SwitchMap.js" />
/**
 * @class 切换底图
 * @param {Object} classOption
 *////<jscompress sourcefile="AddCirclePoint.js" />
/**
 * @class 添加圆形点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLightPoint.js" />
/**
 * @class 添加高亮点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddLine.js" />
/**
 * @class 添加折线
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPoint.js" />
/**
 * @class 添加图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPointList.js" />
/**
 * @class 添加一组图片标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="AddPolygon.js" />
/**
 * @class 添加面
 * @param {Object} classOption
 *////<jscompress sourcefile="AddTextPoint.js" />
/**
 * @class 添加文字标记点
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawCircle.js" />
/**
 * @class 绘制圆形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawLine.js" />
/**
 * @class 绘制折线
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawPolygon.js" />
/**
 * @class 绘制多边形
 * @param {Object} classOption
 *////<jscompress sourcefile="DrawRect.js" />
/**
 * @class 绘制矩形
 * @param {Object} classOption
 *////<jscompress sourcefile="Measure.js" />
/**
 * @class 测量
 * @param {Object} classOption
 *////<jscompress sourcefile="PopWindow.js" />
/**
 * @class 气泡窗口
 * @param {Object} classOption
 *////<jscompress sourcefile="Buffer.js" />
/**
 * @class 缓冲
 * @param {Object} classOption
 *////<jscompress sourcefile="ClearMap.js" />
/**
 * @class 清空地图
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertCoord.js" />
/**
 * @class 坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="ConvertEncryptCoord.js" />
/**
 * @class 加密坐标转换
 * @param {Object} classOption
 *////<jscompress sourcefile="GetMapInformation.js" />
/**
 * @class 获取地图信息
 * @param {Object} classOption
 *////<jscompress sourcefile="ShowCoordinate.js" />
/**
 * @class 显示地图坐标
 * @param {Object} classOption
 *////<jscompress sourcefile="TrackPlay.js" />
/**
 * @class 轨迹回放
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayer.js" />
/**
 * @class 查询
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByPointBuffer.js" />
/**
 * @class 点缓冲查询
 * @param {Object} classOption
 *////<jscompress sourcefile="QueryLayerByRect.js" />
/**
 * @class 拉框查询
 * @param {Object} classOption
 */RMap.Class=function(){var b=arguments.length,a=arguments[0],f=arguments[b-1],m="function"==typeof f.initialize?f.initialize:function(){a.prototype.initialize.apply(this,arguments)};1<b?(b=[m,a].concat(Array.prototype.slice.call(arguments).slice(1,b-1),f),RMap.inherit.apply(null,b)):m.prototype=f;return m};RMap.inherit=function(b,a){var f=function(){};f.prototype=a.prototype;b.prototype=new f;var m,e,f=2;for(m=arguments.length;f<m;f++)e=arguments[f],"function"===typeof e&&(e=e.prototype),RMap.extend(b.prototype,e)};RMap.extend=function(b,a){b=b||{};if(a){for(var f in a){var m=a[f];void 0!==m&&(b[f]=m)}"function"==typeof window.Event&&a instanceof window.Event||!a.hasOwnProperty||!a.hasOwnProperty("toString")||(b.toString=a.toString)}return b};RMap.Hashtable=function(){var b=[];this.add=function(a,f){for(var m=!1,e=0;e<b.length;e++)b[e][0]==a&&(b[e][1]=f,m=!0);0==m&&b.push([a,f])};this.get=function(a){for(var f=0;f<b.length;f++)if(b[f][0]==a)return b[f][1];return null};this.foreach=function(a){for(var f=0;f<b.length;f++)a(b[f][0],b[f][1])};this.remove=function(a){for(var f=0;f<b.length;f++)b[f][0]==a&&b.splice(f,1)};this.clear=function(){}};RMap.BaseWidget=RMap.Class({initialize:function(){},map:null});RMap.AppEvent=function(){this.clearMap="tools_clearMap";this.clearDrawMeasure="clearDrawMeasure";this.clearQueryResult="clearQueryResult";this.clearHightLight="clearHightLight";this.addShareData="dataManager_addShareData";this.getShareData="dataManager_getShareData";this.removeShareData="dataManager_removeShareData";this.onShareDataChange="dataManager_onShareDataChange";var b=document.createElement("a");this.dispatch=function(a,f,m){var e=document.createEvent("Event");e.initEvent(a,f,m);b.dispatchEvent(e)};this.on=function(a,f){b.addEventListener(a,f)}};RMap.AppCoord=function(b){function a(c,a){var p=g(c,a);return e(p.lng,p.lat)}function f(c,a){var p=m(c,a);return l(p.lng,p.lat)}function m(a,r){var p=d(a-105,r-35),g=h(a-105,r-35),m=r/180*c,b=Math.sin(m),b=1-k*b*b,e=Math.sqrt(b),p=180*p/(n*(1-k)/(b*e)*c),g=180*g/(n/e*Math.cos(m)*c);return{lng:a+g,lat:r+p}}function e(a,r){var p=d(a-105,r-35),g=h(a-105,r-35),b=r/180*c,m=Math.sin(b),m=1-k*m*m,e=Math.sqrt(m),p=180*p/(n*(1-k)/(m*e)*c),g=180*g/(n/e*Math.cos(b)*c);return{lng:2*a-(a+g),lat:2*r-(r+p)}}function l(c,a){var p=Math.sqrt(c*c+a*a)+2E-5*Math.sin(a*z),g=Math.atan2(a,c)+3E-6*Math.cos(c*z);return{lng:p*Math.cos(g)+.0065,lat:p*Math.sin(g)+.006}}function g(c,a){var p=c-.0065,g=a-.006,k=Math.sqrt(p*p+g*g)-2E-5*Math.sin(g*z),p=Math.atan2(g,p)-3E-6*Math.cos(p*z);return{lng:k*Math.cos(p),lat:k*Math.sin(p)}}function d(a,g){var p=-100+2*a+3*g+.2*g*g+.1*a*g+.2*Math.sqrt(Math.abs(a)),p=p+2*(20*Math.sin(6*a*c)+20*Math.sin(2*a*c))/3,p=p+2*(20*Math.sin(g*c)+40*Math.sin(g/3*c))/3;return p+=2*(160*Math.sin(g/12*c)+320*Math.sin(g*c/30))/3}function h(a,g){var p=300+a+2*g+.1*a*a+.1*a*g+.1*Math.sqrt(Math.abs(a)),p=p+2*(20*Math.sin(6*a*c)+20*Math.sin(2*a*c))/3,p=p+2*(20*Math.sin(a*c)+40*Math.sin(a/3*c))/3;return p+=2*(150*Math.sin(a/12*c)+300*Math.sin(a/30*c))/3}this.reSetCoordinate=function(c,k,p){c=void 0==c||void 0==k||null==c||null==k||NaN==c||NaN==k?null:{lng:Number(c),lat:Number(k)};"wgs84"!=p&&"gcj02"!=p&&"bd09"!=p&&(p=b?b:"wgs84");if("wgs84"==p){var h=c.lng,n=c.lat,d;"wgs84"==RMap.baseMapType?d={lng:h,lat:n}:"bd09"==RMap.baseMapType?d=f(h,n):"gcj02"==RMap.baseMapType&&(d=m(h,n));c=d}else"gcj02"==p?(d=c.lng,n=c.lat,"wgs84"==RMap.baseMapType?newCoord=h=e(d,n):"bd09"==RMap.baseMapType?h=l(d,n):"gcj02"==RMap.baseMapType&&(h={lng:d,lat:n}),c=h):"bd09"==p&&(d=c.lng,h=c.lat,"wgs84"==RMap.baseMapType?n=a(d,h):"bd09"==RMap.baseMapType?n={lng:d,lat:h}:"gcj02"==RMap.baseMapType&&(n=g(d,h)),c=n);return c};this.reSetCoordinate_out=function(c,k,p){"wgs84"!=p&&"gcj02"!=p&&"bd09"!=p&&(p=b?b:"wgs84");c={lng:c,lat:k};if("wgs84"==p){var h=c.lng,n=c.lat,d;"wgs84"==RMap.baseMapType?d={lng:h,lat:n}:"bd09"==RMap.baseMapType?(d=a(h,n),d={lng:d.lng,lat:d.lat}):"gcj02"==RMap.baseMapType&&(d=e(h,n),d={lng:d.lng,lat:d.lat});d.proj="wgs84";c=d}else"gcj02"==p?(d=c.lng,n=c.lat,"wgs84"==RMap.baseMapType?(d=m(d,n),h={lng:d.lng,lat:d.lat}):"bd09"==RMap.baseMapType?(d=g(d,n),h={lng:d.lng,lat:d.lat}):"gcj02"==RMap.baseMapType&&(h={lng:d,lat:n}),h.proj="gcj02",c=h):"bd09"==p&&(d=c.lng,h=c.lat,"wgs84"==RMap.baseMapType?(d=f(d,h),n={lng:d.lng,lat:d.lat}):"bd09"==RMap.baseMapType?n={lng:d,lat:h}:"gcj02"==RMap.baseMapType&&(d=l(d,h),n={lng:d.lng,lat:d.lat}),n.proj="bd09",c=n);return c};var c=3.141592653589793,n=6378245,k=.006693421622965943,z=3E3*c/180;this.convert_bd09_To_gps84=function(c,g){return a(c,g)};this.convert_gps84_To_bd09=function(c,a){return f(c,a)};this.convert_gps84_To_gcj02=function(c,a){return m(c,a)};this.convert_gcj02_To_gps84=function(c,a){return e(c,a)};this.convert_gcj02_To_bd09=function(c,a){return l(c,a)};this.convert_bd09_To_gcj02=function(c,a){return g(c,a)}};RMap.DataManager=function(b){function a(a){l.add(a.key,a.value);e.dispatch(e.onShareDataChange,{key:a.key,value:a.value})}function f(a,d){var h=l.get(a);d&&d(h)}function m(a){l.remove(a)}var e=b.appEvent,l=new RMap.Hashtable;this.init=function(){e.on(e.addShareData,a);e.on(e.getShareData,f);e.on(e.removeShareData,m)}};RMap.config=ResourceListConfig;RMap.Map=function(b,a){function f(c){var a=c.type||"TDT_ArcGISCache",g=c.name||"",d=c.url||"{srciptUrl}/map/TDTSL/_alllayers";if(void 0==d||null==d)d=void 0;else if(-1!=d.search("{srciptUrl}")){var p=RMap.scriptLocation.split("/"),h=p[0];if(".."==h)for(var n=0;n<p.length-2;n++)h+="/..";else h=p[0]+"//"+p[2];d=d.replace("{srciptUrl}",h)}var m;switch(a){case "OnLineMap":a=new RMap.BaseMapLayer;m=a.OnLineMap(c);break;case "TDT_ArcGISCache":a=new RMap.TDTLayer;m=a.ArcGISTileLayer(d,g);break;case "GCJ_ArcGISCache":a=new RMap.GCJLayer;m=a.ArcGISTileLayer(d,g);break;case "ArcGISTiledMapLayer":a=new RMap.BaseMapLayer;m=a.ArcGISTiledMapLayer(c);break}return m}var m=RMap.scriptUrl.split("?");if(m&&1<m.length)for(var e=m[1].split("\x26"),m=0;m<e.length;m++){var l=e[m].split("\x3d");"key"==l[0]&&(RMap.config.license||(RMap.config.license=[]),RMap.config.license.push(l[1].toString()))}for(var g="EPSG:4326",e=function(){for(var c=RMap.extend({center:RMap.config.center,zoom:RMap.config.zoom,extent:RMap.config.extent,minZoom:RMap.config.minZoom,maxZoom:RMap.config.maxZoom,type:["GDSL_OL"]},a),d=0;d<c.type.length;d++)if("TDTSL"==c.type[d]||"TDTYX"==c.type[d])g="EPSG:4326",RMap.baseMapType="wgs84";else if("BDSL"==c.type[d]||"BDYX"==c.type[d])g="EPSG:102113",RMap.baseMapType="bd09";else if("GDSL"==c.type[d]||"GDYX"==c.type[d])g="EPSG:102113",RMap.baseMapType="gcj02";else if("GGSL"==c.type[d]||"GGYX"==c.type[d])g="EPSG:102113",RMap.baseMapType="gcj02";else if("TDTSL_OL"==c.type[d]||"TDTYX_OL"==c.type[d])g="EPSG:3857",RMap.baseMapType="wgs84";else if("BDSL_OL"==c.type[d])g="EPSG:3857",RMap.baseMapType="gcj02";else if("GDSL_OL"==c.type[d]||"GGSL_OL"==c.type[d]||"GGSL_OL"==c.type[d]||"GGDEM_OL"==c.type[d]||"GGYX_OL"==c.type[d])g="EPSG:3857",RMap.baseMapType="gcj02";return c}(),d=RMap.config.baseLayer,l=[],h,m=0;m<d.length;m++)for(var c=d[m],n=0;n<e.type.length;n++)c.name==e.type[n]&&(c.ESPG&&(g="EPSG:"+c.ESPG,RMap.sysProjection=g),h=f(d[m]),h.eachLayer(function(c){RMap.baseLayerList.push(c)}),0==n&&l.push(h));m=new RMap.AppCoord(e.proj);d=m.reSetCoordinate(e.center[0],e.center[1],e.proj);e.center[0]=d.lat;e.center[1]=d.lng;if(null==RMap.crs||void 0==RMap.crs)RMap.crs=L.CRS.EPSG3857;e=L.map("map",{crs:RMap.crs,center:e.center,zoom:e.zoom,layers:l,zoomControl:!1,closePopupOnClick:!1});L.control.zoom({zoomInTitle:"\u653e\u5927",zoomOutTitle:"\u7f29\u5c0f"}).addTo(e);l=new RMap.AppEvent;(new RMap.DataManager({appEvent:l})).init();return new RMap.InterfaceManager({map:e,appEvent:l,appConfig:RMap.config,appCoord:m})};RMap.InterfaceManager=function(b){var a=new RMap.View.ViewMap(b);this.center=a.center;this.zoom=a.zoom;this.centerZoom=a.centerZoom;this.extent=a.extent;this.extentByData=a.extentByData;a=new RMap.Layer.SwitchMap(b);a.init();this.switchMap=a.switchMap;a=new RMap.Layer.AddLayer(b);a.init();this.addLayer=a.addLayer;this.removeLayer=a.removeLayer;a=new RMap.Tools.Buffer(b);a.init();this.bufferPoint=a.bufferPoint;this.removeBuffer=a.removeBuffer;a=new RMap.Graphic.AddPolygon(b);a.init();this.addPolygon=a.addPolygon;this.removePolygon=a.removePolygon;a=new RMap.Graphic.AddLine(b);a.init();this.addLine=a.addLine;this.removeLine=a.removeLine;a=new RMap.InfoWindow.PopWindow(b);a.init();this.showPopWindow=a.showPopWindow;this.hidePopWindow=a.hidePopWindow;a=new RMap.Draw.DrawCircle(b);a.init();this.drawCircle=a.drawCircle;this.removeDrawCircle=a.removeDrawCircle;a=new RMap.Draw.DrawRect(b);a.init();this.drawRect=a.drawRect;this.removeDrawRect=a.removeDrawRect;a=new RMap.Draw.DrawPolygon(b);a.init();this.drawPolygon=a.drawPolygon;this.removeDrawPolygon=a.removeDrawPolygon;a=new RMap.Draw.DrawLine(b);a.init();this.drawLine=a.drawLine;this.removeDrawLine=a.removeDrawLine;this.clearMap=(new RMap.Tools.ClearMap(b)).clearMap;this.convertCoord=(new RMap.Tools.ConvertCoord(b)).convertCoord;this.convertEncryptCoord=(new RMap.Tools.ConvertEncryptCoord(b)).convertEncryptCoord;a=new RMap.Tools.ShowCoordinate(b);a.init();this.showCoordinate=a.showCoordinate;this.hideCoordinate=a.hideCoordinate;a=new RMap.Tools.GetMapInformation(b);a.init();this.getCoordinate=a.getCoordinate;this.stopGetCoordinate=a.stopGetCoordinate;this.getMapExtent=a.getMapExtent;this.getMapLevel=a.getMapLevel;a=new RMap.Measure.Measure(b);a.init();this.measureLength=a.measureLength;this.measureArea=a.measureArea;this.measureCircle=a.measureCircle;this.measureRect=a.measureRect;this.removeMeasure=a.removeMeasure;a=new RMap.Control.TrackPlay(b);a.init();this.addTrackPlay=a.addTrackPlay;this.removeTrackPlay=a.removeTrackPlay;a=new RMap.Graphic.AddLightPoint(b);a.init();this.addLightPoint=a.addLightPoint;this.removeLightPoint=a.removeLightPoint;a=new RMap.Graphic.AddPoint(b);a.init();this.addPoint=a.addPoint;this.removePoint=a.removePoint;a=new RMap.Graphic.AddPointList(b);a.init();this.addPointList=a.addPointList;this.removePointList=a.removePointList;a=new RMap.Graphic.AddCirclePoint(b);a.init();this.addCirclePoint=a.addCirclePoint;this.removeCirclePoint=a.removeCirclePoint;a=new RMap.Graphic.AddTextPoint(b);a.init();this.addTextPoint=a.addTextPoint;this.removeTextPoint=a.removeTextPoint;a=new RMap.Query.QueryLayer(b);a.init();this.queryLayer=a.queryLayer;this.removeQueryResult=a.removeQueryResult;a=new RMap.Query.QueryLayerByRect(b);a.init();this.queryLayerByRect=a.queryLayerByRect;b=new RMap.Query.QueryLayerByPointBuffer(b);b.init();this.queryLayerByPointBuffer=b.queryLayerByPointBuffer};RMap.BaseMapLayer=function(b){this.OnLineMap=function(a){var b=[];"GDSL_OL"==a.name&&(b=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b]));if("GDYX_OL"==a.name)var b=L.tileLayer.chinaProvider("GaoDe.Satellite.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),m=L.tileLayer.chinaProvider("GaoDe.Satellite.Annotion",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b,m]);"GEOQ_OL"==a.name&&(b=L.tileLayer.chinaProvider("Geoq.Normal.Map",{maxZoom:18,minZoom:3,layerName:"BaseMap|"+a.name}),b=L.layerGroup([b]));return b};this.ArcGISTiledMapLayer=function(a){a.EPSG&&a.resolutions?RMap.crs=new L.Proj.CRS("EPSG:"+a.EPSG,a.proj4,{origin:a.origin,resolutions:a.resolutions}):"3857"==a.EPSG&&void 0==a.resolutions&&(RMap.crs=L.CRS.EPSG3857);var b=[];a=L.esri.tiledMapLayer({url:a.url});return b=L.layerGroup([a])}};RMap.GCJLayer=function(b){var a=[156543.03392800014,78271.51696399994,39135.75848200009,19567.87924099992,9783.93962049996,4891.96981024998,2445.98490512499,1222.992452562495,611.4962262813797,305.74811314055756,152.87405657041106,76.43702828507324,38.21851414253662,19.10925707126831,9.554628535634155,4.77731426794937,2.388657133974685,1.1943285668550503,.5971642835598172,.29858214164761665,.14929107082380833,.07464553541190416];RMap.crs=new L.Proj.CRS("EPSG:102113","+proj\x3dmerc +lon_0\x3d0 +k\x3d1 +x_0\x3d0 +y_0\x3d0 +a\x3d6378137 +b\x3d6378137 +units\x3dm +no_defs",{origin:[-2.0037508342787E7,2.0037508342787E7],resolutions:a});this.ArcGISTileLayer=function(b,e){var l=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+e,continuousWorld:!0});l.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var d=a.z.toString(16).toUpperCase();return"L"+f(d,2)},x:function(){var d=a.y.toString(16).toUpperCase();return"R"+f(d,8)},y:function(){var d=a.x.toString(16).toUpperCase();return"C"+f(d,8)}}))};return L.layerGroup([l])};var f=function(a,b){for(var l=a.length;l<b;)a="0"+a,l++;return a}};RMap.TDTLayer=function(b){var a=[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.1457672119140625E-5,1.0728836059570312E-5,5.364418029785156E-6,2.682209014892578E-6,1.341104507446289E-6,6.705522537231445E-7,3.3527612686157227E-7];RMap.crs=new L.Proj.CRS("EPSG:4326","+proj\x3dlonglat +datum\x3dWGS84 +no_defs",{origin:[-180,90],resolutions:a});this.ArcGISTileLayer=function(b,e){var l=new L.TileLayer(b+"/{z}/{x}/{y}.png",{maxZoom:a.length-1,minZoom:0,layerName:"BaseMap|"+e,continuousWorld:!0});l.getTileUrl=function(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:function(){var d=a.z.toString(16).toUpperCase();return"L"+f(d,2)},x:function(){var d=a.y.toString(16).toUpperCase();return"R"+f(d,8)},y:function(){var d=a.x.toString(16).toUpperCase();return"C"+f(d,8)}}))};return L.layerGroup([l])};var f=function(a,b){for(var l=a.length;l<b;)a="0"+a,l++;return a}};RMap.View.ViewMap=function(b){var a=b.map,f=b.appCoord;this.center=function(b,e,l){l=RMap.extend({proj:null},l);e=f.reSetCoordinate(b,e,l.proj);null==e?console.error("center\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=e.lng,e=e.lat,a.setView([Number(e),Number(b)]))};this.zoom=function(b){a.setZoom(b)};this.centerZoom=function(b,e,l,g){g=RMap.extend({proj:null},g);e=f.reSetCoordinate(b,e,g.proj);null==e?console.error("centerZoom\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(b=e.lng,e=e.lat,a.setView([Number(e),Number(b)],l))};this.extent=function(b,e,l,g,d){d=RMap.extend({proj:null},d);b=f.reSetCoordinate(b,e,d.proj);l=f.reSetCoordinate(l,g,d.proj);a.fitBounds([[b.lat,b.lng],[l.lat,l.lng]])};this.extentByData=function(b,e){e=RMap.extend({proj:null},e);for(var l=[],g=0;g<b.length;g++){var d=f.reSetCoordinate(b[g][0],b[g][1],e.proj);l[g]=[d.lat,d.lng]}l=L.polygon(l);a.fitBounds(l.getBounds())}};RMap.Layer.AddLayer=function(b){function a(a){f.eachLayer(function(g){if(g&&g.options.attribution){var d=g.options.attribution.split("|");if("addLayer"==d[0])if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var h=0;h<a.length;h++)d[1]==a[h]&&f.removeLayer(g)}else f.removeLayer(g)}})}var f=b.map,m=b.appEvent,e=b.appCoord;this.init=function(){m.on(m.clearMap,function(b){a()})};this.addLayer=function(a,g){g=RMap.extend({opacity:1},g);for(var d=RMap.config.thematicLayer,h=0;h<d.length;h++){var c=d[h];if(a==c.layerName){if("ArcGISRest"==c.layerType){var b=c,k=g;1==b.isQueryLayer?(k.where||(k.where="1\x3d1"),L.esri.featureLayer({url:b.url,opacity:k.opacity,where:k.where,attribution:"addLayer|"+b.layerName}).addTo(f)):L.esri.dynamicMapLayer({url:b.url,opacity:k.opacity,attribution:"addLayer|"+b.layerName}).addTo(f)}else"WFS_GeoServer"==c.layerType&&L.tileLayer.wms(c.url,{layers:c.typeName,format:"image/png",transparent:!0,opacity:g.opacity,attribution:"addLayer|"+c.layerName}).addTo(f);g.isCenter&&c.extent&&(b=e.reSetCoordinate(c.extent[0],c.extent[1]),c=e.reSetCoordinate(c.extent[2],c.extent[3]),f.fitBounds([[b.lat,b.lng],[c.lat,c.lng]]))}}};this.removeLayer=function(b){a(b)}};RMap.Layer.SwitchMap=function(b){var a=b.map,f=b.appEvent;this.init=function(){f.on(f.clearMap,function(a){})};this.switchMap=function(b){a.eachLayer(function(d){if(d&&d.options.layerName){var h=d.options.layerName.split("|");"BaseMap"==h[0]&&h[1]!=b&&a.removeLayer(d)}});for(var e=0;e<RMap.baseLayerList.length;e++){var l=RMap.baseLayerList[e],g=l.options.layerName.split("|");"BaseMap"==g[0]&&g[1]==b&&a.addLayer(l)}}};RMap.Graphic.AddCirclePoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var d=0;d<a.length;d++)for(var b=l.getLayers(),c=0;c<b.length;c++)a[d]==b[c].options.attribute.id&&l.removeLayer(b[c])}else l.clearLayers()}var f=b.map,m=b.appEvent,e=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addCirclePoint=function(a,d,b){b=RMap.extend({lng:Number(a),lat:Number(d),id:null,radius:3,color:"#3388ff",opacity:1,data:null,onClick:null,proj:null},b);d=e.reSetCoordinate(a,d,b.proj);if(null==d)console.error("addCirclePoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=d.lng,d=d.lat,a=L.circleMarker([d,a],{radius:b.radius,color:b.color,opacity:b.opacity,fillColor:b.color,fillOpacity:b.opacity,attribute:b}),l.addLayer(a),b.onClick)a.on("click",function(c){b.onClick(b)})};this.callbackFun_onClick=function(){};this.removeCirclePoint=function(b){a(b)}};RMap.Graphic.AddLightPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var h=l.getLayers(),c=0;c<h.length;c++)a[b]==h[c].options.attribute.id&&l.removeLayer(h[c])}else l.clearLayers()}var f=b.map,m=b.appEvent,e=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()});m.on(m.clearHightLight,function(b){a()})};this.addLightPoint=function(b,d,h){m.dispatch(m.clearHightLight);a();b=RMap.extend({lng:b,lat:d,proj:null},h);b=e.reSetCoordinate(b.lng,b.lat,b.proj);null==b?console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(d=L.icon.pulse({iconSize:[12,12],color:"red"}),b=L.marker([b.lat,b.lng],{icon:d}).addTo(f),l.addLayer(b),$(".leaflet-pulsing-icon").css("pointer-events","none"))};this.removeLightPoint=function(b){a(b);m.dispatch(m.clearHightLight)}};RMap.Graphic.AddLine=function(b){function a(c,a){a=RMap.extend({points:c,id:null,width:2,color:"#3388ff",opacity:1,style:"",isCenter:!1,isShowArrow:!1,data:null,onClick:null,proj:null},a);for(var b=[],h=[],k=0;k<c.length;k++){var g=z.reSetCoordinate(c[k][0],c[k][1],a.proj);b[k]=[g.lat,g.lng];h[k]=[g.lng,g.lat]}g=L.polyline(b,{color:a.color,opacity:a.opacity,weight:a.width,attribute:a});u.addLayer(g);h=l(h);for(k=0;k<h.length;k++)if(h[k][2]&&0<h[k][2]){if((h[k-1][0]!=h[k][0]||h[k-1][1]!=h[k][1])&&h[k][4]==h[k][5]){var m=d(h[k-1],h[k],h[k][2],h[k][3]);f(m,a,h[k])}}else a.isShowArrow&&b[k-1]&&b[k]&&e([b[k-1],b[k]],u,a);if(a.onClick)g.on("click",function(c){c=c.latlng;c=z.reSetCoordinate_out(c.lng,c.lat);a.onClick({id:a.id,pointList:a.points,data:a.data,clickPosition:[c.lng,c.lat]})});1==a.isCenter&&n.fitBounds(g.getBounds())}function f(c,a,b){for(var d=[],h=0;h<c.length;h++)d[h]=[c[h][1],c[h][0]];d=L.polyline(d,{color:a.color,opacity:a.opacity,weight:a.width,attribute:a});u.addLayer(d);a.isShowArrow&&b[4]==b[5]&&(h=c[Math.floor(c.length/2)],c=c[Math.floor(c.length/2)+1],h=[h[1],h[0]],c=[c[1],c[0]],e([h,c],u,a,b[5].toString()));if(a.onClick)d.on("click",function(c){a.onClick(a)})}function m(c){if(void 0!=c&&null!=c){c.constructor!=Array&&(c=[c]);for(var a=0;a<c.length;a++)for(var b=u.getLayers(),d=0;d<b.length;d++)c[a]==b[d].options.attribute.id&&u.removeLayer(b[d])}else u.clearLayers()}function e(c,a,b,d){for(var h=0;h<c.length-1;h++){var k=c[h],n=c[h+1],g=n[0]-k[0],e=n[1]-k[1],l=[(k[0]+n[0])/2,(k[1]+n[1])/2],k=180*Math.atan2(n[0]-k[0],n[1]-k[1])/Math.PI;-180<k&&0>k&&(k=360+k);n=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");k=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+n+'" style\x3d"transform:rotate(-'+k+'deg)"/\x3e'});k=L.marker(l,{icon:k,attribute:b});0==g&&0==e||a.addLayer(k);d&&(g=L.divIcon({className:"my-lf-label",iconSize:[20,20],html:d}),l=L.marker(l,{icon:g,attribute:b}),u.addLayer(l),$(".my-lf-label").css("text-align","center"),$(".my-lf-label").css("font-weight","bold"),$(".my-lf-label").css("font-size",15),$(".my-lf-label").css("font-family","\u5fae\u8f6f\u96c5\u9ed1"),$(".my-lf-label").css("color","#000"),$(".my-lf-label").css("text-shadow","#FFF 2px 0 0,#FFF 0 2px 0,#FFF -2px 0 0,#FFF 0 -2px 0"))}}function l(c){for(var a=[],b=0;b<c.length-1;b++)a[0]=c[0],g(c[b],c[b+1])||a.push(c[b+1]);for(c=0;c<a.length;c++)for(var d=b=0,h=0;h<c;h++){var k;k=a[c];var n=a[c-1],e=a[h],l=a[h-1];k=g(k,n)&&g(e,l)?!1:g(k,e)&&g(n,l)?!0:g(k,l)&&g(e,n)?!0:!1;k&&(a[c][2]=a[c][2]&&0<a[c][2]?a[c][2]+1:1,void 0==a[c][3]&&(g(a[c],a[h])?(a[c][3]=1,b++,a[c][4]=b):(a[c][3]=-1,d++,a[c][4]=d)),1==a[h][3]&&a[c][3]==a[h][3]?(b++,a[c][4]=b,a[h][5]=b):-1==a[h][3]&&a[c][3]==a[h][3]&&(d++,a[c][4]=d,a[h][5]=d),a[c][5]=a[c][4])}return a}function g(c,a){return void 0==c||void 0==a?!1:c[0]==a[0]&&c[1]==a[1]?!0:!1}function d(a,b,d,k){var n;k=d;k=1;d=[(a[0]+b[0])/2,(a[1]+b[1])/2];n=h(a,b);k=-k*n/10;n=90*Math.PI/180;n=c(a,d)-n;n=[d[0]+k*Math.cos(n),d[1]+k*Math.sin(n)];d=[(a[0]+b[0])/2,(a[1]+b[1])/2];k=[(a[0]+n[0])/2,(a[1]+n[1])/2];var g=[d[0]-a[1]+b[1],d[1]+a[0]-b[0]],e=[k[0]-a[1]+n[1],k[1]+a[0]-n[0]];d[1]==g[1]?(e=(e[0]-k[0])/(e[1]-k[1]),g=e*(d[1]-k[1])+k[0],k=d[1]):k[1]==e[1]?(g=(g[0]-d[0])/(g[1]-d[1]),g=g*(k[1]-d[1])+d[0],k=k[1]):(g=(g[0]-d[0])/(g[1]-d[1]),e=(e[0]-k[0])/(e[1]-k[1]),k=(g*d[1]-d[0]-e*k[1]+k[0])/(g-e),g=g*k-g*d[1]+d[0]);d=[g,k];k=h(a,d);g=c(a,d);e=c(b,d);(n[1]-a[1])*(b[0]-a[0])>(b[1]-a[1])*(n[0]-a[0])?(a=e,n=g):(a=g,n=e);var l;b=[];g=n-a;g=0>g?g+2*Math.PI:g;for(e=0;100>=e;e++)l=a+g*e/100,n=d[0]+k*Math.cos(l),l=d[1]+k*Math.sin(l),b.push([n,l]);return b}function h(a,c){return Math.sqrt(Math.pow(a[0]-c[0],2)+Math.pow(a[1]-c[1],2))}function c(a,c){var b,d=Math.asin(Math.abs(c[1]-a[1])/h(a,c));c[1]>=a[1]&&c[0]>=a[0]?b=d+Math.PI:c[1]>=a[1]&&c[0]<a[0]?b=2*Math.PI-d:c[1]<a[1]&&c[0]<a[0]?b=d:c[1]<a[1]&&c[0]>=a[0]&&(b=Math.PI-d);return b}var n=b.map,k=b.appEvent,z=b.appCoord,u;this.init=function(){u=L.layerGroup().addTo(n);k.on(k.clearMap,function(a){m()})};this.addLine=function(c,b){a(c,b)};this.callbackFun_onClick=function(){};this.removeLine=function(a){m(a)}};RMap.Graphic.AddPoint=function(b){function a(a,c,b){b=RMap.extend({lng:a,lat:c,id:null,isCenter:!1,data:null,onClick:null,onMouseOver:null,proj:null},b);if(null!=b.pic){var d=new Image;d.src=b.pic;d.onload=function(){b.imgWidth=d.width;b.imgHeight=d.height;f(b)}}else f(b)}function f(a){var c=g.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{c=L.marker([c.lat,c.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var b=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});c.setIcon(b)}d.addLayer(c);if(a.onClick)c.on("click",function(c){a.onClick(a)});if(a.onMouseOver)c.on("mouseover",function(c){a.onMouseOver(a)})}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var b=d.getLayers(),k=0;k<b.length;k++)a[c]==b[k].options.attribute.id&&d.removeLayer(b[k])}else d.clearLayers()}var e=b.map,l=b.appEvent,g=b.appCoord,d;this.init=function(){d=L.layerGroup().addTo(e);l.on(l.clearMap,function(a){m()})};this.addPoint=function(b,c,d){a(b,c,d)};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.removePoint=function(a){m(a)}};RMap.Graphic.AddPointList=function(b){function a(a){a=RMap.extend(null,a);if(null!=a.pic){var c=new Image;c.src=a.pic;c.onload=function(){a.imgWidth=c.width;a.imgHeight=c.height;f(a)}}else f(a)}function f(a){var c=g.reSetCoordinate(a.lng,a.lat,a.proj);if(null==c)console.error("addPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{c=L.marker([c.lat,c.lng],{attribute:a});if(a.pic){a.anchor||(a.anchor=[a.imgWidth/2,a.imgHeight/2]);var b=L.icon({iconUrl:a.pic,iconAnchor:a.anchor});c.setIcon(b)}d.addLayer(c);if(a.onClick)c.on("click",function(c){a.onClick(a)});if(a.onMouseOver)c.on("mouseover",function(c){a.onMouseOver(a)})}}function m(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var c=0;c<a.length;c++)for(var b=d.getLayers(),k=0;k<b.length;k++)a[c]==b[k].options.attribute.id&&d.removeLayer(b[k])}else d.clearLayers()}var e=b.map,l=b.appEvent,g=b.appCoord,d;this.init=function(){d=L.layerGroup().addTo(e);l.on(l.clearMap,function(a){m()})};this.addPointList=function(b,c){c=RMap.extend({id:null,attrPic:null,lngField:"lng",latField:"lat",isCenter:!1,data:null,onClick:null,onMouseOver:null,proj:null},c);for(var d=eval("("+b+")"),k=[],l=0;l<d.length;l++){var f=d[l];c.lng=f[c.lngField];c.lat=f[c.latField];c.data=f;if(null!=c.attrPic)for(var m=0;m<c.attrPic.length;m++){var p=c.attrPic[m];f[p.field]==p.value&&(c.pic=p.pic)}a(c);c.isCenter&&(f=g.reSetCoordinate(c.lng,c.lat,c.proj),k.push([f.lat,f.lng]))}c.isCenter&&(d=L.polygon(k),e.fitBounds(d.getBounds()))};this.callbackFun_onClick=function(){};this.callbackFun_onMouseOver=function(){};this.removePointList=function(a){m(a)}};RMap.Graphic.AddPolygon=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var e=l.getLayers(),c=0;c<e.length;c++)a[b]==e[c].options.attribute.id&&l.removeLayer(e[c])}else l.clearLayers()}var f=b.map,m=b.appEvent,e=b.appCoord,l;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addPolygon=function(a,b){b=RMap.extend({pointList:a,id:null,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5,outLineStyle:"",color:"#3388ff",opacity:.3,data:null,isCenter:!1,onClick:null,proj:null},b);for(var h=[],c=0;c<a.length;c++){var n=e.reSetCoordinate(a[c][0],a[c][1],b.proj);h[c]=[n.lat,n.lng]}h=L.polygon(h,{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity,attribute:b});l.addLayer(h);if(b.onClick)h.on("click",function(a){a=a.latlng;a=e.reSetCoordinate_out(a.lng,a.lat);b.onClick({id:b.id,pointList:b.pointList,data:b.data,clickPosition:[a.lng,a.lat]})});1==b.isCenter&&f.fitBounds(h.getBounds())};this.callbackFun_onClick=function(){};this.removePolygon=function(b){a(b)}};RMap.Graphic.AddTextPoint=function(b){function a(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var c=l.getLayers(),n=0;n<c.length;n++)a[b]==c[n].options.attribute.id&&l.removeLayer(c[n])}else l.clearLayers()}var f=b.map,m=b.appEvent,e=b.appCoord,l,g=0;this.init=function(){l=L.layerGroup().addTo(f);m.on(m.clearMap,function(b){a()})};this.addTextPoint=function(a,b,c,n){var k={lng:Number(a),lat:Number(b),txt:c,id:null,color:0,offsetX:0,offsetY:0,font_weight:"bold",font_size:"16px",font_family:"\u5fae\u8f6f\u96c5\u9ed1",data:null,onClick:null,proj:null};c="my-lf-label";if(n.color||n.offsetX||n.offsetY||n.font_weight||n.font_size||n.font_family)g++,c+=g;n=RMap.extend(k,n);k=e.reSetCoordinate(a,b,n.proj);if(null==k)console.error("addTextPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else if(a=k.lng,b=k.lat,a=L.divIcon({className:c,iconSize:[100,24],html:n.txt}),a=L.marker([k.lat,k.lng],{icon:a}),l.addLayer(a),$("."+c).css("text-align","center"),$("."+c).css("font-weight",n.font_weight),$("."+c).css("font-size",n.font_size),$("."+c).css("font-family",n.font_family),$("."+c).css("color",n.color),$("."+c).css("top",n.offsetX),$("."+c).css("left",n.offsetY),n.onClick)a.on("click",function(a){n.onClick(n)})};this.callbackFun_onClick=function(){};this.removeTextPoint=function(b){a(b)}};RMap.Draw.DrawCircle=function(b){function a(c){d++;c.layer.drawId=void 0!=g.id||null!=g.id?g.id:"DrawCircle"+d;h.addLayer(c.layer);c=c.layer;if(g.callback){var b=l.reSetCoordinate_out(c.getBounds()._southWest.lng,c.getBounds()._southWest.lat),k=l.reSetCoordinate_out(c.getBounds()._northEast.lng,c.getBounds()._northEast.lat),b=[b.lng,b.lat,k.lng,k.lat],k=l.reSetCoordinate_out(c._latlng.lng,c._latlng.lat),e=L.Circle.toPolygon(c,64,m),f=[],r=[k.lat,k.lng],p=c.getRadius()/L.CRS.Earth.R/(Math.PI/180),D=m.project([r[0]+p,r[1]]),F=m.project([r[0]-p,r[1]]),D=D.add(F).divideBy(2),D=m.unproject(D),D=[D.lat,D.lng],r=L.latLng([r[0]+p,r[1]]),p=L.latLng(D);r.distanceTo(p);r=D[0]-k.lat;for(p=0;p<e.length;p++)f[p]=[e[p].lng,e[p].lat+r];g.callback({id:c.drawId,center:[k.lng,k.lat],radius:c._mRadius,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],extent:b,pointList:f})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=h.getLayers(),e=0;e<d.length;e++)a[b]==d[e].drawId&&h.removeLayer(d[e])}else h.clearLayers()}var m=b.map,e=b.appEvent,l=b.appCoord,g,d=0,h;this.init=function(){h=(new L.FeatureGroup).addTo(m);e.on(e.clearMap,function(a){f()});e.on(e.clearDrawMeasure,function(a){f()})};this.drawCircle=function(c,b){var d;g=d=RMap.extend({id:null,callback:c,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},b);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);var e=new L.Draw.Circle(m);e.options.shapeOptions=RMap.extend(e.options.shapeOptions,{stroke:!0,color:d.outLineColor,weight:d.outLineWidth,opacity:d.outLineOpacity,fillColor:d.color,fillOpacity:d.opacity,showMeasurements:d.showMeasurements});L.Handler.prototype.enable.call(e);e.fire("enabled",{handler:e.type});e._map.fire(L.Draw.Event.DRAWSTART,{layerType:e.type})};this.callbackFun_callback=function(){};this.removeDrawCircle=function(a){f(a)}};RMap.Draw.DrawLine=function(b){function a(c){d++;c.layer.drawId=void 0!=g.id||null!=g.id?g.id:"DrawLine"+d;h.addLayer(c.layer);c=c.layer;if(g.callback){for(var b=l.reSetCoordinate_out(c._bounds._southWest.lng,c._bounds._southWest.lat),k=l.reSetCoordinate_out(c._bounds._northEast.lng,c._bounds._northEast.lat),b=[b.lng,b.lat,k.lng,k.lat],k=c._latlngs,e=[],f=0;f<k.length;f++){var r=l.reSetCoordinate_out(k[f].lng,k[f].lat);e[f]=[r.lng,r.lat]}g.callback({id:c.drawId,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],pointList:e,extent:b})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=h.getLayers(),e=0;e<d.length;e++)a[b]==d[e].drawId&&h.removeLayer(d[e])}else h.clearLayers()}var m=b.map,e=b.appEvent,l=b.appCoord,g,d=0,h;this.init=function(){h=(new L.FeatureGroup).addTo(m);e.on(e.clearMap,function(a){f()});e.on(e.clearDrawMeasure,function(a){f()})};this.drawLine=function(c,b){var d;g=d=RMap.extend({id:null,callback:c,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!1},b);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);var e=new L.Draw.Polyline(m);e.options.shapeOptions=RMap.extend(e.options.shapeOptions,{stroke:!0,color:d.color,weight:d.width,opacity:d.opacity,showMeasurements:d.showMeasurements});L.Handler.prototype.enable.call(e);e.fire("enabled",{handler:e.type});e._map.fire(L.Draw.Event.DRAWSTART,{layerType:e.type})};this.callbackFun_callback=function(){};this.removeDrawLine=function(a){f(a)}};RMap.Draw.DrawPolygon=function(b){function a(c){d++;c.layer.drawId=void 0!=g.id||null!=g.id?g.id:"DrawPolygon"+d;h.addLayer(c.layer);c=c.layer;if(g.callback){for(var b=l.reSetCoordinate_out(c._bounds._southWest.lng,c._bounds._southWest.lat),e=l.reSetCoordinate_out(c._bounds._northEast.lng,c._bounds._northEast.lat),b=[b.lng,b.lat,e.lng,e.lat],e=c._latlngs[0],f=[],u=0;u<e.length;u++){var r=l.reSetCoordinate_out(e[u].lng,e[u].lat);f[u]=[r.lng,r.lat]}g.callback({id:c.drawId,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],pointList:f,extent:b})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=h.getLayers(),e=0;e<d.length;e++)a[b]==d[e].drawId&&h.removeLayer(d[e])}else h.clearLayers()}var m=b.map,e=b.appEvent,l=b.appCoord,g,d=0,h;this.init=function(){h=(new L.FeatureGroup).addTo(m);e.on(e.clearMap,function(a){f()});e.on(e.clearDrawMeasure,function(a){f()})};this.drawPolygon=function(c,b){var d;g=d=RMap.extend({id:null,callback:c,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},b);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);var e=new L.Draw.Polygon(m);e.options.shapeOptions=RMap.extend(e.options.shapeOptions,{stroke:!0,color:d.outLineColor,weight:d.outLineWidth,opacity:d.outLineOpacity,fillColor:d.color,fillOpacity:d.opacity,showMeasurements:d.showMeasurements});L.Handler.prototype.enable.call(e);e.fire("enabled",{handler:e.type});e._map.fire(L.Draw.Event.DRAWSTART,{layerType:e.type})};this.callbackFun_callback=function(){};this.removeDrawPolygon=function(a){f(a)}};RMap.Draw.DrawRect=function(b){function a(c){d++;c.layer.drawId=void 0!=g.id||null!=g.id?g.id:"DrawRect"+d;h.addLayer(c.layer);c=c.layer;if(g.callback){for(var b=l.reSetCoordinate_out(c._bounds._southWest.lng,c._bounds._southWest.lat),e=l.reSetCoordinate_out(c._bounds._northEast.lng,c._bounds._northEast.lat),b=[b.lng,b.lat,e.lng,e.lat],e=c._latlngs[0],f=[],u=0;u<e.length;u++){var r=l.reSetCoordinate_out(e[u].lng,e[u].lat);f[u]=[r.lng,r.lat]}g.callback({id:c.drawId,minPoint:[b[0],b[1]],maxPoint:[b[2],b[3]],pointList:f,extent:b})}m.off(L.Draw.Event.CREATED,a)}function f(a){if(void 0!=a&&null!=a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)for(var d=h.getLayers(),e=0;e<d.length;e++)a[b]==d[e].drawId&&h.removeLayer(d[e])}else h.clearLayers()}var m=b.map,e=b.appEvent,l=b.appCoord,g,d=0,h;this.init=function(){h=(new L.FeatureGroup).addTo(m);e.on(e.clearMap,function(a){f()});e.on(e.clearDrawMeasure,function(a){f()})};this.drawRect=function(b,d){var e;g=e=RMap.extend({id:null,callback:b,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!1},d);m.off(L.Draw.Event.CREATED,a);m.on(L.Draw.Event.CREATED,a);var f=new L.Draw.Rectangle(m);f.options.shapeOptions=RMap.extend(f.options.shapeOptions,{stroke:!0,color:e.outLineColor,weight:e.outLineWidth,opacity:e.outLineOpacity,fillColor:e.color,fillOpacity:e.opacity,showMeasurements:e.showMeasurements});L.Handler.prototype.enable.call(f);f.fire("enabled",{handler:f.type});f._map.fire(L.Draw.Event.DRAWSTART,{layerType:f.type})};this.callbackFun_callback=function(){};this.removeDrawRect=function(a){f(a)}};RMap.Measure.Measure=function(b){var a=b.appEvent,f=new RMap.Draw.DrawLine(b),m=new RMap.Draw.DrawRect(b),e=new RMap.Draw.DrawCircle(b),l=new RMap.Draw.DrawPolygon(b);this.init=function(){f.init();m.init();e.init();l.init()};this.measureLength=function(a){a=RMap.extend({id:null,callback:null,width:2,color:"#33AAFF",opacity:.5,style:"",showMeasurements:!0},a);f.drawLine(null,a)};this.measureRect=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);m.drawRect(null,a)};this.measureCircle=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);e.drawCircle(null,a)};this.measureArea=function(a){a=RMap.extend({id:null,callback:null,outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5,showMeasurements:!0},a);l.drawPolygon(null,a)};this.removeMeasure=function(){a.dispatch(a.clearDrawMeasure)}};RMap.InfoWindow.PopWindow=function(b){var a=b.map,f=b.appEvent,m=b.appCoord,e=L.popup(),l=new RMap.Graphic.AddLightPoint(b);this.init=function(){l.init();L.layerGroup().addTo(a);f.on(f.clearMap,function(b){a.removeLayer(e);l.removeLightPoint()})};this.showPopWindow=function(b,d,f,c){c=RMap.extend({isCenter:!1,isHighLight:!1,autoPan:!0,proj:null},c);var n=m.reSetCoordinate(b,d,c.proj);null==n?console.error("showPopWindow\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4"):(c.isCenter&&a.setView([Number(n.lat),Number(n.lng)]),c.isHighLight&&l.addLightPoint(b,d,c),e=L.popup({autoPan:c.autoPan}),e.setLatLng([Number(n.lat),Number(n.lng)]),e.setContent(f),e.openOn(a))};this.hidePopWindow=function(){a.removeLayer(e);l.removeLightPoint()}};RMap.Tools.Buffer=function(b){var a,f,m;function e(b,e,g,r){r=RMap.extend({outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.3,isCenter:!1,proj:null},r);b=Number(b);e=Number(e);g=Number(g);a=b;f=e;m=r;var y=d.reSetCoordinate(b,e,r.proj);if(null==y)console.error("bufferPoint\u65b9\u6cd5\u4f20\u5165\u5750\u6807\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u8ba4");else{var E=L.circle([y.lat,y.lng],{radius:g});E.setStyle({stroke:!0,color:r.outLineColor,weight:r.outLineWidth,opacity:r.outLineOpacity,fillColor:r.color,fillOpacity:r.opacity});h.clearLayers();h.addLayer(E);var v=l.getZoom();l.dragging.enabled()&&l.setZoom(RMap.config.maxZoom);var A=E.getBounds(),G=d.reSetCoordinate_out(A.getWest(),A.getSouth()),t=d.reSetCoordinate_out(A.getEast(),A.getNorth()),G=[G.lng,G.lat,t.lng,t.lat],t=L.Circle.toPolygon(E,64,l),E=[],x=[y.lat,y.lng],w=g/L.CRS.Earth.R/(Math.PI/180),B=l.project([x[0]+w,x[1]]),N=l.project([x[0]-w,x[1]]),B=B.add(N).divideBy(2),B=l.unproject(B),B=[B.lat,B.lng],x=L.latLng([x[0]+w,x[1]]),w=L.latLng(B);x.distanceTo(w);x=B[0]-y.lat;for(w=0;w<t.length;w++)y=d.reSetCoordinate_out(t[w].lng,t[w].lat+x),E[w]=[y.lng,y.lat];y=[A.getEast(),(A.getSouth()+A.getNorth())/2];t=g;x="";x=1E4<=t?(t/1E3).toFixed(1)+"km":t.toFixed(0)+"m";t=L.marker([y[1],y[0]],{icon:L.icon({iconUrl:RMap.scriptLocation+"image/tuodong.png",iconAnchor:[17.8,10]})});h.addLayer(t);x=L.divIcon({className:"my-lf-label",iconSize:[50,20],html:x});y=L.marker([y[1],y[0]],{icon:x});h.addLayer(y);$(".my-lf-label").css("text-align","center");$(".my-lf-label").css("top",2);$(".my-lf-label").css("left",42);t.on("mousedown",u);t.on("mouseup",z);l.on("mouseup",z);b={pointList:E,extent:G,lat:e,lng:b,radius:g};n=r.callback;k=b;r.callback&&!c&&r.callback(b);l.setZoom(v);1==r.isCenter&&l.fitBounds(A)}}var l=b.map,g=b.appEvent,d=b.appCoord,h;this.init=function(){h=L.layerGroup().addTo(l);g.on(g.clearMap,function(a){h.clearLayers()})};this.bufferPoint=function(a,b,d,k){c=!1;e(a,b,d,k)};this.callbackFun_onResult=function(){};this.removeBuffer=function(){h.clearLayers()};var c=!1;m=f=a=void 0;var n,k,z=function(a){l.dragging.enabled()||(l.dragging.enable(),r(a),n(k),console.log("end"));l.off("mousemove",r)},u=function(a){l.dragging.enabled()&&l.dragging.disable();c=!0;console.log("start");l.off("mousemove",r);l.on("mousemove",r)},r=function(b){var c=d.reSetCoordinate_out(b.latlng.lng,b.latlng.lat);b=[a,f];c=[c.lng,c.lat];b=d.reSetCoordinate(b[0],b[1]);c=d.reSetCoordinate(c[0],c[1]);b=L.latLng(b);c=L.latLng(c);b=b.distanceTo(c);e(a,f,b,m)}};RMap.Tools.ClearMap=function(b){var a=b.appEvent;this.clearMap=function(){a.dispatch(a.clearMap)}};RMap.Tools.ConvertCoord=function(b){this.convertCoord=function(a,b,m,e){m==e?a={lng:a,lat:b}:(m=new proj4.Proj(m.proj4),e=new proj4.Proj(e.proj4),a=proj4(m,e,[a,b]),a={lng:a[0],lat:a[1]});return a}};RMap.Tools.ConvertEncryptCoord=function(b){var a=b.appCoord;this.convertEncryptCoord=function(b,m,e,l){return e==l?{lng:b,lat:m}:"bd09"==e&&"wgs84"==l?a.convert_bd09_To_gps84(Number(b),Number(m)):"wgs84"==e&&"bd09"==l?a.convert_gps84_To_bd09(Number(b),Number(m)):"wgs84"==e&&"gcj02"==l?a.convert_gps84_To_gcj02(Number(b),Number(m)):"gcj02"==e&&"wgs84"==l?a.convert_gcj02_To_gps84(Number(b),Number(m)):"gcj02"==e&&"bd09"==l?a.convert_gcj02_To_bd09(Number(b),Number(m)):"bd09"==e&&"gcj02"==l?a.convert_bd09_To_gcj02(Number(b),Number(m)):null}};RMap.Tools.GetMapInformation=function(b){function a(a){k++;a.layer.drawId=void 0!=n.id||null!=n.id?n.id:"DrawPoint"+k;h.addLayer(a.layer);0<=n.showTime&&setTimeout(function(){h.removeLayer(a.layer)},n.showTime);f(a.layer)}function f(a){if(n.callback){var b=g.reSetCoordinate_out(a._latlng.lng,a._latlng.lat);a={id:a.drawId,lng:b.lng.toFixed(6),lat:b.lat.toFixed(6)};n.callback(a);0==n.repeatMode&&(c=null)}}function m(){c&&c.removeHooks();c=null;h.clearLayers();d&&(d.parentNode.removeChild(d),d=void 0)}var e=b.map,l=b.appEvent,g=b.appCoord,d,h,c,n,k=0;this.init=function(){h=(new L.FeatureGroup).addTo(e);l.on(l.clearMap,function(a){m()})};this.getCoordinate=function(b,d){c||(n={showTime:3E3,repeatMode:!0},n=RMap.extend(n,d),n.callback=b,e.off(L.Draw.Event.CREATED,a),e.on(L.Draw.Event.CREATED,a),c=new L.Draw.Marker(e),c.options.repeatMode=n.repeatMode,L.Handler.prototype.enable.call(c),c.fire("enabled",{handler:c.type}),c._map.fire(L.Draw.Event.DRAWSTART,{layerType:c.type}))};this.callbackFun_onResult=function(){};this.stopGetCoordinate=function(){m()};this.getMapExtent=function(){var a=e.getBounds(),b=g.reSetCoordinate_out(a._southWest.lng,a._southWest.lat),a=g.reSetCoordinate_out(a._northEast.lng,a._northEast.lat);return[b.lng,b.lat,a.lng,a.lat]};this.getMapLevel=function(){return e.getZoom()}};RMap.Tools.ShowCoordinate=function(b){function a(){var a="\u7ea7\u6570\uff1a"+l+"\uff0c\u7ecf\u5ea6\uff1a"+g.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+g.lat.toFixed(6),b="\u7ecf\u5ea6\uff1a"+g.lng.toFixed(6)+"\uff0c\u7eac\u5ea6\uff1a"+g.lat.toFixed(6);d.innerHTML=a;e&&(e.innerHTML=b,helpTooltip.setPosition([g.lng,g.lat]),$(e).removeClass("hidden"))}var f=b.map,m=b.appCoord,e,l,g,d,h=!1;this.init=function(){d=document.createElement("label");d.style.position="absolute";d.style.bottom="10px";d.style.left="10px";g=m.reSetCoordinate_out(f.getCenter().lng,f.getCenter().lat);l=f.getZoom();f.on("zoom",function(b){l=f.getZoom();a()});f.on("mousemove",function(b){g=m.reSetCoordinate_out(b.latlng.lng,b.latlng.lat);l&&a()})};this.showCoordinate=function(a){a&&(a.top&&(d.style.bottom=null,d.style.top=a.top+"px"),a.bottom&&(d.style.top=null,d.style.bottom=a.bottom+"px"),a.left&&(d.style.right=null,d.style.left=a.left+"px"),a.right&&(d.style.left=null,d.style.right=a.right+"px"));d.style["z-index"]=99999;f.getContainer().appendChild(d);h=!0};this.hideCoordinate=function(){h&&(f.getContainer().removeChild(d),h=!1)}};RMap.Control.TrackPlay=function(b){function a(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=[a[d][1],a[d][0]];d=L.polyline(c,{color:"#323232",opacity:.5,weight:b.width,data:b});b.isShowArrow&&m(c,r);if(b.onClick)d.on("click",function(a){b.onClick(b)});z.addLayer(d)}function f(){x&&(document.body.removeChild(w),x=!1);z.clearLayers();u.clearLayers();r.clearLayers();p.clearLayers();c.off("mousemove",O)}function m(a,b){for(var c=0;c<a.length-1;c++){var d=a[c],e=a[c+1],k=e[0]-d[0],g=e[1]-d[1],f=[(d[0]+e[0])/2,(d[1]+e[1])/2],d=180*Math.atan2(e[0]-d[0],e[1]-d[1])/Math.PI;-180<d&&0>d&&(d=360+d);e=RMap.scriptLocation+"image/arrow.png";$(".RotatedMarker").css("text-align","center");d=L.divIcon({iconAnchor:[8,8],className:"RotatedMarker",html:'\x3cimg src\x3d"'+e+'" style\x3d"transform:rotate(-'+d+'deg)"/\x3e'});f=L.marker(f,{icon:d});0==k&&0==g||b.addLayer(f)}}function e(a,b,c,d){H&&(window.clearTimeout(I),b.getLatLng(),b.setLatLng([d[1],d[0]]),H=!1);var k=[c[0]+(d[0]-c[0])*J/20,c[1]+(d[1]-c[1])*J/20];b.setLatLng([k[1],k[0]]);J++;20>=J&&(I=window.setTimeout(function(){e(a,b,c,d)},a/20))}function l(a,b){var c=180*Math.atan2(b[1]-a[1],b[0]-a[0])/Math.PI;-180<c&&0>c&&(c=360+c);$(".RotatedMarker").css("text-align","center");return L.divIcon({iconAnchor:t.trackPointAnchor,className:"RotatedMarker",html:'\x3cimg src\x3d"'+t.trackPointPic+'" style\x3d"transform:rotate(-'+c+'deg)"/\x3e'})}function g(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=[a[d][1],a[d][0]];c=L.polyline(c,{color:b.color,opacity:b.opacity,weight:b.width,attribute:b});if(b.onClick)c.on("click",function(a){b.onClick(b)});u.addLayer(c)}function d(a){var b;b="\x3ctr class\x3d'tracktr'\x3e"+("\x3ctd style\x3d'width:140px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/span\x3e\x3c/td\x3e");b+="\x3ctd style\x3d'width:150px;'\x3e\x3ca id\x3d'trackListShowMapPoint' data-lng\x3d'"+a.lng+"' data-lat\x3d'"+a.lat+"' style\x3d'cursor:pointer;' title\x3d'"+a.data.id+"'\x3e"+a.data.id+"\x3c/a\x3e\x3c/td\x3e";b+="\x3ctd style\x3d'width:150px;'\x3e\x3cspan class'r-grid-omit' title\x3d'"+a.data.time+"'\x3e"+a.data.time+"\x3c/span\x3e\x3c/td\x3e";b+="\x3c/tr\x3e";$("#trackBody").after(b)}function h(){if(q.playing){var a=parseInt($(".j_curNum").text());a>=q.dataTotal+1&&--a;var b=q.slideBarW/q.dataTotal*a;$(".j_curNum").text(a+1);$(".sCur").stop().animate({width:b},q.speed,"linear");$(".sPoint").stop().animate({left:b},q.speed,"linear",function(){b<q.slideBarW?h():q.pause()});q.callback&&q.callback(parseInt($(".j_curNum").text())-1)}}var c=b.map,n=b.appEvent,k=b.appCoord,z,u,r,p,D,F=[],M=[],y=[],E=800,v=0,A=0,G=!1,t,x=!1,w,B=[],N="#02EE82 #0C7FF8 #D12DF7 #FF0000 #F5DF26 #91F90A".split(" "),R=L.icon({iconUrl:RMap.scriptLocation+"image/trackStart.png",iconAnchor:[13.5,39]}),S=L.icon({iconUrl:RMap.scriptLocation+"image/trackEnd.png",iconAnchor:[13.5,39]});this.init=function(){z=L.layerGroup().addTo(c);u=L.layerGroup().addTo(c);r=L.layerGroup().addTo(c);p=L.layerGroup().addTo(c);D=L.layerGroup();n.on(n.clearMap,function(a){f()})};this.addTrackPlay=function(b,e){z.clearLayers();u.clearLayers();r.clearLayers();p.clearLayers();B=[];A=0;F=[];M=[];y=[];c.on("mousemove",O);for(var g=[b],f=0;f<g.length;f++){var h={id:null,width:2,color:0,style:"",isCenter:!1,isShowArrow:!1,isShowTime:!1,showTimeKey:"time",trackPointPic:RMap.scriptLocation+"image/trackPoint.png",trackPointAnchor:[15.5,9],speed:800,data:null,onClick:null};e.speed&&(E=e.speed,q.speed=e.speed);e=RMap.extend(h,e);e.color=N[f%6];t=e;var m=g[f],h=RMap.extend(h,m.styleOption),n;n=m;for(var v=e,v=RMap.extend({proj:null},v),P=[],K=0;K<n.pointList.length;K++){var C=k.reSetCoordinate(n.pointList[K].lng,n.pointList[K].lat,v.proj),C=[C.lng,C.lat,n.pointList[K].data,n.trackId];P.push(C);B.push(C);C=L.circleMarker([C[1],C[0]],{radius:3,color:"white",weight:2,opacity:1,attribute:C[2],trackId:C[3]});y.push(C);C.on("click",T);p.addLayer(C);D.addLayer(C)}n=P;F.push({originalCoords:m.pointList,routeCoords:n,option:h});a(n,h);A<n.length&&(A=n.length);h=n;n=l(h[0],h[1]);n=L.marker([h[0][1],h[0][0]],{icon:n});M.push(n);p.addLayer(n);n=L.marker([h[0][1],h[0][0]],{icon:R});p.addLayer(n);h=L.marker([h[h.length-1][1],h[h.length-1][0]],{icon:S});p.addLayer(h);h="";m.pointList[0].data[t.showTimeKey]&&(h=m.pointList[0].data[t.showTimeKey]);m="";n='\x3cdiv class\x3d"conBtnWrap clearfix"\x3e';t.isShowTime&&(n='\x3cdiv class\x3d"conBtnWrap_showTime clearfix"\x3e',m='\x3cspan id\x3d"currentTime_track" class\x3d"right schedule_right"\x3e'+h+"\x3c/span\x3e");x&&w&&(document.body.removeChild(w),x=!1);w=document.createElement("div");w.id="conPanel";w.className="j_conPanel conPanelWrap";w.innerHTML='\x3cdiv class\x3d"slideBarWrap"\x3e\x3ca href\x3d"javascript:;" class\x3d"conPanelCloser"\x3e\x3c/a\x3e\x3cdiv class\x3d"j_sDefault sDefault"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_sCur sCur"\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" id\x3d"sPoint" class\x3d"sPoint"\x3e\x3c/a\x3e\x3c/div\x3e'+n+'\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPre left btnPre"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnRest left btnRest"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnPause left btnPause stop"\x3e\x3c/a\x3e\x3ca href\x3d"javascript:;" class\x3d"j_btnNext left btnNext"\x3e\x3c/a\x3e\x3cdiv class\x3d"left mulTextWrap"\x3e\x3cspan class\x3d"mulText" style\x3d"display:none;"\x3eX\x3cem\x3e1\x3c/em\x3e\x3c/span\x3e\x3c/div\x3e\x3cspan class\x3d"left schedule"\x3e\x3cem class\x3d"j_curNum"\x3e0\x3c/em\x3e/\x3cem class\x3d"j_dataTotal"\x3e100\x3c/em\x3e\x3c/span\x3e'+m+'\x3ca href\x3d"javascript:;" class\x3d"conPanelShowTrackList"\x3e\u663e\u793a\u5217\u8868\x3c/a\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f star--\x3e\x3cdiv id\x3d"trackList" class\x3d"relTableWrap relTableWrap_relation r-grid" style\x3d"height:215px;width:auto;margin-top:8px;display:none;"\x3e\t\x3cdiv class\x3d"r-grid-bd-box" id\x3d"trackResult_grid_bd_box" style\x3d"height:215px;padding-top:0px;margin-top:0px;"\x3e\t\t\x3ctable class\x3d"r-grid-center" style\x3d"width:auto;" id\x3d"trackListTable"\x3e\t\t\t\x3cthead\x3e\t\t\t\t\x3ctr\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 100px;"\x3e\u8bbe\u5907\u7f16\u53f7\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 150px;"\x3e\u5730\u5740\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\t\x3cth\x3e\x3cdiv class\x3d"r-grid-layout"\x3e\x3cspan class\x3d"r-grid-omit" style\x3d"width: 121px;"\x3e\u83b7\u53d6\u65f6\u95f4\x3c/span\x3e\x3cspan class\x3d"r-grid-handle" style\x3d"cursor: default;"\x3e\x3c/span\x3e\x3cem class\x3d"r-grid-sort"\x3e\x3c/em\x3e\x3c/div\x3e\x3c/th\x3e\t\t\t\t\x3c/tr\x3e\t\t\t\x3c/thead\x3e\t\t\t\x3ctbody id\x3d"trackBody"\x3e\t\t\t\x3c/tbody\x3e\t\t\x3c/table\x3e\t\x3c/div\x3e\x3c/div\x3e\x3c!--\u8f68\u8ff9\u4fe1\u606f end--\x3e';document.body.appendChild(w);t.top&&(w.style.top=t.top+"px");t.left&&(w.style.left=t.left+"px");q.init(A-1,c,U);x=!0;d(g[0].pointList[0])}if(1==e.isCenter){g=[];for(f=0;f<B.length;f++)g[f]=[B[f][1],B[f][0]];f=L.polyline(g);1==e.isCenter&&c.fitBounds(f.getBounds())}};this.callbackFun_trackObj=function(){};this.callbackFun_mouseMove=function(){};this.callbackFun_play=function(){};this.removeTrackPlay=function(){f()};var J,I,H=!1,U=function(a){v=a;if(v>=A)H=G=!0,window.clearTimeout(I);else if(0==v)for(H=G=!0,window.clearTimeout(I),u.clearLayers(),a=0;a<F.length;a++){var b=F[a].routeCoords,k=M[a],f=b[0];if(t.playCallback){var h={lng:f[0],lat:f[1],data:f[2],trackId:f[3]};d(h);t.playCallback(h)}f[2][t.showTimeKey]&&$("#currentTime_track").html(f[2][t.showTimeKey]);k.setLatLng([f[1],f[0]]);b=l(b[0],b[1]);k.setIcon(b)}else G=!1;if(!G)for(u.clearLayers(),a=0;a<F.length;a++)if(k=F[a].routeCoords,f=F[a].originalCoords,b=M[a],t.playCallback&&k&&(f={lng:f[v].lng,lat:f[v].lat,data:k[v][2],trackId:k[v][3]},d(f),t.playCallback(f)),k[v]&&3<k[v].length&&k[v][2][t.showTimeKey]&&$("#currentTime_track").html(k[v][2][t.showTimeKey]),v<k.length){var f=l(k[v-1],k[v]),h=k[v],n=c.getBounds();(h[0]<n.getWest()||h[0]>n.getEast()||h[1]<n.getSouth()||h[1]>n.getNorth())&&c.setView([h[1],h[0]]);J=0;H=!0;window.clearTimeout(I);e(q.speed,b,k[v-1],k[v]);b.setIcon(f);b=[];for(f=0;f<=v;f++)b.push(k[f]);g(b,F[a].option)}},Q=function(a){var b=L.GeometryUtil.closestLayer(c,y,a.latlng,!1),d=b.latlng;if(null!=b){var e=a.layerPoint;a=c.latLngToLayerPoint(d);e=Math.sqrt((e.x-a.x)*(e.x-a.x)+(e.y-a.y)*(e.y-a.y));point=b;t.mouseMoveCallback&&(d=k.reSetCoordinate_out(d.lng,d.lat),t.mouseMoveCallback({lng:d.lng,lat:d.lat,data:b.layer.options.attribute,trackId:b.layer.options.trackId}))}50<e&&t.mouseMoveCallback&&t.mouseMoveCallback(null)},O=function(a){a.dragging||t.mouseMoveCallback&&Q(a)},T=function(a){Q(a)},q={dataTotal:100,slideBarW:482,step:1,speed:E,playing:!1,callback:null,init:function(a,c,d){function e(a){var b=$(".sPoint"),c=$(".slideBarWrap").offset().left;a=a.clientX-c;c=q.slideBarW;0>a&&(a=0);a>c&&(a=c);b.css({left:a+"px"});$(".sCur").width(a);b=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(b+1);q.callback&&q.callback(parseInt($(".j_curNum").text())-1);return!1}a&&(q.dataTotal=a);d&&(q.callback=d);$(".j_dataTotal").text(q.dataTotal+1);$(".j_curNum").text(1);$(".conPanelCloser").on("click",function(a){f()});$("#trackListShowMapPoint").die().live("click",function(){var a=$(this).attr("data-lng"),c=$(this).attr("data-lat"),d=new RMap.LightPoint(b);d.init();d.hideLightPoint();d.showLightPoint(a,c);setTimeout(function(){d.hideLightPoint()},6E4)});$(".conPanelShowTrackList").on("click",function(a){"\u663e\u793a\u5217\u8868"==$(this).html()?($(this).html("\u6536\u8d77\u5217\u8868"),$("#trackList").show()):"\u6536\u8d77\u5217\u8868"==$(this).html()&&($(this).html("\u663e\u793a\u5217\u8868"),$("#trackList").hide())});$(".btnPause").on("click",function(a){$(this).hasClass("stop")?(v>=A-1&&q.stop(),$(".j_sCur").width()<$(".j_sDefault").width()&&q.start()):q.pause();a.stopPropagation()});$(".j_btnRest").on("click",function(){q.stop()});$(".j_btnNext").on("click",function(){var a=q.step;16>a&&(q.step=2*a,q.speed/=2,q.playing&&q.start());$(this).next().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnNext").next().find(".mulText").fadeOut()},800)});$(".j_btnPre").on("click",function(){var a=q.step;1<a&&(q.step=a/2,q.speed*=2,q.playing&&q.start());$(this).prev().find(".mulText").fadeIn().find("em").text(q.step);q.timer&&clearTimeout(q.timer);q.timer=setTimeout(function(){$(".j_btnPre").prev().find(".mulText").fadeOut()},800)});$(".sPoint").on("mousedown",function(a){var b=$(".sPoint"),c=$(".slideBarWrap").offset().left,d;$(document).on("mousemove.slideBar",function(a){a=a.clientX-c;var e=q.slideBarW;0>a&&(a=0);a>e&&(a=e);b.css({left:a+"px"});$(".sCur").width(a);d=Math.round(a/q.slideBarW*q.dataTotal);$(".j_curNum").text(d+1);return!1});$(document).on("mouseup.slideBar",function(a){$(document).off("mousemove.slideBar");$(document).off("mouseup.slideBar");q.callback&&q.callback(parseInt($(".j_curNum").text())-1)});return!1});$(".j_sDefault").on("click",e);$(".j_sCur").on("click",e);$(".j_conPanel").on("mousedown",function(a){var b=$(".j_conPanel"),d=a.clientX-b.offset().left,e=a.clientY-b.offset().top;$(document).on("mousemove.conPanel",function(a){var k=a.clientX-d;a=a.clientY-e;var f=0,g=0,h=c.getContainer();if(h){f=h.offsetLeft;g=h.offsetTop+document.body.scrollTop;do h=h.offsetParent,f+=h.offsetLeft,g+=h.offsetTop;while("BODY"!=h.tagName)}var h=f+c.getSize()[0]-$(".j_conPanel").width(),n=g+c.getSize()[1]-$(".j_conPanel").height();k<f&&(k=f);a<g&&(a=g);k>h&&(k=h);a>n&&(a=n);b.css({left:k+"px",top:a+"px"});return!1});$(document).on("mouseup.conPanel",function(a){$(document).off("mousemove.conPanel");$(document).off("mouseup.conPanel")});return!1})},stop:function(){$(".btnPause").addClass("stop");q.playing=!1;$(".sCur").stop();$(".sPoint").stop();q.step=1;q.speed=E;$(".j_curNum").text(1);$(".sCur").width(0);$(".sPoint").css("left",0);q.callback&&q.callback(parseInt($(".j_curNum").text())-1)},pause:function(){$(".btnPause").addClass("stop");q.playing=!1;h()},start:function(){$(".btnPause").removeClass("stop");q.playing=!0;h()}}};RMap.Query.QueryLayer=function(b){function a(a,b){b=RMap.extend({queryWhere:"1\x3d1",geoQueryType:"intersects"},b);var c=L.esri.query({url:a.url});if(b.queryPointList){for(var d=b.queryPointList,e=[],g=0;g<d.length;g++){var l=h.reSetCoordinate(d[g][0],d[g][1],b.proj);e[g]=[l.lat,l.lng]}d=L.polygon(e);"intersects"==b.geoQueryType?c.intersects(d):"within"==b.geoQueryType&&c.within(d)}c.where(b.queryWhere);c.run(function(a,c){f(c,b)})}function f(a,b){var d=L.geoJSON(a,{pointToLayer:function(a,c){if(b.pic){var d=L.icon({iconUrl:b.pic,iconAnchor:b.anchor});return L.marker(c,{icon:d})}return L.marker(c)}});if(a.features&&!(0>=a.features.length)){var e=a.features[0].geometry.type;"Point"!=e&&(e=m(e,b),d.setStyle(e));c.addLayer(d);if(b.onClick)d.on("click",function(a){a.layer.feature.properties.clickPosition=a.latlng;b.onClick(a.layer.feature.properties)});if(b.onResult)b.onResult(a.features)}}function m(a,b){if("MultiLineString"==a){var c={color:"#3388ff",width:2,opacity:.8};b=RMap.extend(c,b);return{color:b.color,opacity:b.opacity,weight:b.width}}return"Polygon"==a?(c={color:"#3388ff",width:2,opacity:.3,outLineWidth:2,outLineColor:"#3388ff",outLineOpacity:.5},b=RMap.extend(c,b),{stroke:!0,color:b.outLineColor,weight:b.outLineWidth,opacity:b.outLineOpacity,fillColor:b.color,fillOpacity:b.opacity}):null}function e(a,b){var c="",d="";if(b.queryPointList){for(var c=b.queryPointList,e=0;e<c.length;e++)var g=h.reSetCoordinate(c[e][0],c[e][1],b.proj),d=0==e?d+("(the_geom,POLYGON(("+g.lng+" "+g.lat):d+(","+g.lng+" "+g.lat);d+=")))";"intersects"==b.geoQueryType?d="INTERSECTS"+d:"within"==b.geoQueryType&&(d="WITHIN"+d)}b.queryWhere?(c=b.queryWhere,""!=d&&(c+=" AND "+d)):c=d;d=L.Util.extend({service:"WFS",version:"1.0.0",request:"GetFeature",typeName:a.typeName,outputFormat:"text/javascript",format_options:"callback:getJson",SrsName:a.srsName,cql_filter:c});d=a.url+L.Util.getParamString(d);$.ajax({url:d,dataType:"jsonp",jsonpCallback:"getJson",success:function(a){f(a,b)}})}function l(){c.clearLayers();d.dispatch(d.clearDrawMeasure)}var g=b.map,d=b.appEvent,h=b.appCoord,c;this.init=function(){c=L.layerGroup().addTo(g);d.on(d.clearMap,function(a){l()});d.on(d.clearQueryResult,function(a){l()})};this.queryLayer=function(b,c){for(var d=RMap.config.thematicLayer,f=0;f<d.length;f++){var g=d[f];b==g.layerName&&("ArcGISRest"==g.layerType?a(g,c):"WFS_GeoServer"==g.layerType&&e(g,c))}};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){};this.removeQueryResult=function(){l();d.dispatch(d.clearQueryResult)}};RMap.Query.QueryLayerByPointBuffer=function(b){var a=b.appEvent,f=new RMap.Tools.Buffer(b),m=new RMap.Query.QueryLayer(b);this.init=function(){f.init();m.init();a.on(a.clearMap,function(a){f.removeBuffer()});a.on(a.clearQueryResult,function(a){f.removeBuffer()})};this.queryLayerByPointBuffer=function(a,b,g,d,h){var c=h.styleIn;c||(c={});c.callback=function(a){h.queryPointList=a.pointList;m.queryLayer(d,h)};c.proj=h.proj;f.bufferPoint(a,b,g,c)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};RMap.Query.QueryLayerByRect=function(b){var a=b.appEvent,f=new RMap.Draw.DrawRect(b),m=new RMap.Query.QueryLayer(b);this.init=function(){f.init();m.init();a.on(a.clearMap,function(a){f.removeDrawRect()});a.on(a.clearQueryResult,function(a){f.removeDrawRect()})};this.queryLayerByRect=function(a,b){b=RMap.extend({id:null,callback:null,styleIn:{outLineWidth:2,outLineColor:"#33AAFF",outLineOpacity:.5,outLineStyle:"",color:"#33AAFF",opacity:.5},showMeasurements:!1},b);f.drawRect(function(f){b.queryPointList=f.pointList;m.queryLayer(a,b)},b.styleIn)};this.callbackFun_onClick=function(){};this.callbackFun_onResult=function(){};this.callbackFun_pointStyle=function(){};this.callbackFun_lineStyle=function(){};this.callbackFun_polygonStyle=function(){}};